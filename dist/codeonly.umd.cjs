(function(l,E){typeof exports=="object"&&typeof module<"u"?E(exports):typeof define=="function"&&define.amd?define(["exports"],E):(l=typeof globalThis<"u"?globalThis:l||self,E(l.codeonly={}))})(this,function(l){"use strict";var ei=Object.defineProperty;var Nt=l=>{throw TypeError(l)};var ti=(l,E,L)=>E in l?ei(l,E,{enumerable:!0,configurable:!0,writable:!0,value:L}):l[E]=L;var ue=(l,E,L)=>ti(l,typeof E!="symbol"?E+"":E,L),et=(l,E,L)=>E.has(l)||Nt("Cannot "+L);var r=(l,E,L)=>(et(l,E,"read from private field"),L?L.call(l):E.get(l)),w=(l,E,L)=>E.has(l)?Nt("Cannot add the same private member more than once"):E instanceof WeakSet?E.add(l):E.set(l,L),m=(l,E,L,H)=>(et(l,E,"write to private field"),H?H.call(l,L):E.set(l,L),L),T=(l,E,L)=>(et(l,E,"access private method"),L);var Te=(l,E,L,H)=>({set _(He){m(l,E,He,L)},get _(){return r(l,E,H)}});var Fe,Z,ge,z,j,g,tt,Ae,X,re,oe,ae,fe,Et,it,St,nt,_t,st,Lt,rt,pe,U,A,F,le,R,de,ve,Y,Q,Re,ot,be,K,I,ee,Pe,ie,Ie,k,q,he,we,Ne,Ee,B,Se,J,V;function E(a,e){for(let t=0;t<a.length;t++)e(a[t],t)||(a.splice(t,1),t--)}function L(a){return a.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}function H(a){return a instanceof Function&&!!a.prototype&&!!a.prototype.constructor}function He(a,e){if(a===e)return!0;if(a.size!==e.size)return!1;for(const t of a)if(!e.has(t))return!1;return!0}function at(a,e){if(a===e||a===void 0&&e===void 0)return!0;if(a===void 0||e===void 0)return!1;if(a===null&&e===null)return!0;if(a===null||e===null||typeof a!="object"||typeof e!="object")return!1;let t=Object.getOwnPropertyNames(a),i=Object.getOwnPropertyNames(e);if(t.length!=i.length)return!1;for(let n of t)if(!Object.hasOwn(e,n)||!at(a[n],e[n]))return!1;return!0}function Tt(a,e,t){let i=0,n=a.length-1;for(;i<=n;){let o=Math.floor((i+n)/2),h=a[o],c=e(h,t);if(c==0)return o;c<0?i=o+1:n=o-1}return-1-i}function Ct(a,e){return a<e?-1:a>e?1:0}function Mt(a,e){return a=a.toLowerCase(),e=e.toLowerCase(),a<e?-1:a>e?1:0}let Dt=/^[a-zA-Z$][a-zA-Z0-9_$]*$/;function W(a){return a.match(Dt)?`.${a}`:`[${JSON.stringify(a)}]`}function lt(a,e){a.loading?a.addEventListener("loaded",e,{once:!0}):e()}class O{constructor(e){this.html=e}}function Ft(a){return new O(a)}class Je{constructor(e){this.value=e}}function Rt(a){return new Je(a)}function Oe(){let a=[],e="";function t(...y){for(let b=0;b<y.length;b++){let f=y[b];f.lines?a.push(...f.lines.map(N=>e+N)):Array.isArray(f)?a.push(...f.filter(N=>N!=null).map(N=>e+N)):a.push(...f.split(`
`).map(N=>e+N))}}function i(){e+="  "}function n(){e=e.substring(2)}function o(){return a.join(`
`)+`
`}function h(y){t("{"),i(),y(this),n(),t("}")}function c(...y){let b={pos:this.lines.length};return this.append(y),b.headerLineCount=this.lines.length-b.pos,b}function p(y,...b){this.lines.length==y.pos+y.headerLineCount?this.lines.splice(y.pos,y.headerLineCount):this.append(b)}return{append:t,enterCollapsibleBlock:c,leaveCollapsibleBlock:p,indent:i,unindent:n,braced:h,toString:o,lines:a,get isEmpty(){return a.length==0}}}class We{constructor(){this.code=Oe(),this.code.closure=this,this.functions=[],this.locals=[],this.prologs=[],this.epilogs=[]}get isEmpty(){return this.code.isEmpty&&this.locals.length==0&&this.functions.every(e=>e.code.isEmpty)&&this.prologs.every(e=>e.isEmpty)&&this.epilogs.every(e=>e.isEmpty)}addProlog(){let e=Oe();return this.prologs.push(e),e}addEpilog(){let e=Oe();return this.epilogs.push(e),e}addLocal(e,t){this.locals.push({name:e,init:t})}addFunction(e,t){t||(t=[]);let i={name:e,args:t,code:new We};return this.functions.push(i),i.code}getFunction(e){var t;return(t=this.functions.find(i=>i.name==e))==null?void 0:t.code}toString(){let e=Oe();return this.appendTo(e),e.toString()}appendTo(e){this.locals.length>0&&e.append(`let ${this.locals.map(t=>t.init?`${t.name} = ${t.init}`:t.name).join(", ")};`);for(let t of this.prologs)e.append(t);e.append(this.code);for(let t of this.functions)e.append(`function ${t.name}(${t.args.join(", ")})`),e.append("{"),e.indent(),t.code.appendTo(e),e.unindent(),e.append("}");for(let t of this.epilogs)e.append(t)}}function Ce(a){return a==null?"":(""+a).replace(/["'&<>]/g,function(e){switch(e){case'"':return"&quot;";case"&":return"&amp;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;"}})}class dt{static rawText(e){return e instanceof O?e.html:Ce(e)}static renderToString(e){let t="";return e({write:function(i){t+=i}}),t}static renderComponentToString(e){let t="";return e.render({write:function(i){t+=i}}),t}static rawStyle(e){let t;return e instanceof O?t=e.html:t=Ce(e),t=t.trim(),t.endsWith(";")||(t+=";"),t}static rawNamedStyle(e,t){if(!t)return"";let i;return t instanceof O?i=t.html:i=Ce(t),i=i.trim(),i+=";",`${e}:${i}`}static createTextNode(e){if(e instanceof O){let t=document.createElement("SPAN");return t.innerHTML=e.html,t}else return document.createTextNode(e)}static setElementAttribute(e,t,i){i===void 0?e.removeAttribute(t):e.setAttribute(t,i)}static setElementText(e,t){t instanceof O?e.innerHTML=t.html:e.innerText=t}static setNodeText(e,t){if(t instanceof O){if(e.nodeType==1)return e.innerHTML=t.html,e;let i=document.createElement("SPAN");return i.innerHTML=t.html,e.replaceWith(i),i}else{if(e.nodeType==3)return e.nodeValue=t,e;let i=document.createTextNode(t);return e.replaceWith(i),i}}static setNodeClass(e,t,i){i?e.classList.add(t):e.classList.remove(t)}static setNodeStyle(e,t,i){i==null?e.style.removeProperty(t):e.style[t]=i}static setNodeDisplay(e,t,i){if(t===!0){i===null?e.style.removeProperty("display"):i!==void 0&&e.style.display!=i&&(e.style.display=i);return}else if(t===!1||t===null||t===void 0){let n=e.style.display;return e.style.display!="none"&&(e.style.display="none"),n??null}else if(typeof t=="string"){let n=e.style.display;return e.style.display!=t&&(e.style.display=t),n??null}}static replaceMany(e,t){var i;if((i=e==null?void 0:e[0])!=null&&i.parentNode){e[0].replaceWith(...t);for(let n=1;n<e.length;n++)e[n].remove()}}static addEventListener(e,t,i,n){function o(h){return n(e(),h)}return t.addEventListener(i,o),function(){t.removeEventListener(i,o)}}}function ht(a){let e=function(){var i;let t=(i=l.env.document)==null?void 0:i.createComment(a);return{get rootNode(){return t},get rootNodes(){return[t]},get isSingleRoot(){return!0},setMounted(n){},destroy(){},update(){},render(n){n.write(`<!--${Ce(a)}-->`)}}};return e.isSingleRoot=!0,e}const Ve=class Ve{constructor(e){w(this,Fe,!1);this.branches=e.data,this.branch_constructors=[],this.context=e.context;for(let t of this.branches)t.nodeIndex!==void 0?this.branch_constructors.push(e.nodes[t.nodeIndex]):this.branch_constructors.push(ht(" IfBlock placeholder "));this.activeBranchIndex=-1,this.activeBranch=ht(" IfBlock placeholder ")()}static integrate(e,t){let i=[],n=[],o=!1,h=!0;for(let c=0;c<e.branches.length;c++){let p=e.branches[c],y={};if(i.push(y),p.condition instanceof Function?(y.condition=p.condition,o=!1):p.condition!==void 0?(y.condition=()=>p.condition,o=!!p.condition):(y.condition=()=>!0,o=!0),p.template!==void 0){let b=new G(p.template,t);b.isSingleRoot||(h=!1),y.nodeIndex=n.length,n.push(b)}}return delete e.branches,o||i.push({condition:()=>!0}),{isSingleRoot:h,nodes:n,data:i}}static transform(e){if(e.if===void 0)return e;let t={type:Ve,branches:[{template:e,condition:e.if}]};return delete e.if,t}static transformGroup(e){let t=null;for(let i=0;i<e.length;i++){let n=e[i];if(n.if)t={type:Ve,branches:[{condition:n.if,template:n}]},delete n.if,e.splice(i,1,t);else if(n.elseif){if(!t)throw new Error("template has 'elseif' without a preceeding condition");t.branches.push({condition:n.elseif,template:n}),delete n.elseif,e.splice(i,1),i--}else if(n.else!==void 0){if(!t)throw new Error("template has 'else' without a preceeding condition");t.branches.push({condition:!0,template:n}),delete n.else,t=null,e.splice(i,1),i--}else t=null}}destroy(){this.activeBranch.destroy()}update(){this.switchActiveBranch(),this.activeBranch.update()}render(e){this.activeBranch.render(e)}unbind(){var e,t;(t=(e=this.activeBranch).unbind)==null||t.call(e)}bind(){var e,t;(t=(e=this.activeBranch).bind)==null||t.call(e)}switchActiveBranch(e){let t=this.resolveActiveBranch();if(t!=this.activeBranchIndex){let i=this.activeBranch;this.activeBranchIndex=t,this.activeBranch=this.branch_constructors[t](),dt.replaceMany(i.rootNodes,this.activeBranch.rootNodes),r(this,Fe)&&(i.setMounted(!1),this.activeBranch.setMounted(!0)),i.destroy()}}resolveActiveBranch(){for(let e=0;e<this.branches.length;e++)if(this.branches[e].condition.call(this.context.model,this.context.model,this.context))return e;throw new Error("internal error, IfBlock didn't resolve to a branch")}setMounted(e){m(this,Fe,e),this.activeBranch.setMounted(e)}get rootNodes(){return this.activeBranch.rootNodes}get rootNode(){return this.activeBranch.rootNode}};Fe=new WeakMap;let ke=Ve;function It(a,e){let t=Math.min(a.length,e.length),i=Math.max(a.length,e.length),n=0;for(;n<t&&a[n]==e[n];)n++;if(n==i)return[];if(n==a.length)return[{op:"insert",index:a.length,count:e.length-a.length}];let o=0;for(;o<t-n&&a[a.length-o-1]==e[e.length-o-1];)o++;if(o==a.length)return[{op:"insert",index:0,count:e.length-a.length}];if(n+o==a.length)return[{op:"insert",index:n,count:e.length-a.length}];if(n+o==e.length)return[{op:"delete",index:n,count:a.length-e.length}];let h=a.length-o,c=e.length-o,p=ce(e,n,c),y=null,b=[],f=n,N=n;for(;f<c;){for(;f<c&&a[N]==e[f];)p.delete(e[f],f),f++,N++;let u=f,_=N;for(;N<h&&!p.has(a[N]);)N++;if(N>_){b.push({op:"delete",index:u,count:N-_});continue}for(y||(y=ce(a,f,h));f<c&&!y.has(e[f]);)p.delete(e[f],f),f++;if(f>u){b.push({op:"insert",index:u,count:f-u});continue}break}if(f==c)return b;let d=0,x=new ct;for(;N<h;){let u=N;for(;N<h&&!p.has(a[N]);)N++;if(N>u){b.push({op:"delete",index:f,count:N-u});continue}for(;N<h&&p.consume(a[N])!==void 0;)x.add(a[N],d++),N++;N>u&&b.push({op:"store",index:f,count:N-u})}for(;f<c;){let u=f;for(;f<c&&!x.has(e[f]);)f++;if(f>u){b.push({op:"insert",index:u,count:f-u});continue}let _={op:"restore",index:f,count:0};for(b.push(_);f<c;){let P=x.consume(e[f]);if(P===void 0)break;_.count==0?(_.storeIndex=P,_.count=1):_.storeIndex+_.count==P?_.count++:(_={op:"restore",index:f,storeIndex:P,count:1},b.push(_)),f++}}return b;function ce(u,_,P){let _e=new ct;for(let Le=_;Le<P;Le++)_e.add(u[Le],Le);return _e}}class ct{constructor(){w(this,Z,new Map)}add(e,t){let i=r(this,Z).get(e);i?i.push(t):r(this,Z).set(e,[t])}delete(e,t){let i=r(this,Z).get(e);if(i){let n=i.indexOf(t);if(n>=0){i.splice(n,1);return}}throw new Error("key/value pair not found")}consume(e){let t=r(this,Z).get(e);if(!(!t||t.length==0))return t.shift()}has(e){return r(this,Z).has(e)}}Z=new WeakMap;const ye=class ye{constructor(e){w(this,g);w(this,ge);w(this,z);w(this,j,!1);w(this,X);w(this,re);w(this,oe);w(this,ae);var t,i;this.itemConstructor=e.data.itemConstructor,this.outer=e.context,this.items=e.data.template.items,this.condition=e.data.template.condition,this.itemKey=e.data.template.itemKey,this.emptyConstructor=e.nodes.length?e.nodes[0]:null,this.itemDoms=[],m(this,ge,(t=l.env.document)==null?void 0:t.createComment(" enter foreach block ")),m(this,z,(i=l.env.document)==null?void 0:i.createComment(" leave foreach block ")),this.itemConstructor.isSingleRoot?(m(this,X,T(this,g,_t)),m(this,oe,T(this,g,Lt)),m(this,re,T(this,g,st)),m(this,ae,T(this,g,rt))):(m(this,X,T(this,g,Et)),m(this,oe,T(this,g,St)),m(this,re,T(this,g,it)),m(this,ae,T(this,g,nt)))}static integrate(e,t){let i={itemConstructor:t.compileTemplate(e.template),template:{items:e.items,condition:e.condition,itemKey:e.itemKey}},n;return e.empty&&(n=[new G(e.empty,t)]),delete e.template,delete e.items,delete e.condition,delete e.itemKey,delete e.empty,{isSingleRoot:!1,data:i,nodes:n}}static transform(e){if(e.foreach===void 0)return e;let t;return e.foreach instanceof Function||Array.isArray(e.foreach)?(t={type:ye,template:e,items:e.foreach},delete e.foreach):(t=Object.assign({},e.foreach,{type:ye,template:e}),delete e.foreach),t}static transformGroup(e){for(let t=1;t<e.length;t++)e[t].else!==void 0&&(e[t-1].foreach!==void 0&&(e[t-1]=ye.transform(e[t-1])),e[t-1].type===ye&&!e[t-1].else&&(delete e[t].else,e[t-1].empty=e[t],e.splice(t,1),t--))}onObservableUpdate(e,t,i){let n={outer:this.outer};if(i==0&&t==0){let o=this.observableItems[e],h=[o],c=null;this.itemKey&&(n.model=o,c=[this.itemKey.call(o,o,n)]),T(this,g,pe).call(this,h,c,e,0,1)}else{let o=null,h=this.observableItems.slice(e,e+i);this.itemKey&&(o=h.map(c=>(n.model=c,this.itemKey.call(c,c,n)))),i&&t?T(this,g,tt).call(this,e,t,h,o):t!=0?r(this,oe).call(this,e,t):i!=0&&r(this,X).call(this,h,o,e,0,i),T(this,g,Ae).call(this)}}get rootNodes(){let e=this.emptyDom?this.emptyDom.rootNodes:[];if(this.itemConstructor.isSingleRoot)return[r(this,ge),...this.itemDoms.map(t=>t.rootNode),...e,r(this,z)];{let t=[r(this,ge)];for(let i=0;i<this.itemDoms.length;i++)t.push(...this.itemDoms[i].rootNodes);return t.push(...e),t.push(r(this,z)),t}}setMounted(e){m(this,j,e),me(this.itemDoms,e)}update(){let e;this.items instanceof Function?e=this.items.call(this.outer.model,this.outer.model,this.outer):e=this.items,e=e??[],this.observableItems!=null&&this.observableItems!=e&&this.observableItems.removeListener(this._onObservableUpdate),Array.isArray(e)&&e.isObservable&&this.observableItems!=e&&(this._onObservableUpdate=this.onObservableUpdate.bind(this),this.observableItems=e,this.observableItems.addListener(this._onObservableUpdate),r(this,oe).call(this,0,this.itemDoms.length),this.itemsLoaded=!1);let t={outer:this.outer},i=null;if(this.observableItems||this.condition&&(e=e.filter(n=>(t.model=n,this.condition.call(n,n,t)))),this.itemKey&&(i=e.map(n=>(t.model=n,this.itemKey.call(n,n,t)))),!this.itemsLoaded){this.itemsLoaded=!0,r(this,X).call(this,e,i,0,0,e.length),T(this,g,Ae).call(this);return}this.observableItems||T(this,g,tt).call(this,0,this.itemDoms.length,e,i)}render(e){e.write("<!-- enter foreach block -->");for(let t=0;t<this.itemDoms.length;t++)this.itemDoms[t].render(e);e.write("<!-- leave foreach block -->")}bind(){var e,t;(t=(e=this.emptyDom)==null?void 0:e.bind)==null||t.call(e)}unbind(){var e,t;(t=(e=this.emptyDom)==null?void 0:e.unbind)==null||t.call(e)}destroy(){this.observableItems!=null&&(this.observableItems.removeListener(this._onObservableUpdate),this.observableItems=null),xe(this.itemDoms),this.itemDoms=null}};ge=new WeakMap,z=new WeakMap,j=new WeakMap,g=new WeakSet,tt=function(e,t,i,n){let o=e+t,h;e==0&&t==this.itemDoms.length?h=this.itemDoms:h=this.itemDoms.slice(e,o);let c;if(n?c=It(h.map(u=>u.context.key),n):i.length>h.length?c=[{op:"insert",index:h.length,count:i.length-h.length}]:i.length<h.length?c=[{op:"delete",index:i.length,count:h.length-i.length}]:c=[],c.length==0){T(this,g,pe).call(this,i,n,e,0,t);return}let p=[],y=[],b={insert:N,delete:d,store:x,restore:ce},f=0;for(let u of c)u.index>f&&(T(this,g,pe).call(this,i,n,e+f,f,u.index-f),f=u.index),b[u.op].call(this,u);f<i.length&&T(this,g,pe).call(this,i,n,e+f,f,i.length-f),r(this,j)&&me(y,!1),xe(y),T(this,g,Ae).call(this);function N(u){f+=u.count;let _=Math.min(y.length,u.count);_&&(r(this,re).call(this,u.index+e,y.splice(0,_)),T(this,g,pe).call(this,i,n,u.index+e,u.index,_)),_<u.count&&r(this,X).call(this,i,n,u.index+e+_,u.index+_,u.count-_)}function d(u){y.push(...r(this,ae).call(this,u.index+e,u.count))}function x(u){p.push(...r(this,ae).call(this,u.index+e,u.count))}function ce(u){f+=u.count,r(this,re).call(this,u.index+e,p.slice(u.storeIndex,u.storeIndex+u.count)),T(this,g,pe).call(this,i,n,u.index+e,u.index,u.count)}},Ae=function(){if(this.itemDoms.length==0)!this.emptyDom&&this.emptyConstructor&&(this.emptyDom=this.emptyConstructor(),r(this,g,fe)&&r(this,z).before(...this.emptyDom.rootNodes),r(this,j)&&this.emptyDom.setMounted(!0)),this.emptyDom&&this.emptyDom.update();else if(this.emptyDom){if(r(this,g,fe))for(var e of this.emptyDom.rootNodes)e.remove();r(this,j)&&this.emptyDome.setMounted(!1),this.emptyDom.destroy(),this.emptyDom=null}},X=new WeakMap,re=new WeakMap,oe=new WeakMap,ae=new WeakMap,fe=function(){var e;return((e=r(this,z))==null?void 0:e.parentNode)!=null},Et=function(e,t,i,n,o){let h=[];for(let c=0;c<o;c++){let p={outer:this.outer,model:e[n+c],key:t==null?void 0:t[n+c],index:i+c};h.push(this.itemConstructor(p))}T(this,g,it).call(this,i,h),r(this,j)&&me(h,!0)},it=function(e,t){if(this.itemDoms.splice(e,0,...t),r(this,g,fe)){let i=[];t.forEach(o=>i.push(...o.rootNodes));let n;e+t.length<this.itemDoms.length?n=this.itemDoms[e+t.length].rootNodes[0]:n=r(this,z),n.before(...i)}},St=function(e,t){let i=T(this,g,nt).call(this,e,t);r(this,j)&&me(i,!1),xe(i)},nt=function(e,t){if(r(this,g,fe))for(let i=0;i<t;i++){let n=this.itemDoms[e+i].rootNodes;for(let o=0;o<n.length;o++)n[o].remove()}return this.itemDoms.splice(e,t)},_t=function(e,t,i,n,o){let h=[];for(let c=0;c<o;c++){let p={outer:this.outer,model:e[n+c],key:t==null?void 0:t[n+c],index:i+c};h.push(this.itemConstructor(p))}T(this,g,st).call(this,i,h),r(this,j)&&me(h,!0)},st=function(e,t){if(this.itemDoms.splice(e,0,...t),r(this,g,fe)){let i=t.map(o=>o.rootNode),n;e+t.length<this.itemDoms.length?n=this.itemDoms[e+t.length].rootNode:n=r(this,z),n.before(...i)}},Lt=function(e,t){let i=T(this,g,rt).call(this,e,t);r(this,j)&&me(i,!1),xe(i)},rt=function(e,t){if(r(this,g,fe))for(let i=0;i<t;i++)this.itemDoms[e+i].rootNode.remove();return this.itemDoms.splice(e,t)},pe=function(e,t,i,n,o){for(let h=0;h<o;h++){let c=this.itemDoms[i+h];c.context.key=t==null?void 0:t[n+h],c.context.index=i+h,c.context.model=e[n+h],c.rebind(),c.update()}};let Be=ye;function xe(a){for(let e=a.length-1;e>=0;e--)a[e].destroy()}function me(a,e){for(let t=a.length-1;t>=0;t--)a[t].setMounted(e)}const $e=class $e{constructor(e){w(this,Re);w(this,U);w(this,A);w(this,F);w(this,le);w(this,R);w(this,de);w(this,ve);w(this,Y);w(this,Q,!0);w(this,be);var t,i;m(this,U,e.context),m(this,ve,e.nodes[1]),m(this,le,(t=l.env.document)==null?void 0:t.createTextNode("")),m(this,de,(i=l.env.document)==null?void 0:i.createTextNode("")),m(this,R,[]),m(this,Q,e.data.ownsContent??!0),e.nodes[0]?this.content=e.nodes[0]():this.content=e.data.content}static integrate(e,t){let i=null;e.content&&typeof e.content=="object"&&(i=e.content,delete e.content);let n={isSingleRoot:!1,data:{ownsContent:e.ownsContent??!0,content:e.content},nodes:[i?new G(i,t):null,e.placeholder?new G(e.placeholder,t):null]};return delete e.content,delete e.placeholder,delete e.ownsContent,n}static transform(e){return e instanceof Function&&!H(e)?{type:$e,content:e}:(e.type=="embed-slot"&&(e.type=$e),e)}static transformGroup(e){for(let t=1;t<e.length;t++)e[t].else!==void 0&&(e[t-1]=$e.transform(e[t-1]),e[t-1].type===$e&&!e[t-1].placeholder&&(delete e[t].else,e[t-1].placeholder=e[t],e.splice(t,1),t--))}get rootNodes(){return[r(this,le),...r(this,R),r(this,de)]}get isSingleRoot(){return!1}get ownsContent(){return r(this,Q)}set ownsContent(e){m(this,Q,e)}get content(){return r(this,A)}set content(e){m(this,A,e),r(this,A)instanceof Function?this.replaceContent(r(this,A).call(r(this,U).model,r(this,U).model,r(this,U))):this.replaceContent(r(this,A))}update(){r(this,A)instanceof Function&&this.replaceContent(r(this,A).call(r(this,U).model,r(this,U).model,r(this,U)))}bind(){var e,t;r(this,Y)&&((t=(e=r(this,F))==null?void 0:e.bind)==null||t.call(e))}unbind(){var e,t;r(this,Y)&&((t=(e=r(this,F))==null?void 0:e.unbind)==null||t.call(e))}get isAttached(){}setMounted(e){var t,i;m(this,be,e),(i=(t=r(this,F))==null?void 0:t.setMounted)==null||i.call(t,e)}replaceContent(e){var t,i,n,o,h,c;if(!(e==r(this,F)||!e&&r(this,Y))){if(r(this,Re,ot)){let p=r(this,le).nextSibling;for(;p!=r(this,de);){let y=p.nextSibling;p.remove(),p=y}}if(r(this,be)&&((i=(t=r(this,F))==null?void 0:t.setMounted)==null||i.call(t,!1)),m(this,R,[]),r(this,Q)&&((o=(n=r(this,F))==null?void 0:n.destroy)==null||o.call(n)),m(this,F,e),m(this,Y,!1),!e)r(this,ve)&&(m(this,F,r(this,ve).call(this,r(this,U))),m(this,Y,!0),m(this,R,r(this,F).rootNodes));else if(e.rootNodes!==void 0)m(this,R,e.rootNodes);else if(Array.isArray(e))m(this,R,e);else if(l.env.Node!==void 0&&e instanceof l.env.Node)m(this,R,[e]);else if(e instanceof O){let p=l.env.document.createElement("span");p.innerHTML=e.html,m(this,R,[...p.childNodes])}else if(typeof e=="string")m(this,R,[l.env.document.createTextNode(e)]);else if(e.render)m(this,R,[]);else throw new Error("Embed slot requires component, array of HTML nodes or a single HTML node");r(this,Re,ot)&&r(this,de).before(...r(this,R)),r(this,be)&&((c=(h=r(this,F))==null?void 0:h.setMounted)==null||c.call(h,!0))}}destroy(){var e,t;r(this,Q)&&((t=(e=r(this,F))==null?void 0:e.destroy)==null||t.call(e))}render(e){var t,i;r(this,F)&&((i=(t=r(this,F)).render)==null||i.call(t,e))}};U=new WeakMap,A=new WeakMap,F=new WeakMap,le=new WeakMap,R=new WeakMap,de=new WeakMap,ve=new WeakMap,Y=new WeakMap,Q=new WeakMap,Re=new WeakSet,ot=function(){var e;return((e=r(this,le))==null?void 0:e.parentNode)!=null},be=new WeakMap;let qe=$e;class Ge{static register(e){this.plugins.push(e)}static transform(e){for(let t of this.plugins)t.transform&&(e=t.transform(e));return e}static transformGroup(e){var t;for(let i of this.plugins)(t=i.transformGroup)==null||t.call(i,e)}}ue(Ge,"plugins",[Be,qe,ke]);class G{constructor(e,t){if(Array.isArray(e)&&(e={$:e}),e._&&!e.type&&(e.type=e._,delete e._),e=Ge.transform(e),H(e)&&(e={type:e}),this.template=e,H(e.type))e.type.integrate?this.kind="integrated":this.kind="component";else if(typeof e=="string")this.kind="text";else if(e instanceof O){if(this.kind="html",this.html=e.html,l.env.document){let i=l.env.document.createElement("div");i.innerHTML=e.html,this.nodes=[...i.childNodes],this.nodes.forEach(n=>n.remove())}}else e instanceof Function?this.kind="dynamic_text":e.type==="comment"?this.kind="comment":e.type===void 0?this.kind="fragment":this.kind="element";if(this.kind==="integrated"&&(e.$&&!e.content&&(e.content=e.$,delete e.$),this.integrated=this.template.type.integrate(this.template,t)),this.kind=="element"&&e.$&&!e.text&&(typeof e.$=="string"||e.$ instanceof O)&&(e.text=e.$,delete e.$),this.kind=="element"||this.kind=="fragment")e.$&&!e.childNodes&&(e.childNodes=e.$,delete e.$),e.childNodes?(Array.isArray(e.childNodes)?e.childNodes=e.childNodes.flat():e.childNodes=[e.childNodes],e.childNodes.forEach(i=>{i._&&!i.type&&(i.type=i._,delete i._)}),Ge.transformGroup(e.childNodes),this.childNodes=this.template.childNodes.map(i=>new G(i,t))):this.childNodes=[];else if(this.isComponent)e.$&&!e.content&&(e.content=e.$,delete e.$);else if(e.childNodes)throw new Error("childNodes only supported on element and fragment nodes")}get isSingleRoot(){return this.isFragment?this.childNodes.length==1&&this.childNodes[0].isSingleRoot:this.isComponent?this.template.type.isSingleRoot:this.isIntegrated?this.integrated.isSingleRoot:this.kind=="html"?this.nodes.length==1:!0}get isComponent(){return this.kind==="component"}get isFragment(){return this.kind==="fragment"}get isIntegrated(){return this.kind==="integrated"}*enumLocalNodes(){if(this.isFragment||(yield this),this.childNodes)for(let e=0;e<this.childNodes.length;e++)yield*this.childNodes[e].enumLocalNodes()}spreadChildDomNodes(){return Array.from(e(this)).filter(t=>t.length>0).join(", ");function*e(t){for(let i=0;i<t.childNodes.length;i++)yield t.childNodes[i].spreadDomNodes()}}spreadDomNodes(){return Array.from(this.enumAllNodes()).join(", ")}*enumAllNodes(){switch(this.kind){case"fragment":for(let e=0;e<this.childNodes.length;e++)yield*this.childNodes[e].enumAllNodes();break;case"component":case"integrated":this.isSingleRoot?yield`${this.name}.rootNode`:yield`...${this.name}.rootNodes`;break;case"html":this.nodes.length>0&&(this.nodes.length>1?yield`...${this.name}`:yield`${this.name}`);break;default:yield this.name}}}function Ot(a,e){let t=1,i=1,n=[],o=null,h=new G(a,e),c=new Map;return{code:y(h,!0).toString(),isSingleRoot:h.isSingleRoot,refs:n};function y(b,f){let N={emit_text_node:Le,emit_html_node:Ht,emit_dynamic_text_node:Jt,emit_comment_node:Wt,emit_fragment_node:Xt,emit_element_node:Yt,emit_integrated_node:Gt,emit_component_node:Zt},d=new We;d.create=d.addFunction("create").code,d.bind=d.addFunction("bind").code,d.update=d.addFunction("update").code,d.unbind=d.addFunction("unbind").code,d.setMounted=d.addFunction("setMounted",["mounted"]).code,d.destroy=d.addFunction("destroy").code;let x;f&&(x=d.addFunction("rebind").code);let ce=new Map;f&&(o=d,o.code.append("let model = context.model;"),o.code.append("let document = env.document;")),d.code.append("create();"),d.code.append("bind();"),d.code.append("update();"),_e(b),d.bind.closure.isEmpty||(d.create.append("bind();"),d.destroy.closure.addProlog().append("unbind();"));let u=[];return b.isSingleRoot&&u.push(`  get rootNode() { return ${b.spreadDomNodes()}; },`),f?(u.push("  context,"),b==h&&c.forEach((s,v)=>u.push(`  get ${v}() { return ${s}; },`)),d.getFunction("bind").isEmpty?x.append("model = context.model"):(x.append("if (model != context.model)"),x.braced(()=>{x.append("unbind();"),x.append("model = context.model"),x.append("bind();")})),u.push("  rebind,")):(u.push("  bind,"),u.push("  unbind,")),d.code.append(["return { ","  update,","  destroy,","  setMounted,",`  get rootNodes() { return [ ${b.spreadDomNodes()} ]; },`,`  isSingleRoot: ${b.isSingleRoot},`,...u,"};"]),d;function _(s){s.template.export?o.addLocal(s.name):d.addLocal(s.name)}function P(){d.update.temp_declared||(d.update.temp_declared=!0,d.update.append("let temp;"))}function _e(s){s.name=`n${t++}`,N[`emit_${s.kind}_node`](s)}function Le(s){_(s),d.create.append(`${s.name} = document.createTextNode(${JSON.stringify(s.template)});`)}function Ht(s){s.nodes.length!=0&&(_(s),s.nodes.length==1?(d.create.append(`${s.name} = refs[${n.length}].cloneNode(true);`),n.push(s.nodes[0])):(d.create.append(`${s.name} = refs[${n.length}].map(x => x.cloneNode(true));`),n.push(s.nodes)))}function Jt(s){_(s);let v=`p${i++}`;d.addLocal(v),d.create.append(`${s.name} = helpers.createTextNode("");`),P(),d.update.append(`temp = ${ne(n.length)};`),d.update.append(`if (temp !== ${v})`),d.update.append(`  ${s.name} = helpers.setNodeText(${s.name}, ${v} = ${ne(n.length)});`),n.push(s.template)}function Wt(s){if(_(s),s.template.text instanceof Function){let v=`p${i++}`;d.addLocal(v),d.create.append(`${s.name} = document.createComment("");`),P(),d.update.append(`temp = ${ne(n.length)};`),d.update.append(`if (temp !== ${v})`),d.update.append(`  ${s.name}.nodeValue = ${v} = temp;`),n.push(s.template.text)}else d.create.append(`${s.name} = document.createComment(${JSON.stringify(s.template.text)});`)}function Gt(s){let v=[],M=!1;if(s.integrated.nodes)for(let $=0;$<s.integrated.nodes.length;$++){let S=s.integrated.nodes[$];if(!S){v.push(null);continue}S.name=`n${t++}`;let C=y(S,!1);C.getFunction("bind").isEmpty||(M=!0);let wt=`${S.name}_constructor_${$+1}`,Kt=d.addFunction(wt,[]);C.appendTo(Kt.code),v.push(wt)}d.update.append(`${s.name}.update()`),M&&(d.bind.append(`${s.name}.bind()`),d.unbind.append(`${s.name}.unbind()`));let D=-1;s.integrated.data&&(D=n.length,n.push(s.integrated.data)),_(s),d.create.append(`${s.name} = new refs[${n.length}]({`,"  context,",`  data: ${s.integrated.data?`refs[${D}]`:"null"},`,`  nodes: [ ${v.join(", ")} ],`,"});"),n.push(s.template.type),d.setMounted.append(`${s.name}.setMounted(mounted);`),d.destroy.append(`${s.name}?.destroy();`),d.destroy.append(`${s.name} = null;`);for(let $ of Object.keys(s.template))if(!Ke(s,$))throw new Error(`Unknown element template key: ${$}`)}function Zt(s){_(s),d.create.append(`${s.name} = new refs[${n.length}]();`),n.push(s.template.type);let v=new Set(s.template.type.slots??[]),M=s.template.update==="auto",D=!1;d.setMounted.append(`${s.name}.setMounted(mounted);`),d.destroy.append(`${s.name}?.destroy();`),d.destroy.append(`${s.name} = null;`);for(let $ of Object.keys(s.template)){if(Ke(s,$)||$=="update")continue;if(v.has($)){if(s.template[$]===void 0)continue;let C=new G(s.template[$],e);_e(C),C.isSingleRoot?d.create.append(`${s.name}${W($)}.content = ${C.name};`):d.create.append(`${s.name}${W($)}.content = [${C.spreadDomNodes()}];`);continue}let S=typeof s.template[$];if(S=="string"||S=="number"||S=="boolean")d.create.append(`${s.name}${W($)} = ${JSON.stringify(s.template[$])}`);else if(S==="function"){M&&!D&&(D=`${s.name}_mod`,d.update.append(`let ${D} = false;`));let C=`p${i++}`;d.addLocal(C);let $t=n.length;P(),d.update.append(`temp = ${ne($t)};`),d.update.append(`if (temp !== ${C})`),M&&(d.update.append("{"),d.update.append(`  ${D} = true;`)),d.update.append(`  ${s.name}${W($)} = ${C} = temp;`),M&&d.update.append("}"),n.push(s.template[$])}else{let C=s.template[$];C instanceof Je&&(C=C.value),d.create.append(`${s.name}${W($)} = refs[${n.length}];`),n.push(C)}}s.template.update&&(typeof s.template.update=="function"?(d.update.append(`if (${ne(n.length)})`),d.update.append(`  ${s.name}.update();`),n.push(s.template.update)):M?D&&(d.update.append(`if (${D})`),d.update.append(`  ${s.name}.update();`)):d.update.append(`${s.name}.update();`))}function Xt(s){bt(s)}function Yt(s){var D;let v=d.current_xmlns,M=s.template.xmlns;M===void 0&&s.template.type=="svg"&&(M="http://www.w3.org/2000/svg"),M==null&&(M=d.current_xmlns),_(s),M?(d.current_xmlns=M,d.create.append(`${s.name} = document.createElementNS(${JSON.stringify(M)}, ${JSON.stringify(s.template.type)});`)):d.create.append(`${s.name} = document.createElement(${JSON.stringify(s.template.type)});`),d.destroy.append(`${s.name} = null;`);for(let $ of Object.keys(s.template))if(!Ke(s,$)){if($=="id"){se(s.template.id,S=>`${s.name}.setAttribute("id", ${S});`);continue}if($=="class"){se(s.template.class,S=>`${s.name}.setAttribute("class", ${S});`);continue}if($.startsWith("class_")){let S=L($.substring(6));se(s.template[$],C=>`helpers.setNodeClass(${s.name}, ${JSON.stringify(S)}, ${C})`);continue}if($=="style"){se(s.template.style,S=>`${s.name}.setAttribute("style", ${S});`);continue}if($.startsWith("style_")){let S=L($.substring(6));se(s.template[$],C=>`helpers.setNodeStyle(${s.name}, ${JSON.stringify(S)}, ${C})`);continue}if($=="display"){if(s.template.display instanceof Function)d.addLocal(`${s.name}_prev_display`),se(s.template[$],S=>`${s.name}_prev_display = helpers.setNodeDisplay(${s.name}, ${S}, ${s.name}_prev_display)`);else if(typeof s.template.display=="string")d.create.append(`${s.name}.style.display = '${s.template.display}';`);else if(s.template.display===!1||s.template.display===null||s.template.display===void 0)d.create.append(`${s.name}.style.display = 'none';`);else if(s.template.display!==!0)throw new Error("display property must be set to string, true, false, or null");continue}if($.startsWith("attr_")){let S=$.substring(5);if(S=="style"||S=="class"||S=="id")throw new Error(`Incorrect attribute: use '${S}' instead of '${$}'`);d.current_xmlns||(S=L(S)),se(s.template[$],C=>`helpers.setElementAttribute(${s.name}, ${JSON.stringify(S)}, ${C})`);continue}if($=="text"){s.template.text instanceof Function?se(s.template.text,S=>`helpers.setElementText(${s.name}, ${S})`):s.template.text instanceof O&&d.create.append(`${s.name}.innerHTML = ${JSON.stringify(s.template.text.html)};`),typeof s.template.text=="string"&&d.create.append(`${s.name}.innerText = ${JSON.stringify(s.template.text)};`);continue}throw new Error(`Unknown element template key: ${$}`)}bt(s),(D=s.childNodes)!=null&&D.length&&d.create.append(`${s.name}.append(${s.spreadChildDomNodes()});`),d.current_xmlns=v}function bt(s){if(s.childNodes)for(let v=0;v<s.childNodes.length;v++)_e(s.childNodes[v])}function Ke(s,v){if(Qt(v))return!0;if(v=="export"){if(typeof s.template.export!="string")throw new Error("'export' must be a string");if(c.has(s.template.export))throw new Error(`duplicate export name '${s.template.export}'`);return c.set(s.template.export,s.name),!0}if(v=="bind"){if(typeof s.template.bind!="string")throw new Error("'bind' must be a string");if(ce.has(s.template.export))throw new Error(`duplicate bind name '${s.template.bind}'`);return ce.set(s.template.bind,!0),d.bind.append(`model${W(s.template.bind)} = ${s.name};`),d.unbind.append(`model${W(s.template.bind)} = null;`),!0}if(v.startsWith("on_")){let M=v.substring(3);if(!(s.template[v]instanceof Function))throw new Error(`event handler for '${v}' is not a function`);s.listenerCount||(s.listenerCount=0),s.listenerCount++;let D=`${s.name}_ev${s.listenerCount}`;return d.addLocal(D),d.create.append(`${D} = helpers.addEventListener(() => model, ${s.name}, ${JSON.stringify(M)}, refs[${n.length}]);`),n.push(s.template[v]),d.destroy.append(`${D}?.();`),d.destroy.append(`${D} = null;`),!0}return v=="debug_create"?(typeof s.template[v]=="function"?(d.create.append(`if (${ne(n.length)})`),d.create.append("  debugger;"),n.push(s.template[v])):s.template[v]&&d.create.append("debugger;"),!0):v=="debug_update"?(typeof s.template[v]=="function"?(d.update.append(`if (${ne(n.length)})`),d.update.append("  debugger;"),n.push(s.template[v])):s.template[v]&&d.update.append("debugger;"),!0):v=="debug_render"}function Qt(s){return s=="type"||s=="childNodes"||s=="xmlns"}function ne(s){return`refs[${s}].call(model, model, context)`}function se(s,v){if(s instanceof Function){let M=`p${i++}`;d.addLocal(M),v(),P(),d.update.append(`temp = ${ne(n.length)};`),d.update.append(`if (temp !== ${M})`),d.update.append(`  ${v(M+" = temp")};`),n.push(s)}else d.create.append(v(JSON.stringify(s)))}}}let kt=1;function ut(a,e){e=e??{},e.compileTemplate=ut;let t=Ot(a,e),i=new Function("env","refs","helpers","context",t.code),n=function(o){return o||(o={}),o.$instanceId=kt++,i(l.env,t.refs,dt,o??{})};return n.isSingleRoot=t.isSingleRoot,n}l.env=null;class ft extends EventTarget{constructor(){super();w(this,K,0);this.browser=!1}enterLoading(){Te(this,K)._++,r(this,K)==1&&this.dispatchEvent(new Event("loading"))}leaveLoading(){Te(this,K)._--,r(this,K)==0&&this.dispatchEvent(new Event("loaded"))}get loading(){return r(this,K)!=0}async load(t){this.enterLoading();try{return await t()}finally{this.leaveLoading()}}}K=new WeakMap;class pt extends ft{constructor(){super(),this.browser=!0,this.document=document,this.compileTemplate=ut,this.window=window,this.requestAnimationFrame=window.requestAnimationFrame.bind(window),this.Node=Node}}function mt(a){l.env=a}typeof document<"u"&&mt(new pt);let gt=[],je=[],Me=null;class Bt{static declare(e){gt.push(e),je.push(e),l.env.browser&&l.env.requestAnimationFrame(xt)}static get all(){return gt.join(`
`)}}function xt(){je.length!=0&&(Me==null&&(Me=document.createElement("style")),Me.innerHTML+=je.join(`
`),je=[],Me.parentNode||document.head.appendChild(Me))}let De=[],Ze=!1;function Ue(a,e){a&&(e=e??0,e!=0&&(Ze=!0),De.push({callback:a,order:e}),De.length==1&&l.env.requestAnimationFrame(function(){let t=De;Ze&&(t.sort((i,n)=>n.order-i.order),Ze=!1),De=[];for(let i=t.length-1;i>=0;i--)t[i].callback()}))}function qt(a){De.length==0?a():Ue(a,Number.MAX_SAFE_INTEGER)}class yt{static compile(){return l.env.compileTemplate(...arguments)}}const te=class te extends EventTarget{constructor(){super();w(this,I);w(this,ee,0);w(this,Pe,!1);this.update=this.update.bind(this),this.invalidate=this.invalidate.bind(this)}static get compiledTemplate(){return this._compiledTemplate||(this._compiledTemplate=this.compileTemplate()),this._compiledTemplate}static compileTemplate(){return yt.compile(this.template)}static get isSingleRoot(){return this.compiledTemplate.isSingleRoot}init(){r(this,I)||m(this,I,new this.constructor.compiledTemplate({model:this}))}get dom(){return r(this,I)||this.init(),r(this,I)}get isSingleRoot(){return this.dom.isSingleRoot}get rootNode(){if(!this.isSingleRoot)throw new Error("rootNode property can't be used on multi-root template");return this.dom.rootNode}get rootNodes(){return this.dom.rootNodes}invalidate(){r(this,I)&&(this.invalid||(this.invalid=!0,te.invalidate(this)))}validate(){this.invalid&&this.update()}static invalidate(t){this._invalidComponents.push(t),this._invalidComponents.length==1&&Ue(()=>{for(let i=0;i<this._invalidComponents.length;i++)this._invalidComponents[i].validate();this._invalidComponents=[]},te.nextFrameOrder)}update(){r(this,I)&&(this.invalid=!1,this.dom.update())}async load(t){Te(this,ee)._++,r(this,ee)==1&&(this.invalidate(),l.env.enterLoading(),this.dispatchEvent(new Event("loading")));try{return await t()}finally{Te(this,ee)._--,r(this,ee)==0&&(this.invalidate(),this.dispatchEvent(new Event("loaded")),l.env.leaveLoading())}}get loading(){return r(this,ee)!=0}set loading(t){throw new Error("setting Component.loading not supported, use load() function")}render(t){this.dom.render(t)}destroy(){r(this,I)&&(r(this,I).destroy(),m(this,I,null))}onMount(){}onUnmount(){}setMounted(t){var i;(i=r(this,I))==null||i.setMounted(t),m(this,Pe,t),t?this.onMount():this.onUnmount()}mount(t){return typeof t=="string"&&(t=document.querySelector(t)),t.append(...this.rootNodes),this.setMounted(!0),this}unmount(){r(this,I)&&this.rootNodes.forEach(t=>t.remove()),this.setMounted(!1)}};I=new WeakMap,ee=new WeakMap,Pe=new WeakMap,ue(te,"_compiledTemplate"),ue(te,"nextFrameOrder",-100),ue(te,"_invalidComponents",[]),ue(te,"template",{});let Xe=te;class jt{static embed(e){return{type:"embed-slot",content:e}}static h(e,t){return{type:`h${e}`,text:t}}static p(e){return{type:"p",text:e}}static a(e,t){return{type:"a",attr_href:e,text:t}}static raw(e){return new O(e)}}const ze=class ze extends Array{constructor(){super(...arguments);w(this,ie,[])}static from(){return new ze(...arguments)}addListener(t){r(this,ie).push(t)}removeListener(t){let i=r(this,ie).indexOf(fn);i>=0&&r(this,ie).splice(i,1)}fire(t,i,n){(i!=0||n!=0)&&r(this,ie).forEach(o=>o(t,i,n))}touch(t){t>=0&&t<this.length&&r(this,ie).forEach(i=>i(t,0,0))}push(){let t=this.length;super.push(...arguments),this.fire(t,0,this.length-t)}pop(){let t=this.length;super.pop(),this.fire(this.length,t-this.length,0)}shift(){let t=this.length;super.shift(...arguments),this.fire(0,t-this.length,0)}unshift(){let t=this.length;super.unshift(...arguments),this.fire(0,0,this.length-t)}splice(t,i){t<0&&(t+=this.length),t>=this.length&&(i=0,t=this.length),i===void 0&&(i=this.length-t),i<0&&(i=0);let n=super.splice(...arguments);return this.fire(t,i,arguments.length>2?arguments.length-2:0),n}sort(){super.sort(...arguments),this.fire(0,this.length,this.length)}setAt(t,i){if(t<0||t>=this.length)throw new Error("Observable array index out of range");this[t]=i,this.fire(t,1,1)}get isObservable(){return!0}static from(t){return new ze(...t)}};ie=new WeakMap;let Ye=ze;function vt(a){let e="^",t=a.length,i;for(let o=0;o<t;o++){i=!0;let h=a[o];if(h=="?")e+="[^\\/]";else if(h=="*")e+="[^\\/]+";else if(h==":"){o++;let c=o;for(;o<t&&n(a[o]);)o++;let p=a.substring(c,o);if(p.length==0)throw new Error("syntax error in url pattern: expected id after ':'");let y="[^\\/]+";if(a[o]=="("){o++,c=o;let b=0;for(;o<t;){if(a[o]=="(")b++;else if(a[o]==")"){if(b==0)break;b--}o++}if(o>=t)throw new Error("syntax error in url pattern: expected ')'");y=a.substring(c,o),o++}if(o<t&&a[o]=="*"||a[o]=="+"){let b=a[o];o++,a[o]=="/"?(e+=`(?<${p}>(?:${y}\\/)${b})`,o++):b=="*"?e+=`(?<${p}>(?:${y}\\/)*(?:${y})?\\/?)`:e+=`(?<${p}>(?:${y}\\/)*(?:${y})\\/?)`,i=!1}else e+=`(?<${p}>${y})`;o--}else h=="/"?(e+="\\"+h,o==a.length-1&&(e+="?")):".$^{}[]()|*+?\\/".indexOf(h)>=0?(e+="\\"+h,i=h!="/"):e+=h}return i&&(e+="\\/?"),e+="$",e;function n(o){return o>="a"&&o<="z"||o>="A"&&o<="Z"||o>="0"&&o<="9"||o=="_"||o=="$"}}class Ut{constructor(e,t){this.el=e,this.targetClass=t,this.entered=!1,this.pendingTransitions=[],this.detecting=!1,this.transitioning=!1,this.el.addEventListener("transitionend",this.onTransitionEndOrCancel.bind(this)),this.el.addEventListener("transitioncancel",this.onTransitionEndOrCancel.bind(this)),this.el.addEventListener("transitionrun",this.onTransitionRun.bind(this))}onTransitionEndOrCancel(e){let t=!1;for(let i=0;i<this.pendingTransitions.length;i++){let n=this.pendingTransitions[i];n.target==e.target&&n.propertyName==e.propertyName&&(this.pendingTransitions.splice(i,1),t=!0)}t&&this.pendingTransitions.length==0&&this.onTransitionsFinished()}onTransitionRun(e){this.detecting&&this.pendingTransitions.push({target:e.target,propertyName:e.propertyName})}detectTransitions(){this.transitioning=!0,this.detecting=!0,this.pendingTransitions=[],requestAnimationFrame(()=>requestAnimationFrame(()=>requestAnimationFrame(()=>{this.detecting=!1,this.pendingTransitions.length==0&&this.onTransitionsFinished()})))}onTransitionsFinished(){this.el.classList.remove(`${this.targetClass}-start-enter`),this.el.classList.remove(`${this.targetClass}-start-leave`),this.el.classList.remove(`${this.targetClass}-enter`),this.el.classList.remove(`${this.targetClass}-leave`),this.entered?this.el.classList.add(this.targetClass):this.el.classList.remove(this.targetClass),this.transitioning=!1}enter(e){if(e){(this.transitioning||!this.entered)&&(this.entered=!0,this.onTransitionsFinished());return}this.entered||(this.entered=!0,this.detectTransitions(),this.el.classList.add(this.targetClass,`${this.targetClass}-enter`,`${this.targetClass}-start-enter`),requestAnimationFrame(()=>requestAnimationFrame(()=>{this.el.classList.remove(`${this.targetClass}-start-enter`)})))}leave(e){if(e){(this.transitioning||this.entered)&&(this.entered=!1,this.onTransitionsFinished());return}this.entered&&(this.entered=!1,this.detectTransitions(),this.el.classList.add(`${this.targetClass}-leave`,`${this.targetClass}-start-leave`),requestAnimationFrame(()=>requestAnimationFrame(()=>{this.el.classList.remove(`${this.targetClass}-start-leave`)})))}toggle(e){this.entered?this.leave():this.enter()}}class Qe{static get(){return{top:window.pageYOffset||document.documentElement.scrollTop,left:window.pageXOffset||document.documentElement.scrollLeft}}static set(e){e?window.scrollTo(e.left,e.top):window.scrollTo(0,0)}}class Vt{constructor(e,t){w(this,Ie);ue(this,"urlMapper");w(this,k,null);w(this,q,null);w(this,he,[]);w(this,we,[]);w(this,Ne,!1);m(this,Ie,e),e&&(this.navigate=e.navigate.bind(e),this.replace=e.navigate.bind(e),this.back=e.back.bind(e)),t&&this.register(t)}start(){return r(this,Ie).start(this)}internalize(e){var t;return((t=this.urlMapper)==null?void 0:t.internalize(e))??new URL(e)}externalize(e){var t;return((t=this.urlMapper)==null?void 0:t.externalize(e))??new URL(e)}get current(){return r(this,k)}get pending(){return r(this,q)}addEventListener(e,t){r(this,he).push({event:e,handler:t})}removeEventListener(e,t){let i=r(this,he).findIndex(n=>n.event==e&&n.handler==t);i>=0&&r(this,he).splice(i,1)}async dispatchEvent(e,t,i,n){for(let o of r(this,he))if(o.event==e){let h=o.handler(i,n);if(t&&await Promise.resolve(h)==!1)return!1}return!0}async load(e,t,i){var o,h,c;i=i??{};let n=r(this,k);if(((o=r(this,k))==null?void 0:o.url.pathname)==e.pathname&&r(this,k).url.search==e.search){let p=(c=(h=r(this,k).handler).hashChange)==null?void 0:c.call(h,r(this,k),i);p!==void 0?i=p:i=Object.assign({},r(this,k),i)}if(i=Object.assign(i,{current:!1,url:e,pathname:e.pathname,state:t}),m(this,q,i),!i.match&&(i=await this.matchUrl(e,t,i),!i))return null;try{await this.tryLoad(i)!==!0&&m(this,q,null)}catch(p){throw this.dispatchCancelEvents(n,i),p}return r(this,q)!=i?(this.dispatchCancelEvents(n,i),null):(m(this,q,null),i)}dispatchCancelEvents(e,t){var i,n,o,h,c;(o=(i=r(this,k))==null?void 0:(n=i.handler).cancelLeave)==null||o.call(n,e,t),(c=(h=t.handler).cancelEnter)==null||c.call(h,e,t),this.dispatchEvent("cancel",!1,e,t)}async tryLoad(e){var n,o,h,c,p,y,b,f;let t=r(this,k),i;if(!(t&&(!await this.dispatchEvent("mayLeave",!0,t,e)||e!=r(this,q)||(i=(o=(n=t.handler).mayLeave)==null?void 0:o.call(n,t,e),await Promise.resolve(i)===!1)||e!=r(this,q)))&&(i=(c=(h=e.handler).mayEnter)==null?void 0:c.call(h,t,e),await Promise.resolve(i)!==!1&&e==r(this,q)&&await this.dispatchEvent("mayEnter",!0,t,e)&&e==r(this,q)))return t&&(t.current=!1),e.current=!0,m(this,k,e),t&&(this.dispatchEvent("didLeave",!1,t,e),(y=t==null?void 0:(p=t.handler).didLeave)==null||y.call(p,t,e)),(f=(b=e.handler).didEnter)==null||f.call(b,t,e),this.dispatchEvent("didEnter",!1,t,e),!0}async matchUrl(e,t,i){r(this,Ne)&&(r(this,we).sort((n,o)=>(n.order??0)-(o.order??0)),m(this,Ne,!1));for(let n of r(this,we)){if(n.pattern&&(i.match=i.pathname.match(n.pattern),!i.match))continue;let o=await Promise.resolve(n.match(i));if(o===!0||o==i)return i.handler=n,i;if(o===null)return null}return i.handler={},i}register(e){Array.isArray(e)||(e=[e]);for(let t of e)typeof t.pattern=="string"&&(t.pattern=new RegExp(vt(t.pattern))),r(this,we).push(t);m(this,Ne,!0)}}Ie=new WeakMap,k=new WeakMap,q=new WeakMap,he=new WeakMap,we=new WeakMap,Ne=new WeakMap;class Pt{constructor(){w(this,Ee,0);w(this,B);w(this,Se,!1)}async start(e){m(this,B,e),l.env.document.body.addEventListener("click",o=>{if(o.defaultPrevented)return;let h=o.target.closest("a");if(h){let c=h.getAttribute("href"),p=new URL(c,l.env.window.location);if(p.origin==l.env.window.location.origin){try{p=r(this,B).internalize(p)}catch{return}if(this.navigate(p))return o.preventDefault(),!0}}}),l.env.window.addEventListener("popstate",async o=>{if(r(this,Se)){m(this,Se,!1);return}let h=r(this,Ee)+1,c=r(this,B).internalize(l.env.window.location),p=o.state??{sequence:this.current.state.sequence+1};await this.load(c,p,{navMode:"pop"})||h==r(this,Ee)&&(m(this,Se,!0),l.env.window.history.go(this.current.state.sequence-p.sequence))});let t=r(this,B).internalize(l.env.window.location),i=l.env.window.history.state??{sequence:0},n=await this.load(t,i,{navMode:"start"});return l.env.window.history.replaceState(i,null),n}get current(){return r(this,B).current}async load(e,t,i){return Te(this,Ee)._++,await r(this,B).load(e,t,i)}back(){this.current.state.sequence==0?(this.replace("/"),this.load("/",{sequence:0},{navMode:"replace"})):l.env.window.history.back()}replace(e){typeof e=="string"&&(e=new URL(e,r(this,B).internalize(l.env.window.location))),this.current.pathname=e.pathname,this.current.url=e,l.env.window.history.replaceState(this.current.state,"",r(this,B).externalize(e))}async navigate(e){typeof e=="string"&&(e=new URL(e,r(this,B).internalize(l.env.window.location)));let t=await this.load(e,{sequence:this.current.state.sequence+1},{navMode:"push"});return t&&(l.env.window.history.pushState(t.state,"",r(this,B).externalize(e)),t)}}Ee=new WeakMap,B=new WeakMap,Se=new WeakMap;class zt{constructor(e){if(this.options=e,this.options.base&&(!this.options.base.startsWith("/")||!this.options.base.endsWith("/")))throw new Error(`UrlMapper base '${this.options.base}' must start and end with '/'`)}internalize(e){if(this.options.base){if(!e.pathname.startsWith(this.options.base))throw new Error(`Can't internalize url '${e}'`);e=new URL(e),e.pathname=e.pathname.substring(this.options.base.length-1)}if(this.options.hash){let t=e.hash.substring(1);t.startsWith("/")||(t="/"+t),e=new URL(`${e.origin}${t}`)}return e}externalize(e){return this.options.hash&&(e=new URL(`${e.origin}/#${e.pathname}${e.search}${e.hash}`)),this.options.base&&(e=new URL(e),e.pathname=this.options.base.slice(0,-1)+e.pathname),e}}class At{constructor(e){w(this,J);w(this,V,{});m(this,J,e),l.env.window.history.scrollRestoration&&(l.env.window.history.scrollRestoration="manual");let t=l.env.window.sessionStorage.getItem("codeonly-view-states");t&&m(this,V,JSON.parse(t)),e.addEventListener("mayLeave",(i,n)=>(this.captureViewState(),!0)),e.addEventListener("mayEnter",(i,n)=>{n.viewState=r(this,V)[n.state.sequence]}),e.addEventListener("didEnter",(i,n)=>{if(n.navMode=="push"){for(let o of Object.keys(r(this,V)))parseInt(o)>n.state.sequence&&delete r(this,V)[o];this.saveViewStates()}lt(l.env,()=>{Ue(()=>{var o,h;if(n.handler.restoreViewState?n.handler.restoreViewState(n.viewState,n):r(this,J).restoreViewState?(h=(o=r(this,J)).restoreViewState)==null||h.call(o,n.viewState,n):Qe.set(n.viewState),l.env.browser){let c=document.getElementById(n.url.hash.substring(1));c==null||c.scrollIntoView()}})})}),l.env.window.addEventListener("beforeunload",i=>{this.captureViewState()})}captureViewState(){var t,i;let e=r(this,J).current;e&&(e.handler.captureViewState?r(this,V)[e.state.sequence]=e.handler.captureViewState(e):r(this,J).captureViewState?r(this,V)[e.state.sequence]=(i=(t=r(this,J)).captureViewState)==null?void 0:i.call(t,e):r(this,V)[e.state.sequence]=Qe.get()),this.saveViewStates()}saveViewStates(){l.env.window.sessionStorage.setItem("codeonly-view-states",JSON.stringify(r(this,V)))}}J=new WeakMap,V=new WeakMap,l.BrowserEnvironment=pt,l.CloakedValue=Je,l.Component=Xe,l.DocumentScrollPosition=Qe,l.EmbedSlot=qe,l.EnvironmentBase=ft,l.ForEachBlock=Be,l.Html=jt,l.HtmlString=O,l.IfBlock=ke,l.ObservableArray=Ye,l.Router=Vt,l.Style=Bt,l.Template=yt,l.Transition=Ut,l.UrlMapper=zt,l.ViewStateRestoration=At,l.WebHistoryRouterDriver=Pt,l.areSetsEqual=He,l.binarySearch=Tt,l.camel_to_dash=L,l.cloak=Rt,l.compareStrings=Ct,l.compareStringsI=Mt,l.deepEqual=at,l.html=Ft,l.htmlEncode=Ce,l.inplace_filter_array=E,l.is_constructor=H,l.member=W,l.nextFrame=Ue,l.postNextFrame=qt,l.setEnvironment=mt,l.urlPattern=vt,l.whenLoaded=lt,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
