(function(h,C){typeof exports=="object"&&typeof module<"u"?C(exports):typeof define=="function"&&define.amd?define(["exports"],C):(h=typeof globalThis<"u"?globalThis:h||self,C(h.codeonly={}))})(this,function(h){"use strict";var Zt=Object.defineProperty;var _t=h=>{throw TypeError(h)};var Xt=(h,C,x)=>C in h?Zt(h,C,{enumerable:!0,configurable:!0,writable:!0,value:x}):h[C]=x;var ge=(h,C,x)=>Xt(h,typeof C!="symbol"?C+"":C,x),it=(h,C,x)=>C.has(h)||_t("Cannot "+x);var o=(h,C,x)=>(it(h,C,"read from private field"),x?x.call(h):C.get(h)),L=(h,C,x)=>C.has(h)?_t("Cannot add the same private member more than once"):C instanceof WeakSet?C.add(h):C.set(h,x),b=(h,C,x,X)=>(it(h,C,"write to private field"),X?X.call(h,x):C.set(h,x),x),D=(h,C,x)=>(it(h,C,"access private method"),x);var Te=(h,C,x,X)=>({set _(Ve){b(h,C,Ve,x)},get _(){return o(h,C,X)}});var Q,E,st,Ae,K,de,he,ce,Nt,rt,St,at,Et,lt,Tt,ot,ye,W,G,M,ue,O,fe,we,ee,te,ne,q,ie,re,Fe,U,V,pe,be,_e,Ne,j,Se,Y,z,me;function C(l,e){for(let t=0;t<l.length;t++)e(l[t],t)||(l.splice(t,1),t--)}function x(l){return l.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}function X(l){return l instanceof Function&&!!l.prototype&&!!l.prototype.constructor}function Ve(l,e){if(l===e)return!0;if(l.size!==e.size)return!1;for(const t of l)if(!e.has(t))return!1;return!0}function dt(l,e){if(l===e||l===void 0&&e===void 0)return!0;if(l===void 0||e===void 0)return!1;if(l===null&&e===null)return!0;if(l===null||e===null||typeof l!="object"||typeof e!="object")return!1;let t=Object.getOwnPropertyNames(l),n=Object.getOwnPropertyNames(e);if(t.length!=n.length)return!1;for(let i of t)if(!Object.hasOwn(e,i)||!dt(l[i],e[i]))return!1;return!0}function Lt(l,e,t){let n=0,i=l.length-1;for(;n<=i;){let r=Math.floor((n+i)/2),u=l[r],f=e(u,t);if(f==0)return r;f<0?n=r+1:i=r-1}return-1-n}function Ct(l,e){return l<e?-1:l>e?1:0}function xt(l,e){return l=l.toLowerCase(),e=e.toLowerCase(),l<e?-1:l>e?1:0}let Ft=/^[a-zA-Z$][a-zA-Z0-9_$]*$/;function A(l){return l.match(Ft)?`.${l}`:`[${JSON.stringify(l)}]`}function ht(l,e){l.loading?l.addEventListener("loaded",e,{once:!0}):e()}class k{constructor(e){this.html=e}}function Dt(l){return new k(l)}class Ie{constructor(e){this.value=e}}function It(l){return new Ie(l)}function ke(){let l=[],e="";function t(...S){for(let N=0;N<S.length;N++){let y=S[N];y.lines?l.push(...y.lines.map(c=>e+c)):Array.isArray(y)?l.push(...y.filter(c=>c!=null).map(c=>e+c)):l.push(...y.split(`
`).map(c=>e+c))}}function n(){e+="  "}function i(){e=e.substring(2)}function r(){return l.join(`
`)+`
`}function u(S){t("{"),n(),S(this),i(),t("}")}function f(...S){let N={pos:this.lines.length};return this.append(S),N.headerLineCount=this.lines.length-N.pos,N}function w(S,...N){this.lines.length==S.pos+S.headerLineCount?this.lines.splice(S.pos,S.headerLineCount):this.append(N)}return{append:t,enterCollapsibleBlock:f,leaveCollapsibleBlock:w,indent:n,unindent:i,braced:u,toString:r,lines:l,get isEmpty(){return l.length==0}}}class Re{constructor(){this.code=ke(),this.code.closure=this,this.functions=[],this.locals=[],this.prologs=[],this.epilogs=[]}get isEmpty(){return this.code.isEmpty&&this.locals.length==0&&this.functions.every(e=>e.code.isEmpty)&&this.prologs.every(e=>e.isEmpty)&&this.epilogs.every(e=>e.isEmpty)}addProlog(){let e=ke();return this.prologs.push(e),e}addEpilog(){let e=ke();return this.epilogs.push(e),e}addLocal(e,t){this.locals.push({name:e,init:t})}addFunction(e,t){t||(t=[]);let n={name:e,args:t,code:new Re};return this.functions.push(n),n.code}getFunction(e){var t;return(t=this.functions.find(n=>n.name==e))==null?void 0:t.code}toString(){let e=ke();return this.appendTo(e),e.toString()}appendTo(e){this.locals.length>0&&e.append(`let ${this.locals.map(t=>t.init?`${t.name} = ${t.init}`:t.name).join(", ")};`);for(let t of this.prologs)e.append(t);e.append(this.code);for(let t of this.functions)e.append(`function ${t.name}(${t.args.join(", ")})`),e.append("{"),e.indent(),t.code.appendTo(e),e.unindent(),e.append("}");for(let t of this.epilogs)e.append(t)}}function oe(l){return l==null?"":(""+l).replace(/["'&<>]/g,function(e){switch(e){case'"':return"&quot;";case"&":return"&amp;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;"}})}class Pe{static rawText(e){return e instanceof k?e.html:oe(e)}static renderToString(e){let t="";return e({write:function(n){t+=n}}),t}static renderComponentToString(e){let t="";return e.render({write:function(n){t+=n}}),t}static rawStyle(e){let t;return e instanceof k?t=e.html:t=oe(e),t=t.trim(),t.endsWith(";")||(t+=";"),t}static rawNamedStyle(e,t){if(!t)return"";let n;return t instanceof k?n=t.html:n=oe(t),n=n.trim(),n+=";",`${e}:${n}`}static createTextNode(e){if(e instanceof k){let t=document.createElement("SPAN");return t.innerHTML=e.html,t}else return document.createTextNode(e)}static setElementText(e,t){t instanceof k?e.innerHTML=t.html:e.innerText=t}static setNodeText(e,t){if(t instanceof k){if(e.nodeType==1)return e.innerHTML=t.html,e;let n=document.createElement("SPAN");return n.innerHTML=t.html,e.replaceWith(n),n}else{if(e.nodeType==3)return e.nodeValue=t,e;let n=document.createTextNode(t);return e.replaceWith(n),n}}static setNodeClass(e,t,n){n?e.classList.add(t):e.classList.remove(t)}static setNodeStyle(e,t,n){n==null?e.style.removeProperty(t):e.style[t]=n}static setNodeDisplay(e,t,n){if(t===!0){n===null?e.style.removeProperty("display"):n!==void 0&&e.style.display!=n&&(e.style.display=n);return}else if(t===!1||t===null||t===void 0){let i=e.style.display;return e.style.display!="none"&&(e.style.display="none"),i??null}else if(typeof t=="string"){let i=e.style.display;return e.style.display!=t&&(e.style.display=t),i??null}}static replaceMany(e,t){var n;if((n=e==null?void 0:e[0])!=null&&n.parentNode){e[0].replaceWith(...t);for(let i=1;i<e.length;i++)e[i].remove()}}static addEventListener(e,t,n,i){function r(u){return i(e(),u)}return t.addEventListener(n,r),function(){t.removeEventListener(n,r)}}}function ct(l){let e=function(){var n;let t=(n=h.env.document)==null?void 0:n.createComment(l);return{get rootNode(){return t},get rootNodes(){return[t]},get isSingleRoot(){return!0},destroy(){},update(){},render(i){i.write(`<!--${oe(l)}-->`)}}};return e.isSingleRoot=!0,e}class Le{static integrate(e,t){let n=[],i=[],r=!1,u=!0;for(let f=0;f<e.branches.length;f++){let w=e.branches[f],S={};if(n.push(S),w.condition instanceof Function?(S.condition=w.condition,r=!1):w.condition!==void 0?(S.condition=()=>w.condition,r=!!w.condition):(S.condition=()=>!0,r=!0),w.template!==void 0){let N=new H(w.template,t);N.isSingleRoot||(u=!1),S.nodeIndex=i.length,i.push(N)}}return delete e.branches,r||n.push({condition:()=>!0}),{isSingleRoot:u,wantsUpdate:!0,nodes:i,data:n}}static transform(e){if(e.if===void 0)return e;let t={type:Le,branches:[{template:e,condition:e.if}]};return delete e.if,t}static transformGroup(e){let t=null;for(let n=0;n<e.length;n++){let i=e[n];if(i.if)t={type:Le,branches:[{condition:i.if,template:i}]},delete i.if,e.splice(n,1,t);else if(i.elseif){if(!t)throw new Error("template has 'elseif' without a preceeding condition");t.branches.push({condition:i.elseif,template:i}),delete i.elseif,e.splice(n,1),n--}else if(i.else!==void 0){if(!t)throw new Error("template has 'else' without a preceeding condition");t.branches.push({condition:!0,template:i}),delete i.else,t=null,e.splice(n,1),n--}else t=null}}constructor(e){this.branches=e.data,this.branch_constructors=[],this.context=e.context;for(let t of this.branches)t.nodeIndex!==void 0?this.branch_constructors.push(e.nodes[t.nodeIndex]):this.branch_constructors.push(ct(" IfBlock placeholder "));this.activeBranchIndex=-1,this.activeBranch=ct(" IfBlock placeholder ")()}destroy(){this.activeBranch.destroy()}update(){this.switchActiveBranch(),this.activeBranch.update()}render(e){this.activeBranch.render(e)}unbind(){var e,t;(t=(e=this.activeBranch).unbind)==null||t.call(e)}bind(){var e,t;(t=(e=this.activeBranch).bind)==null||t.call(e)}switchActiveBranch(e){let t=this.resolveActiveBranch();if(t!=this.activeBranchIndex){let n=this.activeBranch;this.activeBranchIndex=t,this.activeBranch=this.branch_constructors[t](),Pe.replaceMany(n.rootNodes,this.activeBranch.rootNodes),n.destroy()}}resolveActiveBranch(){for(let e=0;e<this.branches.length;e++)if(this.branches[e].condition.call(this.context.model,this.context.model,this.context))return e;throw new Error("internal error, IfBlock didn't resolve to a branch")}get rootNodes(){return this.activeBranch.rootNodes}get rootNode(){return this.activeBranch.rootNode}}function kt(l,e){let t=Math.min(l.length,e.length),n=Math.max(l.length,e.length),i=0;for(;i<t&&l[i]==e[i];)i++;if(i==n)return[];if(i==l.length)return[{op:"insert",index:l.length,count:e.length-l.length}];let r=0;for(;r<t-i&&l[l.length-r-1]==e[e.length-r-1];)r++;if(r==l.length)return[{op:"insert",index:0,count:e.length-l.length}];if(i+r==l.length)return[{op:"insert",index:i,count:e.length-l.length}];if(i+r==e.length)return[{op:"delete",index:i,count:l.length-e.length}];let u=l.length-r,f=e.length-r,w=J(e,i,f),S=null,N=[],y=i,c=i;for(;y<f;){for(;y<f&&l[c]==e[y];)w.delete(e[y],y),y++,c++;let m=y,T=c;for(;c<u&&!w.has(l[c]);)c++;if(c>T){N.push({op:"delete",index:m,count:c-T});continue}for(S||(S=J(l,y,u));y<f&&!S.has(e[y]);)w.delete(e[y],y),y++;if(y>m){N.push({op:"insert",index:m,count:y-m});continue}break}if(y==f)return N;let a=0,I=new ut;for(;c<u;){let m=c;for(;c<u&&!w.has(l[c]);)c++;if(c>m){N.push({op:"delete",index:y,count:c-m});continue}for(;c<u&&w.consume(l[c])!==void 0;)I.add(l[c],a++),c++;c>m&&N.push({op:"store",index:y,count:c-m})}for(;y<f;){let m=y;for(;y<f&&!I.has(e[y]);)y++;if(y>m){N.push({op:"insert",index:m,count:y-m});continue}let T={op:"restore",index:y,count:0};for(N.push(T);y<f;){let R=I.consume(e[y]);if(R===void 0)break;T.count==0?(T.storeIndex=R,T.count=1):T.storeIndex+T.count==R?T.count++:(T={op:"restore",index:y,storeIndex:R,count:1},N.push(T)),y++}}return N;function J(m,T,R){let ae=new ut;for(let le=T;le<R;le++)ae.add(m[le],le);return ae}}class ut{constructor(){L(this,Q,new Map)}add(e,t){let n=o(this,Q).get(e);n?n.push(t):o(this,Q).set(e,[t])}delete(e,t){let n=o(this,Q).get(e);if(n){let i=n.indexOf(t);if(i>=0){n.splice(i,1);return}}throw new Error("key/value pair not found")}consume(e){let t=o(this,Q).get(e);if(!(!t||t.length==0))return t.shift()}has(e){return o(this,Q).has(e)}}Q=new WeakMap;const $e=class $e{constructor(e){L(this,E);L(this,K);L(this,de);L(this,he);L(this,ce);var t,n;this.itemConstructor=e.data.itemConstructor,this.outer=e.context,this.items=e.data.template.items,this.condition=e.data.template.condition,this.itemKey=e.data.template.itemKey,this.emptyConstructor=e.nodes.length?e.nodes[0]:null,this.itemDoms=[],this.headSentinal=(t=h.env.document)==null?void 0:t.createComment(" enter foreach block "),this.tailSentinal=(n=h.env.document)==null?void 0:n.createComment(" leave foreach block "),this.itemConstructor.isSingleRoot?(b(this,K,D(this,E,Et)),b(this,he,D(this,E,Tt)),b(this,de,D(this,E,lt)),b(this,ce,D(this,E,ot))):(b(this,K,D(this,E,Nt)),b(this,he,D(this,E,St)),b(this,de,D(this,E,rt)),b(this,ce,D(this,E,at)))}static integrate(e,t){let n={itemConstructor:t.compileTemplate(e.template),template:{items:e.items,condition:e.condition,itemKey:e.itemKey}},i;return e.empty&&(i=[new H(e.empty,t)]),delete e.template,delete e.items,delete e.condition,delete e.itemKey,delete e.empty,{isSingleRoot:!1,wantsUpdate:!0,data:n,nodes:i}}static transform(e){if(e.foreach===void 0)return e;let t;return e.foreach instanceof Function||Array.isArray(e.foreach)?(t={type:$e,template:e,items:e.foreach},delete e.foreach):(t=Object.assign({},e.foreach,{type:$e,template:e}),delete e.foreach),t}static transformGroup(e){for(let t=1;t<e.length;t++)e[t].else!==void 0&&(e[t-1].foreach!==void 0&&(e[t-1]=$e.transform(e[t-1])),e[t-1].type===$e&&!e[t-1].else&&(delete e[t].else,e[t-1].empty=e[t],e.splice(t,1),t--))}onObservableUpdate(e,t,n){let i={outer:this.outer};if(n==0&&t==0){let r=this.observableItems[e],u=[r],f=null;this.itemKey&&(i.model=r,f=[this.itemKey.call(r,r,i)]),D(this,E,ye).call(this,u,f,e,0,1)}else{let r=null,u=this.observableItems.slice(e,e+n);this.itemKey&&(r=u.map(f=>(i.model=f,this.itemKey.call(f,f,i)))),n&&t?D(this,E,st).call(this,e,t,u,r):t!=0?o(this,he).call(this,e,t):n!=0&&o(this,K).call(this,u,r,e,0,n),D(this,E,Ae).call(this)}}get rootNodes(){let e=this.emptyDom?this.emptyDom.rootNodes:[];if(this.itemConstructor.isSingleRoot)return[this.headSentinal,...this.itemDoms.map(t=>t.rootNode),...e,this.tailSentinal];{let t=[this.headSentinal];for(let n=0;n<this.itemDoms.length;n++)t.push(...this.itemDoms[n].rootNodes);return t.push(...e),t.push(this.tailSentinal),t}}update(){let e;this.items instanceof Function?e=this.items.call(this.outer.model,this.outer.model,this.outer):e=this.items,e=e??[],this.observableItems!=null&&this.observableItems!=e&&this.observableItems.removeListener(this._onObservableUpdate),Array.isArray(e)&&e.isObservable&&this.observableItems!=e&&(this._onObservableUpdate=this.onObservableUpdate.bind(this),this.observableItems=e,this.observableItems.addListener(this._onObservableUpdate),o(this,he).call(this,0,this.itemDoms.length),this.itemsLoaded=!1);let t={outer:this.outer},n=null;if(this.observableItems||this.condition&&(e=e.filter(i=>(t.model=i,this.condition.call(i,i,t)))),this.itemKey&&(n=e.map(i=>(t.model=i,this.itemKey.call(i,i,t)))),!this.itemsLoaded){this.itemsLoaded=!0,o(this,K).call(this,e,n,0,0,e.length),D(this,E,Ae).call(this);return}this.observableItems||D(this,E,st).call(this,0,this.itemDoms.length,e,n)}render(e){e.write("<!-- enter foreach block -->");for(let t=0;t<this.itemDoms.length;t++)this.itemDoms[t].render(e);e.write("<!-- leave foreach block -->")}bind(){var e,t;(t=(e=this.emptyDom)==null?void 0:e.bind)==null||t.call(e)}unbind(){var e,t;(t=(e=this.emptyDom)==null?void 0:e.unbind)==null||t.call(e)}destroy(){this.observableItems!=null&&(this.observableItems.removeListener(this._onObservableUpdate),this.observableItems=null);for(let e=0;e<this.itemDoms.length;e++)this.itemDoms[e].destroy();this.itemDoms=null}get isAttached(){var e;return((e=this.tailSentinal)==null?void 0:e.parentNode)!=null}};E=new WeakSet,st=function(e,t,n,i){let r=e+t,u;e==0&&t==this.itemDoms.length?u=this.itemDoms:u=this.itemDoms.slice(e,r);let f;if(i?f=kt(u.map(m=>m.context.key),i):n.length>u.length?f=[{op:"insert",index:u.length,count:n.length-u.length}]:n.length<u.length?f=[{op:"delete",index:n.length,count:u.length-n.length}]:f=[],f.length==0){D(this,E,ye).call(this,n,i,e,0,t);return}let w=[],S=[],N={insert:c,delete:a,store:I,restore:J},y=0;for(let m of f)m.index>y&&(D(this,E,ye).call(this,n,i,e+y,y,m.index-y),y=m.index),N[m.op].call(this,m);y<n.length&&D(this,E,ye).call(this,n,i,e+y,y,n.length-y);for(let m=S.length-1;m>=0;m--)S[m].destroy();D(this,E,Ae).call(this);function c(m){y+=m.count;let T=Math.min(S.length,m.count);T&&(o(this,de).call(this,m.index+e,S.splice(0,T)),D(this,E,ye).call(this,n,i,m.index+e,m.index,T)),T<m.count&&o(this,K).call(this,n,i,m.index+e+T,m.index+T,m.count-T)}function a(m){S.push(...o(this,ce).call(this,m.index+e,m.count))}function I(m){w.push(...o(this,ce).call(this,m.index+e,m.count))}function J(m){y+=m.count,o(this,de).call(this,m.index+e,w.slice(m.storeIndex,m.storeIndex+m.count)),D(this,E,ye).call(this,n,i,m.index+e,m.index,m.count)}},Ae=function(){if(this.itemDoms.length==0)!this.emptyDom&&this.emptyConstructor&&(this.emptyDom=this.emptyConstructor(),this.isAttached&&this.tailSentinal.before(...this.emptyDom.rootNodes)),this.emptyDom&&this.emptyDom.update();else if(this.emptyDom){if(this.isAttached)for(var e of this.emptyDom.rootNodes)e.remove();this.emptyDom.destroy(),this.emptyDom=null}},K=new WeakMap,de=new WeakMap,he=new WeakMap,ce=new WeakMap,Nt=function(e,t,n,i,r){let u=[];for(let f=0;f<r;f++){let w={outer:this.outer,model:e[i+f],key:t==null?void 0:t[i+f],index:n+f};u.push(this.itemConstructor(w))}D(this,E,rt).call(this,n,u)},rt=function(e,t){if(this.itemDoms.splice(e,0,...t),this.isAttached){let n=[];t.forEach(r=>n.push(...r.rootNodes));let i;e+t.length<this.itemDoms.length?i=this.itemDoms[e+t.length].rootNodes[0]:i=this.tailSentinal,i.before(...n)}},St=function(e,t){let n=D(this,E,at).call(this,e,t);for(let i=n.length-1;i>=0;i--)n[i].destroy()},at=function(e,t){let n=this.isAttached;for(let i=0;i<t;i++)if(n){let r=this.itemDoms[e+i].rootNodes;for(let u=0;u<r.length;u++)r[u].remove()}return this.itemDoms.splice(e,t)},Et=function(e,t,n,i,r){let u=[];for(let f=0;f<r;f++){let w={outer:this.outer,model:e[i+f],key:t==null?void 0:t[i+f],index:n+f};u.push(this.itemConstructor(w))}D(this,E,lt).call(this,n,u)},lt=function(e,t){if(this.itemDoms.splice(e,0,...t),this.isAttached){let n=t.map(r=>r.rootNode),i;e+t.length<this.itemDoms.length?i=this.itemDoms[e+t.length].rootNode:i=this.tailSentinal,i.before(...n)}},Tt=function(e,t){let n=D(this,E,ot).call(this,e,t);for(let i=n.length-1;i>=0;i--)n[i].destroy()},ot=function(e,t){let n=this.isAttached;for(let i=0;i<t;i++)n&&this.itemDoms[e+i].rootNode.remove();return this.itemDoms.splice(e,t)},ye=function(e,t,n,i,r){for(let u=0;u<r;u++){let f=this.itemDoms[n+u];f.context.key=t==null?void 0:t[i+u],f.context.index=n+u,f.context.model=e[i+u],f.rebind(),f.update()}};let Oe=$e;const ve=class ve{constructor(e){L(this,W);L(this,G);L(this,M);L(this,ue);L(this,O);L(this,fe);L(this,we);L(this,ee);L(this,te,!0);var t,n;b(this,W,e.context),b(this,we,e.nodes[1]),b(this,ue,(t=h.env.document)==null?void 0:t.createTextNode("")),b(this,fe,(n=h.env.document)==null?void 0:n.createTextNode("")),b(this,O,[]),b(this,te,e.data.ownsContent??!0),e.nodes[0]?this.content=e.nodes[0]():this.content=e.data.content}static integrate(e,t){let n=null;e.content&&typeof e.content=="object"&&(n=e.content,delete e.content);let i={isSingleRoot:!1,wantsUpdate:!0,data:{ownsContent:e.ownsContent??!0,content:e.content},nodes:[n?new H(n,t):null,e.placeholder?new H(e.placeholder,t):null]};return delete e.content,delete e.placeholder,delete e.ownsContent,i}static transform(e){return e instanceof Function&&!X(e)?{type:ve,content:e}:(e.type=="embed-slot"&&(e.type=ve),e)}static transformGroup(e){for(let t=1;t<e.length;t++)e[t].else!==void 0&&(e[t-1]=ve.transform(e[t-1]),e[t-1].type===ve&&!e[t-1].placeholder&&(delete e[t].else,e[t-1].placeholder=e[t],e.splice(t,1),t--))}get rootNodes(){return[o(this,ue),...o(this,O),o(this,fe)]}get isSingleRoot(){return!1}get ownsContent(){return o(this,te)}set ownsContent(e){b(this,te,e)}get content(){return o(this,G)}set content(e){b(this,G,e),o(this,G)instanceof Function?this.replaceContent(o(this,G).call(o(this,W).model,o(this,W).model,o(this,W))):this.replaceContent(o(this,G))}update(){o(this,G)instanceof Function&&this.replaceContent(o(this,G).call(o(this,W).model,o(this,W).model,o(this,W)))}bind(){var e,t;o(this,ee)&&((t=(e=o(this,M))==null?void 0:e.bind)==null||t.call(e))}unbind(){var e,t;o(this,ee)&&((t=(e=o(this,M))==null?void 0:e.unbind)==null||t.call(e))}get isAttached(){var e;return((e=o(this,ue))==null?void 0:e.parentNode)!=null}replaceContent(e){var t,n;if(!(e==o(this,M)||!e&&o(this,ee))){if(this.isAttached){let i=o(this,ue).nextSibling;for(;i!=o(this,fe);){let r=i.nextSibling;i.remove(),i=r}}if(b(this,O,[]),o(this,te)&&((n=(t=o(this,M))==null?void 0:t.destroy)==null||n.call(t)),b(this,M,e),b(this,ee,!1),!e)o(this,we)&&(b(this,M,o(this,we).call(this,o(this,W))),b(this,ee,!0),b(this,O,o(this,M).rootNodes));else if(e.rootNodes!==void 0)b(this,O,e.rootNodes);else if(Array.isArray(e))b(this,O,e);else if(h.env.Node!==void 0&&e instanceof h.env.Node)b(this,O,[e]);else if(e instanceof k){let i=h.env.document.createElement("span");i.innerHTML=e.html,b(this,O,[...i.childNodes])}else if(typeof e=="string")b(this,O,[h.env.document.createTextNode(e)]);else if(e.render)b(this,O,[]);else throw new Error("Embed slot requires component, array of HTML nodes or a single HTML node");this.isAttached&&o(this,fe).before(...o(this,O))}}destroy(){var e,t;o(this,te)&&((t=(e=o(this,M))==null?void 0:e.destroy)==null||t.call(e))}render(e){var t,n;o(this,M)&&((n=(t=o(this,M)).render)==null||n.call(t,e))}};W=new WeakMap,G=new WeakMap,M=new WeakMap,ue=new WeakMap,O=new WeakMap,fe=new WeakMap,we=new WeakMap,ee=new WeakMap,te=new WeakMap;let Be=ve;class We{static register(e){this.plugins.push(e)}static transform(e){for(let t of this.plugins)t.transform&&(e=t.transform(e));return e}static transformGroup(e){var t;for(let n of this.plugins)(t=n.transformGroup)==null||t.call(n,e)}}ge(We,"plugins",[Oe,Be,Le]);class H{constructor(e,t){if(Array.isArray(e)&&(e={$:e}),e._&&!e.type&&(e.type=e._,delete e._),e=We.transform(e),X(e)&&(e={type:e}),this.template=e,X(e.type))e.type.integrate?this.kind="integrated":this.kind="component";else if(typeof e=="string")this.kind="text";else if(e instanceof k){if(this.kind="html",this.html=e.html,h.env.document){let n=h.env.document.createElement("div");n.innerHTML=e.html,this.nodes=[...n.childNodes],this.nodes.forEach(i=>i.remove())}}else e instanceof Function?this.kind="dynamic_text":e.type==="comment"?this.kind="comment":e.type===void 0?this.kind="fragment":this.kind="element";if(this.kind==="integrated"&&(e.$&&!e.content&&(e.content=e.$,delete e.$),this.integrated=this.template.type.integrate(this.template,t)),this.kind=="element"&&e.$&&!e.text&&(typeof e.$=="string"||e.$ instanceof k)&&(e.text=e.$,delete e.$),this.kind=="element"||this.kind=="fragment")e.$&&!e.childNodes&&(e.childNodes=e.$,delete e.$),e.childNodes?(Array.isArray(e.childNodes)?e.childNodes=e.childNodes.flat():e.childNodes=[e.childNodes],e.childNodes.forEach(n=>{n._&&!n.type&&(n.type=n._,delete n._)}),We.transformGroup(e.childNodes),this.childNodes=this.template.childNodes.map(n=>new H(n,t))):this.childNodes=[];else if(this.isComponent)e.$&&!e.content&&(e.content=e.$,delete e.$);else if(e.childNodes)throw new Error("childNodes only supported on element and fragment nodes")}get isSingleRoot(){return this.isFragment?this.childNodes.length==1&&this.childNodes[0].isSingleRoot:this.isComponent?this.template.type.isSingleRoot:this.isIntegrated?this.integrated.isSingleRoot:this.kind=="html"?this.nodes.length==1:!0}get isComponent(){return this.kind==="component"}get isFragment(){return this.kind==="fragment"}get isIntegrated(){return this.kind==="integrated"}*enumLocalNodes(){if(this.isFragment||(yield this),this.childNodes)for(let e=0;e<this.childNodes.length;e++)yield*this.childNodes[e].enumLocalNodes()}spreadChildDomNodes(){return Array.from(e(this)).filter(t=>t.length>0).join(", ");function*e(t){for(let n=0;n<t.childNodes.length;n++)yield t.childNodes[n].spreadDomNodes()}}spreadDomNodes(){return Array.from(this.enumAllNodes()).join(", ")}*enumAllNodes(){switch(this.kind){case"fragment":for(let e=0;e<this.childNodes.length;e++)yield*this.childNodes[e].enumAllNodes();break;case"component":case"integrated":this.isSingleRoot?yield`${this.name}.rootNode`:yield`...${this.name}.rootNodes`;break;case"html":this.nodes.length>0&&(this.nodes.length>1?yield`...${this.name}`:yield`${this.name}`);break;default:yield this.name}}}function Rt(l,e){let t=1,n=1,i=[],r=null,u=new H(l,e),f=new Map;return{code:S(u,!0).toString(),isSingleRoot:u.isSingleRoot,refs:i};function S(N,y){let c={emit_text_node:le,emit_html_node:Ye,emit_dynamic_text_node:Qe,emit_comment_node:Ke,emit_fragment_node:nt,emit_element_node:je,emit_integrated_node:et,emit_component_node:tt},a=new Re;a.create=a.addFunction("create").code,a.bind=a.addFunction("bind").code,a.update=a.addFunction("update").code,a.unbind=a.addFunction("unbind").code,a.destroy=a.addFunction("destroy").code;let I;y&&(I=a.addFunction("rebind").code);let J=new Map;y&&(r=a,r.code.append("let model = context.model;"),r.code.append("let document = env.document;")),a.code.append("create();"),a.code.append("bind();"),a.code.append("update();"),ae(N);for(let s of N.enumLocalNodes())d(s);a.bind.closure.isEmpty||(a.create.append("bind();"),a.destroy.closure.addProlog().append("unbind();"));let m=[];return N.isSingleRoot&&m.push(`  get rootNode() { return ${N.spreadDomNodes()}; },`),y?(m.push("  context,"),N==u&&f.forEach((s,g)=>m.push(`  get ${g}() { return ${s}; },`)),a.getFunction("bind").isEmpty?I.append("model = context.model"):(I.append("if (model != context.model)"),I.braced(()=>{I.append("unbind();"),I.append("model = context.model"),I.append("bind();")})),m.push("  rebind,")):(m.push("  bind,"),m.push("  unbind,")),a.code.append(["return { ","  update,","  destroy,",`  get rootNodes() { return [ ${N.spreadDomNodes()} ]; },`,`  isSingleRoot: ${N.isSingleRoot},`,...m,"};"]),a;function T(s){s.template.export?r.addLocal(s.name):a.addLocal(s.name)}function R(){a.update.temp_declared||(a.update.temp_declared=!0,a.update.append("let temp;"))}function ae(s){s.name=`n${t++}`,c[`emit_${s.kind}_node`](s)}function le(s){T(s),a.create.append(`${s.name} = document.createTextNode(${JSON.stringify(s.template)});`)}function Ye(s){s.nodes.length!=0&&(T(s),s.nodes.length==1?(a.create.append(`${s.name} = refs[${i.length}].cloneNode(true);`),i.push(s.nodes[0])):(a.create.append(`${s.name} = refs[${i.length}].map(x => x.cloneNode(true));`),i.push(s.nodes)))}function Qe(s){T(s);let g=`p${n++}`;a.addLocal(g),a.create.append(`${s.name} = helpers.createTextNode("");`),R(),a.update.append(`temp = ${B(i.length)};`),a.update.append(`if (temp !== ${g})`),a.update.append(`  ${s.name} = helpers.setNodeText(${s.name}, ${g} = ${B(i.length)});`),i.push(s.template)}function Ke(s){if(T(s),s.template.text instanceof Function){let g=`p${n++}`;a.addLocal(g),a.create.append(`${s.name} = document.createComment("");`),R(),a.update.append(`temp = ${B(i.length)};`),a.update.append(`if (temp !== ${g})`),a.update.append(`  ${s.name}.nodeValue = ${g} = temp;`),i.push(s.template.text)}else a.create.append(`${s.name} = document.createComment(${JSON.stringify(s.template.text)});`)}function et(s){let g=[],p=!1;if(s.integrated.nodes)for(let v=0;v<s.integrated.nodes.length;v++){let _=s.integrated.nodes[v];if(!_){g.push(null);continue}_.name=`n${t++}`;let F=S(_,!1);F.getFunction("bind").isEmpty||(p=!0);let bt=`${_.name}_constructor_${v+1}`,Gt=a.addFunction(bt,[]);F.appendTo(Gt.code),g.push(bt)}s.integrated.wantsUpdate&&a.update.append(`${s.name}.update()`),p&&(a.bind.append(`${s.name}.bind()`),a.unbind.append(`${s.name}.unbind()`));let $=-1;s.integrated.data&&($=i.length,i.push(s.integrated.data)),T(s),a.create.append(`${s.name} = new refs[${i.length}]({`,"  context,",`  data: ${s.integrated.data?`refs[${$}]`:"null"},`,`  nodes: [ ${g.join(", ")} ],`,"});"),i.push(s.template.type);for(let v of Object.keys(s.template))if(!De(s,v))throw new Error(`Unknown element template key: ${v}`)}function tt(s){T(s),a.create.append(`${s.name} = new refs[${i.length}]();`),i.push(s.template.type);let g=new Set(s.template.type.slots??[]),p=s.template.update==="auto",$=!1;for(let v of Object.keys(s.template)){if(De(s,v)||v=="update")continue;if(g.has(v)){if(s.template[v]===void 0)continue;let F=new H(s.template[v],e);ae(F),F.isSingleRoot?a.create.append(`${s.name}${A(v)}.content = ${F.name};`):a.create.append(`${s.name}${A(v)}.content = [${F.spreadDomNodes()}];`);continue}let _=typeof s.template[v];if(_=="string"||_=="number"||_=="boolean")a.create.append(`${s.name}${A(v)} = ${JSON.stringify(s.template[v])}`);else if(_==="function"){p&&!$&&($=`${s.name}_mod`,a.update.append(`let ${$} = false;`));let F=`p${n++}`;a.addLocal(F);let vt=i.length;R(),a.update.append(`temp = ${B(vt)};`),a.update.append(`if (temp !== ${F})`),p&&(a.update.append("{"),a.update.append(`  ${$} = true;`)),a.update.append(`  ${s.name}${A(v)} = ${F} = temp;`),p&&a.update.append("}"),i.push(s.template[v])}else{let F=s.template[v];F instanceof Ie&&(F=F.value),a.create.append(`${s.name}${A(v)} = refs[${i.length}];`),i.push(F)}}s.template.update&&(typeof s.template.update=="function"?(a.update.append(`if (${B(i.length)})`),a.update.append(`  ${s.name}.update();`),i.push(s.template.update)):p?$&&(a.update.append(`if (${$})`),a.update.append(`  ${s.name}.update();`)):a.update.append(`${s.name}.update();`))}function nt(s){Ee(s)}function je(s){var $;let g=a.current_xmlns,p=s.template.xmlns;p===void 0&&s.template.type=="svg"&&(p="http://www.w3.org/2000/svg"),p==null&&(p=a.current_xmlns),T(s),p?(a.current_xmlns=p,a.create.append(`${s.name} = document.createElementNS(${JSON.stringify(p)}, ${JSON.stringify(s.template.type)});`)):a.create.append(`${s.name} = document.createElement(${JSON.stringify(s.template.type)});`);for(let v of Object.keys(s.template))if(!De(s,v)){if(v=="id"){Z(s.template.id,_=>`${s.name}.setAttribute("id", ${_});`);continue}if(v=="class"){Z(s.template.class,_=>`${s.name}.setAttribute("class", ${_});`);continue}if(v.startsWith("class_")){let _=x(v.substring(6));Z(s.template[v],F=>`helpers.setNodeClass(${s.name}, ${JSON.stringify(_)}, ${F})`);continue}if(v=="style"){Z(s.template.style,_=>`${s.name}.setAttribute("style", ${_});`);continue}if(v.startsWith("style_")){let _=x(v.substring(6));Z(s.template[v],F=>`helpers.setNodeStyle(${s.name}, ${JSON.stringify(_)}, ${F})`);continue}if(v=="display"){if(s.template.display instanceof Function)a.addLocal(`${s.name}_prev_display`),Z(s.template[v],_=>`${s.name}_prev_display = helpers.setNodeDisplay(${s.name}, ${_}, ${s.name}_prev_display)`);else if(typeof s.template.display=="string")a.create.append(`${s.name}.style.display = '${s.template.display}';`);else if(s.template.display===!1||s.template.display===null||s.template.display===void 0)a.create.append(`${s.name}.style.display = 'none';`);else if(s.template.display!==!0)throw new Error("display property must be set to string, true, false, or null");continue}if(v.startsWith("attr_")){let _=v.substring(5);if(_=="style"||_=="class"||_=="id")throw new Error(`Incorrect attribute: use '${_}' instead of '${v}'`);a.current_xmlns||(_=x(_)),Z(s.template[v],F=>`${s.name}.setAttribute(${JSON.stringify(_)}, ${F})`);continue}if(v=="text"){s.template.text instanceof Function?Z(s.template.text,_=>`helpers.setElementText(${s.name}, ${_})`):s.template.text instanceof k&&a.create.append(`${s.name}.innerHTML = ${JSON.stringify(s.template.text.html)};`),typeof s.template.text=="string"&&a.create.append(`${s.name}.innerText = ${JSON.stringify(s.template.text)};`);continue}throw new Error(`Unknown element template key: ${v}`)}Ee(s),($=s.childNodes)!=null&&$.length&&a.create.append(`${s.name}.append(${s.spreadChildDomNodes()});`),a.current_xmlns=g}function Ee(s){if(s.childNodes)for(let g=0;g<s.childNodes.length;g++)ae(s.childNodes[g])}function De(s,g){if(P(g))return!0;if(g=="export"){if(typeof s.template.export!="string")throw new Error("'export' must be a string");if(f.has(s.template.export))throw new Error(`duplicate export name '${s.template.export}'`);return f.set(s.template.export,s.name),!0}if(g=="bind"){if(typeof s.template.bind!="string")throw new Error("'bind' must be a string");if(J.has(s.template.export))throw new Error(`duplicate bind name '${s.template.bind}'`);return J.set(s.template.bind,!0),a.bind.append(`model${A(s.template.bind)} = ${s.name};`),a.unbind.append(`model${A(s.template.bind)} = null;`),!0}if(g.startsWith("on_")){let p=g.substring(3);if(!(s.template[g]instanceof Function))throw new Error(`event handler for '${g}' is not a function`);s.listenerCount||(s.listenerCount=0),s.listenerCount++;let $=`${s.name}_ev${s.listenerCount}`;return a.addLocal($),a.create.append(`${$} = helpers.addEventListener(() => model, ${s.name}, ${JSON.stringify(p)}, refs[${i.length}]);`),i.push(s.template[g]),!0}return g=="debug_create"?(typeof s.template[g]=="function"?(a.create.append(`if (${B(i.length)})`),a.create.append("  debugger;"),i.push(s.template[g])):s.template[g]&&a.create.append("debugger;"),!0):g=="debug_update"?(typeof s.template[g]=="function"?(a.update.append(`if (${B(i.length)})`),a.update.append("  debugger;"),i.push(s.template[g])):s.template[g]&&a.update.append("debugger;"),!0):g=="debug_render"}function P(s){return s=="type"||s=="childNodes"||s=="xmlns"}function B(s){return`refs[${s}].call(model, model, context)`}function Z(s,g){if(s instanceof Function){let p=`p${n++}`;a.addLocal(p),g(),R(),a.update.append(`temp = ${B(i.length)};`),a.update.append(`if (temp !== ${p})`),a.update.append(`  ${g(p+" = temp")};`),i.push(s)}else a.create.append(g(JSON.stringify(s)))}function d(s){if((s.isComponent||s.isIntegrated)&&a.destroy.append(`${s.name}.destroy();`),s.listenerCount)for(let g=0;g<s.listenerCount;g++)a.destroy.append(`${s.name}_ev${g+1}?.();`),a.destroy.append(`${s.name}_ev${g+1} = null;`);s.kind=="html"&&s.nodes.length==0||a.destroy.append(`${s.name} = null;`)}}}let Ot=1;function ft(l,e){e=e??{},e.compileTemplate=ft;let t=Rt(l,e),n=new Function("env","refs","helpers","context",t.code),i=function(r){return r||(r={}),r.$instanceId=Ot++,n(h.env,t.refs,Pe,r??{})};return i.isSingleRoot=t.isSingleRoot,i}h.env=null;class ze extends EventTarget{constructor(){super();L(this,ne,0);this.browser=!1}enterLoading(){Te(this,ne)._++,o(this,ne)==1&&this.dispatchEvent(new Event("loading"))}leaveLoading(){Te(this,ne)._--,o(this,ne)==0&&this.dispatchEvent(new Event("loaded"))}get loading(){return o(this,ne)!=0}async load(t){this.enterLoading();try{return await t()}finally{this.leaveLoading()}}}ne=new WeakMap;class pt extends ze{constructor(){super(),this.browser=!0,this.document=document,this.compileTemplate=ft,this.window=window,this.requestAnimationFrame=window.requestAnimationFrame.bind(window),this.Node=Node}}function mt(l){h.env=l}typeof document<"u"&&mt(new pt);let gt=[],Me=[],Ce=null;class Bt{static declare(e){gt.push(e),Me.push(e),h.env.browser&&h.env.requestAnimationFrame(Mt)}static get all(){return gt.join(`
`)}}function Mt(){Me.length!=0&&(Ce==null&&(Ce=document.createElement("style")),Ce.innerHTML+=Me.join(`
`),Me=[],Ce.parentNode||document.head.appendChild(Ce))}let xe=[],Je=!1;function qe(l,e){l&&(e=e??0,e!=0&&(Je=!0),xe.push({callback:l,order:e}),xe.length==1&&h.env.requestAnimationFrame(function(){let t=xe;Je&&(t.sort((n,i)=>i.order-n.order),Je=!1),xe=[];for(let n=t.length-1;n>=0;n--)t[n].callback()}))}function qt(l){xe.length==0?l():qe(l,Number.MAX_SAFE_INTEGER)}class yt{static compile(){return h.env.compileTemplate(...arguments)}}const se=class se extends EventTarget{constructor(){super();L(this,q);L(this,ie,0);this.update=this.update.bind(this),this.invalidate=this.invalidate.bind(this)}static get compiledTemplate(){return this._compiledTemplate||(this._compiledTemplate=this.compileTemplate()),this._compiledTemplate}static compileTemplate(){return yt.compile(this.template)}static get isSingleRoot(){return this.compiledTemplate.isSingleRoot}init(){o(this,q)||b(this,q,new this.constructor.compiledTemplate({model:this}))}get dom(){return o(this,q)||this.init(),o(this,q)}get isSingleRoot(){return this.dom.isSingleRoot}get rootNode(){if(!this.isSingleRoot)throw new Error("rootNode property can't be used on multi-root template");return this.dom.rootNode}get rootNodes(){return this.dom.rootNodes}invalidate(){o(this,q)&&(this.invalid||(this.invalid=!0,se.invalidate(this)))}validate(){this.invalid&&this.update()}static invalidate(t){this._invalidComponents.push(t),this._invalidComponents.length==1&&qe(()=>{for(let n=0;n<this._invalidComponents.length;n++)this._invalidComponents[n].validate();this._invalidComponents=[]},se.nextFrameOrder)}update(){o(this,q)&&(this.invalid=!1,this.dom.update())}async load(t){Te(this,ie)._++,o(this,ie)==1&&(this.invalidate(),h.env.enterLoading(),this.dispatchEvent(new Event("loading")));try{return await t()}finally{Te(this,ie)._--,o(this,ie)==0&&(this.invalidate(),this.dispatchEvent(new Event("loaded")),h.env.leaveLoading())}}get loading(){return o(this,ie)!=0}set loading(t){throw new Error("setting Component.loading not supported, use load() function")}render(t){this.dom.render(t)}destroy(){o(this,q)&&(o(this,q).destroy(),b(this,q,null))}mount(t){return typeof t=="string"&&(t=document.querySelector(t)),t.append(...this.rootNodes),this}unmount(){o(this,q)&&this.rootNodes.forEach(t=>t.remove())}};q=new WeakMap,ie=new WeakMap,ge(se,"_compiledTemplate"),ge(se,"nextFrameOrder",-100),ge(se,"_invalidComponents",[]),ge(se,"template",{});let He=se;class Ut{static embed(e){return{type:"embed-slot",content:e}}static h(e,t){return{type:`h${e}`,text:t}}static p(e){return{type:"p",text:e}}static a(e,t){return{type:"a",attr_href:e,text:t}}static raw(e){return new k(e)}}const Ue=class Ue extends Array{constructor(){super(...arguments);L(this,re,[])}static from(){return new Ue(...arguments)}addListener(t){o(this,re).push(t)}removeListener(t){let n=o(this,re).indexOf(fn);n>=0&&o(this,re).splice(n,1)}fire(t,n,i){(n!=0||i!=0)&&o(this,re).forEach(r=>r(t,n,i))}touch(t){t>=0&&t<this.length&&o(this,re).forEach(n=>n(t,0,0))}push(){let t=this.length;super.push(...arguments),this.fire(t,0,this.length-t)}pop(){let t=this.length;super.pop(),this.fire(this.length,t-this.length,0)}shift(){let t=this.length;super.shift(...arguments),this.fire(0,t-this.length,0)}unshift(){let t=this.length;super.unshift(...arguments),this.fire(0,0,this.length-t)}splice(t,n){t<0&&(t+=this.length),t>=this.length&&(n=0,t=this.length),n===void 0&&(n=this.length-t),n<0&&(n=0);let i=super.splice(...arguments);return this.fire(t,n,arguments.length>2?arguments.length-2:0),i}sort(){super.sort(...arguments),this.fire(0,this.length,this.length)}setAt(t,n){if(t<0||t>=this.length)throw new Error("Observable array index out of range");this[t]=n,this.fire(t,1,1)}get isObservable(){return!0}static from(t){return new Ue(...t)}};re=new WeakMap;let Ge=Ue;function $t(l){let e="^",t=l.length,n;for(let r=0;r<t;r++){n=!0;let u=l[r];if(u=="?")e+="[^\\/]";else if(u=="*")e+="[^\\/]+";else if(u==":"){r++;let f=r;for(;r<t&&i(l[r]);)r++;let w=l.substring(f,r);if(w.length==0)throw new Error("syntax error in url pattern: expected id after ':'");let S="[^\\/]+";if(l[r]=="("){r++,f=r;let N=0;for(;r<t;){if(l[r]=="(")N++;else if(l[r]==")"){if(N==0)break;N--}r++}if(r>=t)throw new Error("syntax error in url pattern: expected ')'");S=l.substring(f,r),r++}if(r<t&&l[r]=="*"||l[r]=="+"){let N=l[r];r++,l[r]=="/"?(e+=`(?<${w}>(?:${S}\\/)${N})`,r++):N=="*"?e+=`(?<${w}>(?:${S}\\/)*(?:${S})?\\/?)`:e+=`(?<${w}>(?:${S}\\/)*(?:${S})\\/?)`,n=!1}else e+=`(?<${w}>${S})`;r--}else u=="/"?(e+="\\"+u,r==l.length-1&&(e+="?")):".$^{}[]()|*+?\\/".indexOf(u)>=0?(e+="\\"+u,n=u!="/"):e+=u}return n&&(e+="\\/?"),e+="$",e;function i(r){return r>="a"&&r<="z"||r>="A"&&r<="Z"||r>="0"&&r<="9"||r=="_"||r=="$"}}class jt{constructor(e,t){this.el=e,this.targetClass=t,this.entered=!1,this.pendingTransitions=[],this.detecting=!1,this.transitioning=!1,this.el.addEventListener("transitionend",this.onTransitionEndOrCancel.bind(this)),this.el.addEventListener("transitioncancel",this.onTransitionEndOrCancel.bind(this)),this.el.addEventListener("transitionrun",this.onTransitionRun.bind(this))}onTransitionEndOrCancel(e){let t=!1;for(let n=0;n<this.pendingTransitions.length;n++){let i=this.pendingTransitions[n];i.target==e.target&&i.propertyName==e.propertyName&&(this.pendingTransitions.splice(n,1),t=!0)}t&&this.pendingTransitions.length==0&&this.onTransitionsFinished()}onTransitionRun(e){this.detecting&&this.pendingTransitions.push({target:e.target,propertyName:e.propertyName})}detectTransitions(){this.transitioning=!0,this.detecting=!0,this.pendingTransitions=[],requestAnimationFrame(()=>requestAnimationFrame(()=>requestAnimationFrame(()=>{this.detecting=!1,this.pendingTransitions.length==0&&this.onTransitionsFinished()})))}onTransitionsFinished(){this.el.classList.remove(`${this.targetClass}-start-enter`),this.el.classList.remove(`${this.targetClass}-start-leave`),this.el.classList.remove(`${this.targetClass}-enter`),this.el.classList.remove(`${this.targetClass}-leave`),this.entered?this.el.classList.add(this.targetClass):this.el.classList.remove(this.targetClass),this.transitioning=!1}enter(e){if(e){(this.transitioning||!this.entered)&&(this.entered=!0,this.onTransitionsFinished());return}this.entered||(this.entered=!0,this.detectTransitions(),this.el.classList.add(this.targetClass,`${this.targetClass}-enter`,`${this.targetClass}-start-enter`),requestAnimationFrame(()=>requestAnimationFrame(()=>{this.el.classList.remove(`${this.targetClass}-start-enter`)})))}leave(e){if(e){(this.transitioning||this.entered)&&(this.entered=!1,this.onTransitionsFinished());return}this.entered&&(this.entered=!1,this.detectTransitions(),this.el.classList.add(`${this.targetClass}-leave`,`${this.targetClass}-start-leave`),requestAnimationFrame(()=>requestAnimationFrame(()=>{this.el.classList.remove(`${this.targetClass}-start-leave`)})))}toggle(e){this.entered?this.leave():this.enter()}}class Ze{static get(){return{top:window.pageYOffset||document.documentElement.scrollTop,left:window.pageXOffset||document.documentElement.scrollLeft}}static set(e){e?window.scrollTo(e.left,e.top):window.scrollTo(0,0)}}class At{constructor(e,t){L(this,Fe);ge(this,"urlMapper");L(this,U,null);L(this,V,null);L(this,pe,[]);L(this,be,[]);L(this,_e,!1);b(this,Fe,e),e&&(this.navigate=e.navigate.bind(e),this.replace=e.navigate.bind(e),this.back=e.back.bind(e)),t&&this.register(t)}start(){return o(this,Fe).start(this)}internalize(e){var t;return((t=this.urlMapper)==null?void 0:t.internalize(e))??new URL(e)}externalize(e){var t;return((t=this.urlMapper)==null?void 0:t.externalize(e))??new URL(e)}get current(){return o(this,U)}get pending(){return o(this,V)}addEventListener(e,t){o(this,pe).push({event:e,handler:t})}removeEventListener(e,t){let n=o(this,pe).findIndex(i=>i.event==e&&i.handler==t);n>=0&&o(this,pe).splice(n,1)}async dispatchEvent(e,t,n,i){for(let r of o(this,pe))if(r.event==e){let u=r.handler(n,i);if(t&&await Promise.resolve(u)==!1)return!1}return!0}async load(e,t,n){var r,u,f;let i=o(this,U);if(((r=o(this,U))==null?void 0:r.url.pathname)==e.pathname&&o(this,U).url.search==e.search){let w=(f=(u=o(this,U).handler).hashChange)==null?void 0:f.call(u,o(this,U),n);w!==void 0?n=w:n=Object.assign({},o(this,U),n)}if(n=Object.assign(n,{current:!1,url:e,pathname:e.pathname,state:t}),b(this,V,n),!n.match&&(n=await this.matchUrl(e,t,n),!n))return null;try{await this.tryLoad(n)!==!0&&b(this,V,null)}catch(w){throw this.dispatchCancelEvents(i,n),w}return o(this,V)!=n?(this.dispatchCancelEvents(i,n),null):(b(this,V,null),n)}dispatchCancelEvents(e,t){var n,i,r,u,f;(r=(n=o(this,U))==null?void 0:(i=n.handler).cancelLeave)==null||r.call(i,e,t),(f=(u=t.handler).cancelEnter)==null||f.call(u,e,t),this.dispatchEvent("cancel",!1,e,t)}async tryLoad(e){var i,r,u,f,w,S,N,y;let t=o(this,U),n;if(!(t&&(!await this.dispatchEvent("mayLeave",!0,t,e)||e!=o(this,V)||(n=(r=(i=t.handler).mayLeave)==null?void 0:r.call(i,t,e),await Promise.resolve(n)===!1)||e!=o(this,V)))&&(n=(f=(u=e.handler).mayEnter)==null?void 0:f.call(u,t,e),await Promise.resolve(n)!==!1&&e==o(this,V)&&await this.dispatchEvent("mayEnter",!0,t,e)&&e==o(this,V)))return t&&(t.current=!1),e.current=!0,b(this,U,e),t&&(this.dispatchEvent("didLeave",!1,t,e),(S=t==null?void 0:(w=t.handler).didLeave)==null||S.call(w,t,e)),(y=(N=e.handler).didEnter)==null||y.call(N,t,e),this.dispatchEvent("didEnter",!1,t,e),!0}async matchUrl(e,t,n){o(this,_e)&&(o(this,be).sort((i,r)=>(i.order??0)-(r.order??0)),b(this,_e,!1));for(let i of o(this,be)){if(i.pattern&&(n.match=n.pathname.match(i.pattern),!n.match))continue;let r=await Promise.resolve(i.match(n));if(r===!0||r==n)return n.handler=i,n;if(r===null)return null}return n.handler={},n}register(e){Array.isArray(e)||(e=[e]);for(let t of e)typeof t.pattern=="string"&&(t.pattern=new RegExp($t(t.pattern))),o(this,be).push(t);b(this,_e,!0)}}Fe=new WeakMap,U=new WeakMap,V=new WeakMap,pe=new WeakMap,be=new WeakMap,_e=new WeakMap;class Vt{constructor(){L(this,Ne,0);L(this,j);L(this,Se,!1)}async start(e){b(this,j,e),h.env.document.body.addEventListener("click",r=>{let u=r.target.closest("a");if(u){let f=u.getAttribute("href"),w=new URL(f,h.env.window.location);if(w.origin==h.env.window.location.origin){try{w=o(this,j).internalize(w)}catch{return}if(this.navigate(w))return r.preventDefault(),!0}}}),h.env.window.addEventListener("popstate",async r=>{if(o(this,Se)){b(this,Se,!1);return}let u=o(this,Ne)+1,f=o(this,j).internalize(h.env.window.location),w=r.state??{sequence:this.current.state.sequence+1};await this.load(f,w,{navMode:"pop"})||u==o(this,Ne)&&(b(this,Se,!0),h.env.window.history.go(this.current.state.sequence-w.sequence))});let t=o(this,j).internalize(h.env.window.location),n=h.env.window.history.state??{sequence:0},i=await this.load(t,n,{navMode:"start"});return h.env.window.history.replaceState(n,null),i}get current(){return o(this,j).current}async load(e,t,n){return Te(this,Ne)._++,await o(this,j).load(e,t,n)}back(){this.current.state.sequence==0?(this.replace("/"),this.load("/",{sequence:0},{navMode:"replace"})):h.env.window.history.back()}replace(e){typeof e=="string"&&(e=new URL(e,o(this,j).internalize(h.env.window.location))),this.current.pathname=e.pathname,this.current.url=e,h.env.window.history.replaceState(this.current.state,"",o(this,j).externalize(e))}async navigate(e){typeof e=="string"&&(e=new URL(e,o(this,j).internalize(h.env.window.location)));let t=await this.load(e,{sequence:this.current.state.sequence+1},{navMode:"push"});return t&&(h.env.window.history.pushState(t.state,"",o(this,j).externalize(e)),t)}}Ne=new WeakMap,j=new WeakMap,Se=new WeakMap;class Pt{constructor(e){if(this.options=e,this.options.base&&(!this.options.base.startsWith("/")||!this.options.base.endsWith("/")))throw new Error(`UrlMapper base '${this.options.base}' must start and end with '/'`)}internalize(e){if(this.options.base){if(!e.pathname.startsWith(this.options.base))throw new Error(`Can't internalize url '${e}'`);e=new URL(e),e.pathname=e.pathname.substring(this.options.base.length-1)}if(this.options.hash){let t=e.hash.substring(1);t.startsWith("/")||(t="/"+t),e=new URL(`${e.origin}${t}`)}return e}externalize(e){return this.options.hash&&(e=new URL(`${e.origin}/#${e.pathname}${e.search}${e.hash}`)),this.options.base&&(e=new URL(e),e.pathname=this.options.base.slice(0,-1)+e.pathname),e}}class Wt{constructor(e){L(this,Y);L(this,z,{});b(this,Y,e),h.env.window.history.scrollRestoration&&(h.env.window.history.scrollRestoration="manual");let t=h.env.window.sessionStorage.getItem("codeonly-view-states");t&&b(this,z,JSON.parse(t)),e.addEventListener("mayLeave",(n,i)=>(this.captureViewState(),!0)),e.addEventListener("mayEnter",(n,i)=>{i.viewState=o(this,z)[i.state.sequence]}),e.addEventListener("didEnter",(n,i)=>{if(i.navMode=="push"){for(let r of Object.keys(o(this,z)))parseInt(r)>i.state.sequence&&delete o(this,z)[r];this.saveViewStates()}ht(h.env,()=>{qe(()=>{var r,u;if(i.handler.restoreViewState?i.handler.restoreViewState(i.viewState,i):o(this,Y).restoreViewState?(u=(r=o(this,Y)).restoreViewState)==null||u.call(r,i.viewState,i):Ze.set(i.viewState),h.env.browser){let f=document.getElementById(i.url.hash.substring(1));f==null||f.scrollIntoView()}})})}),h.env.window.addEventListener("beforeunload",n=>{this.captureViewState()})}captureViewState(){var t,n;let e=o(this,Y).current;e&&(e.handler.captureViewState?o(this,z)[e.state.sequence]=e.handler.captureViewState(e):o(this,Y).captureViewState?o(this,z)[e.state.sequence]=(n=(t=o(this,Y)).captureViewState)==null?void 0:n.call(t,e):o(this,z)[e.state.sequence]=Ze.get()),this.saveViewStates()}saveViewStates(){h.env.window.sessionStorage.setItem("codeonly-view-states",JSON.stringify(o(this,z)))}}Y=new WeakMap,z=new WeakMap;class zt{constructor(){L(this,me,"`")}text(e){this.raw(oe(e))}raw(e){b(this,me,o(this,me)+e.replace(/[\\`]/g,"\\$&"))}expr(e){b(this,me,o(this,me)+("${"+e+"}"))}resolve(){let e=o(this,me)+"`";return b(this,me,"`"),e}}me=new WeakMap;function wt(l,e){let t=1,n=1,i=[],r=null,u=new H(l,e);return{code:w(u,!0).toString(),refs:i};function w(S,N){let y={emit_text_node:ae,emit_html_node:le,emit_dynamic_text_node:Ye,emit_comment_node:Qe,emit_fragment_node:tt,emit_element_node:nt,emit_integrated_node:Ke,emit_component_node:et},c=new Re;c.create=c.addFunction("create").code,c.update=c.addFunction("update").code,c.render=c.addFunction("render",["w"]).code,c.destroy=c.addFunction("destroy").code;let a=new zt;N&&(r=c,r.code.append("let model = context.model;")),c.code.append("create();"),c.code.append("update();"),R(S),J();for(let d of S.enumLocalNodes())Z(d);let I=[];return N&&(I.push("  context,"),I.push("  get html() { return helpers.renderToString(render) },")),c.code.append(["return { ","  render,","  update,","  destroy,",...I,"};"]),c;function J(){let d=a.resolve();d!="``"&&c.render.append(`w.write(${d});`)}function m(d){d.template.export?r.addLocal(d.name):c.addLocal(d.name)}function T(){c.update.temp_declared||(c.update.temp_declared=!0,c.update.append("let temp;"))}function R(d){d.name=`n${t++}`,y[`emit_${d.kind}_node`](d)}function ae(d){a.text(d.template)}function le(d){a.raw(d.html)}function Ye(d){a.expr(`helpers.rawText(${P(i.length)})`),i.push(d.template)}function Qe(d){a.raw("<!--"),d.template.text instanceof Function?(a.text_expr(P(i.length)),i.push(d.template.text)):a.text(d.template.text),a.raw("-->")}function Ke(d){let s=[];if(d.integrated.nodes)for(let p=0;p<d.integrated.nodes.length;p++){let $=d.integrated.nodes[p];if(!$){s.push(null);continue}$.name=`n${t++}`;let v=w($,!1),_=`${$.name}_constructor_${p+1}`,F=c.addFunction(_,[]);v.appendTo(F.code),s.push(_)}let g=-1;d.integrated.data&&(g=i.length,i.push(d.integrated.data)),d.integrated.wantsUpdate&&c.update.append(`${d.name}.update()`),m(d),c.create.append(`${d.name} = new refs[${i.length}]({`,"  context,",`  data: ${d.integrated.data?`refs[${g}]`:"null"},`,`  nodes: [ ${s.join(", ")} ],`,"});"),i.push(d.template.type);for(let p of Object.keys(d.template))if(!Ee(d,p))throw new Error(`Unknown element template key: ${p}`);J(),c.render.append(`${d.name}.render(w);`)}function et(d){m(d),c.create.append(`${d.name} = new refs[${i.length}]();`),i.push(d.template.type);let s=new Set(d.template.type.slots??[]),g=d.template.update==="auto",p=!1;J();for(let $ of Object.keys(d.template)){if(Ee(d,$)||$=="update")continue;if(s.has($)){if(d.template[$]===void 0)continue;let _=new H(d.template[$],e);R(_),c.create.append(`${d.name}${A($)}.content = ${_.name};`);continue}let v=typeof d.template[$];if(v=="string"||v=="number"||v=="boolean")c.create.append(`${d.name}${A($)} = ${JSON.stringify(d.template[$])}`);else if(v==="function"){g&&!p&&(p=`${d.name}_mod`,c.update.append(`let ${p} = false;`));let _=`p${n++}`;c.addLocal(_);let F=i.length;T(),c.update.append(`temp = ${P(F)};`),c.update.append(`if (temp !== ${_})`),g&&(c.update.append("{"),c.update.append(`  ${p} = true;`)),c.update.append(`  ${d.name}${A($)} = ${_} = temp;`),g&&c.update.append("}"),i.push(d.template[$])}else{let _=d.template[$];_ instanceof Ie&&(_=_.value),c.create.append(`${d.name}${A($)} = refs[${i.length}];`),i.push(_)}}d.template.update&&(typeof d.template.update=="function"?(c.update.append(`if (${P(i.length)})`),c.update.append(`  ${d.name}.update();`),i.push(d.template.update)):g?p&&(c.update.append(`if (${p})`),c.update.append(`  ${d.name}.update();`)):c.update.append(`${d.name}.update();`)),c.render.append(`${d.name}.render(w);`)}function tt(d){je(d)}function nt(d){a.raw(`<${d.template.type}`);let s=[],g=[];for(let p of Object.keys(d.template))if(!Ee(d,p)){if(p=="id"){a.raw(' id="'),B(d.template.id),a.raw('"');continue}if(p=="class"){s.push({name:d.template[p],condition:!0});continue}if(p.startsWith("class_")){s.push({name:x(p.substring(6)),condition:d.template[p]});continue}if(p=="style"){g.push({name:null,value:d.template[p]});continue}if(p.startsWith("style_")){g.push({name:x(p.substring(6)),value:d.template[p]});continue}if(p=="display"){if(d.template.display instanceof Function||typeof d.template.display=="string")g.push({name:"display",value:d.template.display});else if(d.template.display===!1||d.template.display===null||d.template.display===void 0)g.add({name:"display",value:"none"});else if(d.template.display!==!0)throw new Error("display property must be set to function, string, true, false, or null");continue}if(p!="text"){if(p.startsWith("attr_")){let $=p.substring(5);if($=="style"||$=="class"||$=="id")throw new Error(`Incorrect attribute: use '${$}' instead of '${p}'`);c.current_xmlns||($=x($)),a.raw(` ${$}="`),B(d.template[p]),a.raw('"');continue}throw new Error(`Unknown element template key: ${p}`)}}if(s.length>0){let p=!1;for(let $ of s)$.condition&&(p?a.raw(" "):a.raw(' class="'),p=!0,$.condition instanceof Function?(a.expr(`${P(i.length)} ? "${oe($.name)}" : ""`),i.push($.condition)):$.condition&&B($.name));p&&a.raw('"')}if(g.length>0){a.raw(' style="');for(let p of g)if(p.name===null)if(p.value instanceof Function)a.expr(`helpers.rawStyle(${P(i.length)})`),i.push(p.value);else if(p.value instanceof k){let $=p.value.html.trim();$.endsWith(";")||($+=";"),a.raw($)}else{let $=p.value.toString().trim();$.endsWith(";")||($+=";"),a.text($)}else p.value instanceof Function?(a.expr(`helpers.rawNamedStyle(${JSON.stringify(p.name)}, ${P(i.length)})`),i.push(p.value)):p.value!==void 0&&p.value!==null&&(a.raw(p.name),a.raw(":"),B(p.value),a.raw(";"));a.raw('"')}d.template.text||d.childNodes.length>0?(a.raw(">"),d.template.text&&B(d.template.text),je(d),a.raw(`</${d.template.type}>`)):d.template.type.match(/^(area|base|br|col|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)$/i)?a.raw("/>"):a.raw(`></${d.template.type}>`)}function je(d){if(d.childNodes)for(let s=0;s<d.childNodes.length;s++)R(d.childNodes[s])}function Ee(d,s){return De(s)||s=="export"||s=="bind"||s.startsWith("on_")?!0:s=="debug_create"?(typeof d.template[s]=="function"?(c.create.append(`if (${P(i.length)})`),c.create.append("  debugger;"),i.push(d.template[s])):d.template[s]&&c.create.append("debugger;"),!0):s=="debug_render"?(typeof d.template[s]=="function"?(c.render.append(`if (${P(i.length)})`),c.render.append("  debugger;"),i.push(d.template[s])):d.template[s]&&c.render.append("debugger;"),!0):s=="debug_update"}function De(d){return d=="type"||d=="childNodes"||d=="xmlns"}function P(d){return`refs[${d}].call(model, model, context)`}function B(d){d instanceof Function?(a.expr(`helpers.rawText(${P(i.length)})`),i.push(d)):d instanceof k?a.raw(d.html):a.text(d)}function Z(d){(d.isComponent||d.isIntegrated)&&(c.destroy.append(`${d.name}.destroy();`),c.destroy.append(`${d.name} = null;`))}}}let Jt=1;function Xe(l,e){e=e??{},e.compileTemplate=Xe;let t=wt(l,e),n=new Function("env","refs","helpers","context",t.code);return function(r){return r||(r={}),r.$instanceId=Jt++,n(h.env,t.refs,Pe,r??{})}}class Ht extends ze{constructor(){super(),this.compileTemplate=Xe}}h.BrowserEnvironment=pt,h.CloakedValue=Ie,h.Component=He,h.DocumentScrollPosition=Ze,h.EmbedSlot=Be,h.EnvironmentBase=ze,h.ForEachBlock=Oe,h.Html=Ut,h.HtmlString=k,h.IfBlock=Le,h.ObservableArray=Ge,h.Router=At,h.SSREnvironment=Ht,h.Style=Bt,h.Template=yt,h.Transition=jt,h.UrlMapper=Pt,h.ViewStateRestoration=Wt,h.WebHistoryRouterDriver=Vt,h.areSetsEqual=Ve,h.binarySearch=Lt,h.camel_to_dash=x,h.cloak=It,h.compareStrings=Ct,h.compareStringsI=xt,h.compileTemplate=Xe,h.compileTemplateCode=wt,h.deepEqual=dt,h.html=Dt,h.htmlEncode=oe,h.inplace_filter_array=C,h.is_constructor=X,h.member=A,h.nextFrame=qe,h.postNextFrame=qt,h.setEnvironment=mt,h.urlPattern=$t,h.whenLoaded=ht,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
