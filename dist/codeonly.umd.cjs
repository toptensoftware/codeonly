(function(l,N){typeof exports=="object"&&typeof module<"u"?N(exports):typeof define=="function"&&define.amd?define(["exports"],N):(l=typeof globalThis<"u"?globalThis:l||self,N(l.codeonly={}))})(this,function(l){"use strict";var Pt=Object.defineProperty;var ht=l=>{throw TypeError(l)};var zt=(l,N,L)=>N in l?Pt(l,N,{enumerable:!0,configurable:!0,writable:!0,value:L}):l[N]=L;var he=(l,N,L)=>zt(l,typeof N!="symbol"?N+"":N,L),Pe=(l,N,L)=>N.has(l)||ht("Cannot "+L);var a=(l,N,L)=>(Pe(l,N,"read from private field"),L?L.call(l):N.get(l)),E=(l,N,L)=>N.has(l)?ht("Cannot add the same private member more than once"):N instanceof WeakSet?N.add(l):N.set(l,L),g=(l,N,L,P)=>(Pe(l,N,"write to private field"),P?P.call(l,L):N.set(l,L),L),C=(l,N,L)=>(Pe(l,N,"access private method"),L);var $e=(l,N,L,P)=>({set _(Ie){g(l,N,Ie,L)},get _(){return a(l,N,P)}});var W,w,ze,Oe,G,ne,se,re,ct,He,ut,Je,ft,We,pt,Ge,ce,A,V,O,oe,R,ae,fe,Z,X,Y,I,Q,ee,Le,B,q,le,me,ge,ye,M,ve,z,U;function N(o,e){for(let t=0;t<o.length;t++)e(o[t],t)||(o.splice(t,1),t--)}function L(o){return o.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}function P(o){return o instanceof Function&&!!o.prototype&&!!o.prototype.constructor}function Ie(o,e){if(o===e)return!0;if(o.size!==e.size)return!1;for(const t of o)if(!e.has(t))return!1;return!0}function Ze(o,e){if(o===e||o===void 0&&e===void 0)return!0;if(o===void 0||e===void 0)return!1;if(o===null&&e===null)return!0;if(o===null||e===null||typeof o!="object"||typeof e!="object")return!1;let t=Object.getOwnPropertyNames(o),i=Object.getOwnPropertyNames(e);if(t.length!=i.length)return!1;for(let n of t)if(!Object.hasOwn(e,n)||!Ze(o[n],e[n]))return!1;return!0}function mt(o,e,t){let i=0,n=o.length-1;for(;i<=n;){let r=Math.floor((i+n)/2),h=o[r],c=e(h,t);if(c==0)return r;c<0?i=r+1:n=r-1}return-1-i}function gt(o,e){return o<e?-1:o>e?1:0}function yt(o,e){return o=o.toLowerCase(),e=e.toLowerCase(),o<e?-1:o>e?1:0}let vt=/^[a-zA-Z$][a-zA-Z0-9_$]*$/;function H(o){return o.match(vt)?`.${o}`:`[${JSON.stringify(o)}]`}function Xe(o,e){o.loading?o.addEventListener("loaded",e,{once:!0}):e()}class k{constructor(e){this.html=e}}function bt(o){return new k(o)}class Be{constructor(e){this.value=e}}function wt(o){return new Be(o)}function Ce(){let o=[],e="";function t(...v){for(let y=0;y<v.length;y++){let f=v[y];f.lines?o.push(...f.lines.map($=>e+$)):Array.isArray(f)?o.push(...f.filter($=>$!=null).map($=>e+$)):o.push(...f.split(`
`).map($=>e+$))}}function i(){e+="  "}function n(){e=e.substring(2)}function r(){return o.join(`
`)+`
`}function h(v){t("{"),i(),v(this),n(),t("}")}function c(...v){let y={pos:this.lines.length};return this.append(v),y.headerLineCount=this.lines.length-y.pos,y}function m(v,...y){this.lines.length==v.pos+v.headerLineCount?this.lines.splice(v.pos,v.headerLineCount):this.append(y)}return{append:t,enterCollapsibleBlock:c,leaveCollapsibleBlock:m,indent:i,unindent:n,braced:h,toString:r,lines:o,get isEmpty(){return o.length==0}}}class Me{constructor(){this.code=Ce(),this.code.closure=this,this.functions=[],this.locals=[],this.prologs=[],this.epilogs=[]}get isEmpty(){return this.code.isEmpty&&this.locals.length==0&&this.functions.every(e=>e.code.isEmpty)&&this.prologs.every(e=>e.isEmpty)&&this.epilogs.every(e=>e.isEmpty)}addProlog(){let e=Ce();return this.prologs.push(e),e}addEpilog(){let e=Ce();return this.epilogs.push(e),e}addLocal(e,t){this.locals.push({name:e,init:t})}addFunction(e,t){t||(t=[]);let i={name:e,args:t,code:new Me};return this.functions.push(i),i.code}getFunction(e){var t;return(t=this.functions.find(i=>i.name==e))==null?void 0:t.code}toString(){let e=Ce();return this.appendTo(e),e.toString()}appendTo(e){this.locals.length>0&&e.append(`let ${this.locals.map(t=>t.init?`${t.name} = ${t.init}`:t.name).join(", ")};`);for(let t of this.prologs)e.append(t);e.append(this.code);for(let t of this.functions)e.append(`function ${t.name}(${t.args.join(", ")})`),e.append("{"),e.indent(),t.code.appendTo(e),e.unindent(),e.append("}");for(let t of this.epilogs)e.append(t)}}function Ne(o){return o==null?"":(""+o).replace(/["'&<>]/g,function(e){switch(e){case'"':return"&quot;";case"&":return"&amp;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;"}})}class Ye{static rawText(e){return e instanceof k?e.html:Ne(e)}static renderToString(e){let t="";return e({write:function(i){t+=i}}),t}static renderComponentToString(e){let t="";return e.render({write:function(i){t+=i}}),t}static rawStyle(e){let t;return e instanceof k?t=e.html:t=Ne(e),t=t.trim(),t.endsWith(";")||(t+=";"),t}static rawNamedStyle(e,t){if(!t)return"";let i;return t instanceof k?i=t.html:i=Ne(t),i=i.trim(),i+=";",`${e}:${i}`}static createTextNode(e){if(e instanceof k){let t=document.createElement("SPAN");return t.innerHTML=e.html,t}else return document.createTextNode(e)}static setElementText(e,t){t instanceof k?e.innerHTML=t.html:e.innerText=t}static setNodeText(e,t){if(t instanceof k){if(e.nodeType==1)return e.innerHTML=t.html,e;let i=document.createElement("SPAN");return i.innerHTML=t.html,e.replaceWith(i),i}else{if(e.nodeType==3)return e.nodeValue=t,e;let i=document.createTextNode(t);return e.replaceWith(i),i}}static setNodeClass(e,t,i){i?e.classList.add(t):e.classList.remove(t)}static setNodeStyle(e,t,i){i==null?e.style.removeProperty(t):e.style[t]=i}static setNodeDisplay(e,t,i){if(t===!0){i===null?e.style.removeProperty("display"):i!==void 0&&e.style.display!=i&&(e.style.display=i);return}else if(t===!1||t===null||t===void 0){let n=e.style.display;return e.style.display!="none"&&(e.style.display="none"),n??null}else if(typeof t=="string"){let n=e.style.display;return e.style.display!=t&&(e.style.display=t),n??null}}static replaceMany(e,t){var i;if((i=e==null?void 0:e[0])!=null&&i.parentNode){e[0].replaceWith(...t);for(let n=1;n<e.length;n++)e[n].remove()}}static addEventListener(e,t,i,n){function r(h){return n(e(),h)}return t.addEventListener(i,r),function(){t.removeEventListener(i,r)}}}function Qe(o){let e=function(){var i;let t=(i=l.env.document)==null?void 0:i.createComment(o);return{get rootNode(){return t},get rootNodes(){return[t]},get isSingleRoot(){return!0},destroy(){},update(){},render(n){n.write(`<!--${Ne(o)}-->`)}}};return e.isSingleRoot=!0,e}class Se{static integrate(e,t){let i=[],n=[],r=!1,h=!0;for(let c=0;c<e.branches.length;c++){let m=e.branches[c],v={};if(i.push(v),m.condition instanceof Function?(v.condition=m.condition,r=!1):m.condition!==void 0?(v.condition=()=>m.condition,r=!!m.condition):(v.condition=()=>!0,r=!0),m.template!==void 0){let y=new J(m.template,t);y.isSingleRoot||(h=!1),v.nodeIndex=n.length,n.push(y)}}return delete e.branches,r||i.push({condition:()=>!0}),{isSingleRoot:h,wantsUpdate:!0,nodes:n,data:i}}static transform(e){if(e.if===void 0)return e;let t={type:Se,branches:[{template:e,condition:e.if}]};return delete e.if,t}static transformGroup(e){let t=null;for(let i=0;i<e.length;i++){let n=e[i];if(n.if)t={type:Se,branches:[{condition:n.if,template:n}]},delete n.if,e.splice(i,1,t);else if(n.elseif){if(!t)throw new Error("template has 'elseif' without a preceeding condition");t.branches.push({condition:n.elseif,template:n}),delete n.elseif,e.splice(i,1),i--}else if(n.else!==void 0){if(!t)throw new Error("template has 'else' without a preceeding condition");t.branches.push({condition:!0,template:n}),delete n.else,t=null,e.splice(i,1),i--}else t=null}}constructor(e){this.branches=e.data,this.branch_constructors=[],this.context=e.context;for(let t of this.branches)t.nodeIndex!==void 0?this.branch_constructors.push(e.nodes[t.nodeIndex]):this.branch_constructors.push(Qe(" IfBlock placeholder "));this.activeBranchIndex=-1,this.activeBranch=Qe(" IfBlock placeholder ")()}destroy(){this.activeBranch.destroy()}update(){this.switchActiveBranch(),this.activeBranch.update()}render(e){this.activeBranch.render(e)}unbind(){var e,t;(t=(e=this.activeBranch).unbind)==null||t.call(e)}bind(){var e,t;(t=(e=this.activeBranch).bind)==null||t.call(e)}switchActiveBranch(e){let t=this.resolveActiveBranch();if(t!=this.activeBranchIndex){let i=this.activeBranch;this.activeBranchIndex=t,this.activeBranch=this.branch_constructors[t](),Ye.replaceMany(i.rootNodes,this.activeBranch.rootNodes),i.destroy()}}resolveActiveBranch(){for(let e=0;e<this.branches.length;e++)if(this.branches[e].condition.call(this.context.model,this.context.model,this.context))return e;throw new Error("internal error, IfBlock didn't resolve to a branch")}get rootNodes(){return this.activeBranch.rootNodes}get rootNode(){return this.activeBranch.rootNode}}function $t(o,e){let t=Math.min(o.length,e.length),i=Math.max(o.length,e.length),n=0;for(;n<t&&o[n]==e[n];)n++;if(n==i)return[];if(n==o.length)return[{op:"insert",index:o.length,count:e.length-o.length}];let r=0;for(;r<t-n&&o[o.length-r-1]==e[e.length-r-1];)r++;if(r==o.length)return[{op:"insert",index:0,count:e.length-o.length}];if(n+r==o.length)return[{op:"insert",index:n,count:e.length-o.length}];if(n+r==e.length)return[{op:"delete",index:n,count:o.length-e.length}];let h=o.length-r,c=e.length-r,m=de(e,n,c),v=null,y=[],f=n,$=n;for(;f<c;){for(;f<c&&o[$]==e[f];)m.delete(e[f],f),f++,$++;let u=f,_=$;for(;$<h&&!m.has(o[$]);)$++;if($>_){y.push({op:"delete",index:u,count:$-_});continue}for(v||(v=de(o,f,h));f<c&&!v.has(e[f]);)m.delete(e[f],f),f++;if(f>u){y.push({op:"insert",index:u,count:f-u});continue}break}if(f==c)return y;let d=0,x=new Ke;for(;$<h;){let u=$;for(;$<h&&!m.has(o[$]);)$++;if($>u){y.push({op:"delete",index:f,count:$-u});continue}for(;$<h&&m.consume(o[$])!==void 0;)x.add(o[$],d++),$++;$>u&&y.push({op:"store",index:f,count:$-u})}for(;f<c;){let u=f;for(;f<c&&!x.has(e[f]);)f++;if(f>u){y.push({op:"insert",index:u,count:f-u});continue}let _={op:"restore",index:f,count:0};for(y.push(_);f<c;){let j=x.consume(e[f]);if(j===void 0)break;_.count==0?(_.storeIndex=j,_.count=1):_.storeIndex+_.count==j?_.count++:(_={op:"restore",index:f,storeIndex:j,count:1},y.push(_)),f++}}return y;function de(u,_,j){let be=new Ke;for(let we=_;we<j;we++)be.add(u[we],we);return be}}class Ke{constructor(){E(this,W,new Map)}add(e,t){let i=a(this,W).get(e);i?i.push(t):a(this,W).set(e,[t])}delete(e,t){let i=a(this,W).get(e);if(i){let n=i.indexOf(t);if(n>=0){i.splice(n,1);return}}throw new Error("key/value pair not found")}consume(e){let t=a(this,W).get(e);if(!(!t||t.length==0))return t.shift()}has(e){return a(this,W).has(e)}}W=new WeakMap;const ue=class ue{constructor(e){E(this,w);E(this,G);E(this,ne);E(this,se);E(this,re);var t,i;this.itemConstructor=e.data.itemConstructor,this.outer=e.context,this.items=e.data.template.items,this.condition=e.data.template.condition,this.itemKey=e.data.template.itemKey,this.emptyConstructor=e.nodes.length?e.nodes[0]:null,this.itemDoms=[],this.headSentinal=(t=l.env.document)==null?void 0:t.createComment(" enter foreach block "),this.tailSentinal=(i=l.env.document)==null?void 0:i.createComment(" leave foreach block "),this.itemConstructor.isSingleRoot?(g(this,G,C(this,w,ft)),g(this,se,C(this,w,pt)),g(this,ne,C(this,w,We)),g(this,re,C(this,w,Ge))):(g(this,G,C(this,w,ct)),g(this,se,C(this,w,ut)),g(this,ne,C(this,w,He)),g(this,re,C(this,w,Je)))}static integrate(e,t){let i={itemConstructor:t.compileTemplate(e.template),template:{items:e.items,condition:e.condition,itemKey:e.itemKey}},n;return e.empty&&(n=[new J(e.empty,t)]),delete e.template,delete e.items,delete e.condition,delete e.itemKey,delete e.empty,{isSingleRoot:!1,wantsUpdate:!0,data:i,nodes:n}}static transform(e){if(e.foreach===void 0)return e;let t;return e.foreach instanceof Function||Array.isArray(e.foreach)?(t={type:ue,template:e,items:e.foreach},delete e.foreach):(t=Object.assign({},e.foreach,{type:ue,template:e}),delete e.foreach),t}static transformGroup(e){for(let t=1;t<e.length;t++)e[t].else!==void 0&&(e[t-1].foreach!==void 0&&(e[t-1]=ue.transform(e[t-1])),e[t-1].type===ue&&!e[t-1].else&&(delete e[t].else,e[t-1].empty=e[t],e.splice(t,1),t--))}onObservableUpdate(e,t,i){let n={outer:this.outer};if(i==0&&t==0){let r=this.observableItems[e],h=[r],c=null;this.itemKey&&(n.model=r,c=[this.itemKey.call(r,r,n)]),C(this,w,ce).call(this,h,c,e,0,1)}else{let r=null,h=this.observableItems.slice(e,e+i);this.itemKey&&(r=h.map(c=>(n.model=c,this.itemKey.call(c,c,n)))),i&&t?C(this,w,ze).call(this,e,t,h,r):t!=0?a(this,se).call(this,e,t):i!=0&&a(this,G).call(this,h,r,e,0,i),C(this,w,Oe).call(this)}}get rootNodes(){let e=this.emptyDom?this.emptyDom.rootNodes:[];if(this.itemConstructor.isSingleRoot)return[this.headSentinal,...this.itemDoms.map(t=>t.rootNode),...e,this.tailSentinal];{let t=[this.headSentinal];for(let i=0;i<this.itemDoms.length;i++)t.push(...this.itemDoms[i].rootNodes);return t.push(...e),t.push(this.tailSentinal),t}}update(){let e;this.items instanceof Function?e=this.items.call(this.outer.model,this.outer.model,this.outer):e=this.items,e=e??[],this.observableItems!=null&&this.observableItems!=e&&this.observableItems.removeListener(this._onObservableUpdate),Array.isArray(e)&&e.isObservable&&this.observableItems!=e&&(this._onObservableUpdate=this.onObservableUpdate.bind(this),this.observableItems=e,this.observableItems.addListener(this._onObservableUpdate),a(this,se).call(this,0,this.itemDoms.length),this.itemsLoaded=!1);let t={outer:this.outer},i=null;if(this.observableItems||this.condition&&(e=e.filter(n=>(t.model=n,this.condition.call(n,n,t)))),this.itemKey&&(i=e.map(n=>(t.model=n,this.itemKey.call(n,n,t)))),!this.itemsLoaded){this.itemsLoaded=!0,a(this,G).call(this,e,i,0,0,e.length),C(this,w,Oe).call(this);return}this.observableItems||C(this,w,ze).call(this,0,this.itemDoms.length,e,i)}render(e){e.write("<!-- enter foreach block -->");for(let t=0;t<this.itemDoms.length;t++)this.itemDoms[t].render(e);e.write("<!-- leave foreach block -->")}bind(){var e,t;(t=(e=this.emptyDom)==null?void 0:e.bind)==null||t.call(e)}unbind(){var e,t;(t=(e=this.emptyDom)==null?void 0:e.unbind)==null||t.call(e)}destroy(){this.observableItems!=null&&(this.observableItems.removeListener(this._onObservableUpdate),this.observableItems=null);for(let e=0;e<this.itemDoms.length;e++)this.itemDoms[e].destroy();this.itemDoms=null}get isAttached(){var e;return((e=this.tailSentinal)==null?void 0:e.parentNode)!=null}};w=new WeakSet,ze=function(e,t,i,n){let r=e+t,h;e==0&&t==this.itemDoms.length?h=this.itemDoms:h=this.itemDoms.slice(e,r);let c;if(n?c=$t(h.map(u=>u.context.key),n):i.length>h.length?c=[{op:"insert",index:h.length,count:i.length-h.length}]:i.length<h.length?c=[{op:"delete",index:i.length,count:h.length-i.length}]:c=[],c.length==0){C(this,w,ce).call(this,i,n,e,0,t);return}let m=[],v=[],y={insert:$,delete:d,store:x,restore:de},f=0;for(let u of c)u.index>f&&(C(this,w,ce).call(this,i,n,e+f,f,u.index-f),f=u.index),y[u.op].call(this,u);f<i.length&&C(this,w,ce).call(this,i,n,e+f,f,i.length-f);for(let u=v.length-1;u>=0;u--)v[u].destroy();C(this,w,Oe).call(this);function $(u){f+=u.count;let _=Math.min(v.length,u.count);_&&(a(this,ne).call(this,u.index+e,v.splice(0,_)),C(this,w,ce).call(this,i,n,u.index+e,u.index,_)),_<u.count&&a(this,G).call(this,i,n,u.index+e+_,u.index+_,u.count-_)}function d(u){v.push(...a(this,re).call(this,u.index+e,u.count))}function x(u){m.push(...a(this,re).call(this,u.index+e,u.count))}function de(u){f+=u.count,a(this,ne).call(this,u.index+e,m.slice(u.storeIndex,u.storeIndex+u.count)),C(this,w,ce).call(this,i,n,u.index+e,u.index,u.count)}},Oe=function(){if(this.itemDoms.length==0)!this.emptyDom&&this.emptyConstructor&&(this.emptyDom=this.emptyConstructor(),this.isAttached&&this.tailSentinal.before(...this.emptyDom.rootNodes)),this.emptyDom&&this.emptyDom.update();else if(this.emptyDom){if(this.isAttached)for(var e of this.emptyDom.rootNodes)e.remove();this.emptyDom.destroy(),this.emptyDom=null}},G=new WeakMap,ne=new WeakMap,se=new WeakMap,re=new WeakMap,ct=function(e,t,i,n,r){let h=[];for(let c=0;c<r;c++){let m={outer:this.outer,model:e[n+c],key:t==null?void 0:t[n+c],index:i+c};h.push(this.itemConstructor(m))}C(this,w,He).call(this,i,h)},He=function(e,t){if(this.itemDoms.splice(e,0,...t),this.isAttached){let i=[];t.forEach(r=>i.push(...r.rootNodes));let n;e+t.length<this.itemDoms.length?n=this.itemDoms[e+t.length].rootNodes[0]:n=this.tailSentinal,n.before(...i)}},ut=function(e,t){let i=C(this,w,Je).call(this,e,t);for(let n=i.length-1;n>=0;n--)i[n].destroy()},Je=function(e,t){let i=this.isAttached;for(let n=0;n<t;n++)if(i){let r=this.itemDoms[e+n].rootNodes;for(let h=0;h<r.length;h++)r[h].remove()}return this.itemDoms.splice(e,t)},ft=function(e,t,i,n,r){let h=[];for(let c=0;c<r;c++){let m={outer:this.outer,model:e[n+c],key:t==null?void 0:t[n+c],index:i+c};h.push(this.itemConstructor(m))}C(this,w,We).call(this,i,h)},We=function(e,t){if(this.itemDoms.splice(e,0,...t),this.isAttached){let i=t.map(r=>r.rootNode),n;e+t.length<this.itemDoms.length?n=this.itemDoms[e+t.length].rootNode:n=this.tailSentinal,n.before(...i)}},pt=function(e,t){let i=C(this,w,Ge).call(this,e,t);for(let n=i.length-1;n>=0;n--)i[n].destroy()},Ge=function(e,t){let i=this.isAttached;for(let n=0;n<t;n++)i&&this.itemDoms[e+n].rootNode.remove();return this.itemDoms.splice(e,t)},ce=function(e,t,i,n,r){for(let h=0;h<r;h++){let c=this.itemDoms[i+h];c.context.key=t==null?void 0:t[n+h],c.context.index=i+h,c.context.model=e[n+h],c.rebind(),c.update()}};let Te=ue;const pe=class pe{constructor(e){E(this,A);E(this,V);E(this,O);E(this,oe);E(this,R);E(this,ae);E(this,fe);E(this,Z);E(this,X,!0);var t,i;g(this,A,e.context),g(this,fe,e.nodes[1]),g(this,oe,(t=l.env.document)==null?void 0:t.createTextNode("")),g(this,ae,(i=l.env.document)==null?void 0:i.createTextNode("")),g(this,R,[]),g(this,X,e.data.ownsContent??!0),e.nodes[0]?this.content=e.nodes[0]():this.content=e.data.content}static integrate(e,t){let i=null;e.content&&typeof e.content=="object"&&(i=e.content,delete e.content);let n={isSingleRoot:!1,wantsUpdate:!0,data:{ownsContent:e.ownsContent??!0,content:e.content},nodes:[i?new J(i,t):null,e.placeholder?new J(e.placeholder,t):null]};return delete e.content,delete e.placeholder,delete e.ownsContent,n}static transform(e){return e instanceof Function&&!P(e)?{type:pe,content:e}:(e.type=="embed-slot"&&(e.type=pe),e)}static transformGroup(e){for(let t=1;t<e.length;t++)e[t].else!==void 0&&(e[t-1]=pe.transform(e[t-1]),e[t-1].type===pe&&!e[t-1].placeholder&&(delete e[t].else,e[t-1].placeholder=e[t],e.splice(t,1),t--))}get rootNodes(){return[a(this,oe),...a(this,R),a(this,ae)]}get isSingleRoot(){return!1}get ownsContent(){return a(this,X)}set ownsContent(e){g(this,X,e)}get content(){return a(this,V)}set content(e){g(this,V,e),a(this,V)instanceof Function?this.replaceContent(a(this,V).call(a(this,A).model,a(this,A).model,a(this,A))):this.replaceContent(a(this,V))}update(){a(this,V)instanceof Function&&this.replaceContent(a(this,V).call(a(this,A).model,a(this,A).model,a(this,A)))}bind(){var e,t;a(this,Z)&&((t=(e=a(this,O))==null?void 0:e.bind)==null||t.call(e))}unbind(){var e,t;a(this,Z)&&((t=(e=a(this,O))==null?void 0:e.unbind)==null||t.call(e))}get isAttached(){var e;return((e=a(this,oe))==null?void 0:e.parentNode)!=null}replaceContent(e){var t,i;if(!(e==a(this,O)||!e&&a(this,Z))){if(this.isAttached){let n=a(this,oe).nextSibling;for(;n!=a(this,ae);){let r=n.nextSibling;n.remove(),n=r}}if(g(this,R,[]),a(this,X)&&((i=(t=a(this,O))==null?void 0:t.destroy)==null||i.call(t)),g(this,O,e),g(this,Z,!1),!e)a(this,fe)&&(g(this,O,a(this,fe).call(this,a(this,A))),g(this,Z,!0),g(this,R,a(this,O).rootNodes));else if(e.rootNodes!==void 0)g(this,R,e.rootNodes);else if(Array.isArray(e))g(this,R,e);else if(l.env.Node!==void 0&&e instanceof l.env.Node)g(this,R,[e]);else if(e instanceof k){let n=l.env.document.createElement("span");n.innerHTML=e.html,g(this,R,[...n.childNodes])}else if(typeof e=="string")g(this,R,[l.env.document.createTextNode(e)]);else if(e.render)g(this,R,[]);else throw new Error("Embed slot requires component, array of HTML nodes or a single HTML node");this.isAttached&&a(this,ae).before(...a(this,R))}}destroy(){var e,t;a(this,X)&&((t=(e=a(this,O))==null?void 0:e.destroy)==null||t.call(e))}render(e){var t,i;a(this,O)&&((i=(t=a(this,O)).render)==null||i.call(t,e))}};A=new WeakMap,V=new WeakMap,O=new WeakMap,oe=new WeakMap,R=new WeakMap,ae=new WeakMap,fe=new WeakMap,Z=new WeakMap,X=new WeakMap;let De=pe;class xe{static register(e){this.plugins.push(e)}static transform(e){for(let t of this.plugins)t.transform&&(e=t.transform(e));return e}static transformGroup(e){var t;for(let i of this.plugins)(t=i.transformGroup)==null||t.call(i,e)}}he(xe,"plugins",[Te,De,Se]);class J{constructor(e,t){if(Array.isArray(e)&&(e={$:e}),e._&&!e.type&&(e.type=e._,delete e._),e=xe.transform(e),P(e)&&(e={type:e}),this.template=e,P(e.type))e.type.integrate?this.kind="integrated":this.kind="component";else if(typeof e=="string")this.kind="text";else if(e instanceof k){if(this.kind="html",this.html=e.html,l.env.document){let i=l.env.document.createElement("div");i.innerHTML=e.html,this.nodes=[...i.childNodes],this.nodes.forEach(n=>n.remove())}}else e instanceof Function?this.kind="dynamic_text":e.type==="comment"?this.kind="comment":e.type===void 0?this.kind="fragment":this.kind="element";if(this.kind==="integrated"&&(e.$&&!e.content&&(e.content=e.$,delete e.$),this.integrated=this.template.type.integrate(this.template,t)),this.kind=="element"&&e.$&&!e.text&&(typeof e.$=="string"||e.$ instanceof k)&&(e.text=e.$,delete e.$),this.kind=="element"||this.kind=="fragment")e.$&&!e.childNodes&&(e.childNodes=e.$,delete e.$),e.childNodes?(Array.isArray(e.childNodes)?e.childNodes=e.childNodes.flat():e.childNodes=[e.childNodes],e.childNodes.forEach(i=>{i._&&!i.type&&(i.type=i._,delete i._)}),xe.transformGroup(e.childNodes),this.childNodes=this.template.childNodes.map(i=>new J(i,t))):this.childNodes=[];else if(this.isComponent)e.$&&!e.content&&(e.content=e.$,delete e.$);else if(e.childNodes)throw new Error("childNodes only supported on element and fragment nodes")}get isSingleRoot(){return this.isFragment?this.childNodes.length==1&&this.childNodes[0].isSingleRoot:this.isComponent?this.template.type.isSingleRoot:this.isIntegrated?this.integrated.isSingleRoot:this.kind=="html"?this.nodes.length==1:!0}get isComponent(){return this.kind==="component"}get isFragment(){return this.kind==="fragment"}get isIntegrated(){return this.kind==="integrated"}*enumLocalNodes(){if(this.isFragment||(yield this),this.childNodes)for(let e=0;e<this.childNodes.length;e++)yield*this.childNodes[e].enumLocalNodes()}spreadChildDomNodes(){return Array.from(e(this)).filter(t=>t.length>0).join(", ");function*e(t){for(let i=0;i<t.childNodes.length;i++)yield t.childNodes[i].spreadDomNodes()}}spreadDomNodes(){return Array.from(this.enumAllNodes()).join(", ")}*enumAllNodes(){switch(this.kind){case"fragment":for(let e=0;e<this.childNodes.length;e++)yield*this.childNodes[e].enumAllNodes();break;case"component":case"integrated":this.isSingleRoot?yield`${this.name}.rootNode`:yield`...${this.name}.rootNodes`;break;case"html":this.nodes.length>0&&(this.nodes.length>1?yield`...${this.name}`:yield`${this.name}`);break;default:yield this.name}}}function Nt(o,e){let t=1,i=1,n=[],r=null,h=new J(o,e),c=new Map;return{code:v(h,!0).toString(),isSingleRoot:h.isSingleRoot,refs:n};function v(y,f){let $={emit_text_node:we,emit_html_node:Ot,emit_dynamic_text_node:It,emit_comment_node:Bt,emit_fragment_node:qt,emit_element_node:At,emit_integrated_node:Mt,emit_component_node:xt},d=new Me;d.create=d.addFunction("create").code,d.bind=d.addFunction("bind").code,d.update=d.addFunction("update").code,d.unbind=d.addFunction("unbind").code,d.destroy=d.addFunction("destroy").code;let x;f&&(x=d.addFunction("rebind").code);let de=new Map;f&&(r=d,r.code.append("let model = context.model;"),r.code.append("let document = env.document;")),d.code.append("create();"),d.code.append("bind();"),d.code.append("update();"),be(y);for(let s of y.enumLocalNodes())jt(s);d.bind.closure.isEmpty||(d.create.append("bind();"),d.destroy.closure.addProlog().append("unbind();"));let u=[];return y.isSingleRoot&&u.push(`  get rootNode() { return ${y.spreadDomNodes()}; },`),f?(u.push("  context,"),y==h&&c.forEach((s,p)=>u.push(`  get ${p}() { return ${s}; },`)),d.getFunction("bind").isEmpty?x.append("model = context.model"):(x.append("if (model != context.model)"),x.braced(()=>{x.append("unbind();"),x.append("model = context.model"),x.append("bind();")})),u.push("  rebind,")):(u.push("  bind,"),u.push("  unbind,")),d.code.append(["return { ","  update,","  destroy,",`  get rootNodes() { return [ ${y.spreadDomNodes()} ]; },`,`  isSingleRoot: ${y.isSingleRoot},`,...u,"};"]),d;function _(s){s.template.export?r.addLocal(s.name):d.addLocal(s.name)}function j(){d.update.temp_declared||(d.update.temp_declared=!0,d.update.append("let temp;"))}function be(s){s.name=`n${t++}`,$[`emit_${s.kind}_node`](s)}function we(s){_(s),d.create.append(`${s.name} = document.createTextNode(${JSON.stringify(s.template)});`)}function Ot(s){s.nodes.length!=0&&(_(s),s.nodes.length==1?(d.create.append(`${s.name} = refs[${n.length}].cloneNode(true);`),n.push(s.nodes[0])):(d.create.append(`${s.name} = refs[${n.length}].map(x => x.cloneNode(true));`),n.push(s.nodes)))}function It(s){_(s);let p=`p${i++}`;d.addLocal(p),d.create.append(`${s.name} = helpers.createTextNode("");`),j(),d.update.append(`temp = ${te(n.length)};`),d.update.append(`if (temp !== ${p})`),d.update.append(`  ${s.name} = helpers.setNodeText(${s.name}, ${p} = ${te(n.length)});`),n.push(s.template)}function Bt(s){if(_(s),s.template.text instanceof Function){let p=`p${i++}`;d.addLocal(p),d.create.append(`${s.name} = document.createComment("");`),j(),d.update.append(`temp = ${te(n.length)};`),d.update.append(`if (temp !== ${p})`),d.update.append(`  ${s.name}.nodeValue = ${p} = temp;`),n.push(s.template.text)}else d.create.append(`${s.name} = document.createComment(${JSON.stringify(s.template.text)});`)}function Mt(s){let p=[],D=!1;if(s.integrated.nodes)for(let b=0;b<s.integrated.nodes.length;b++){let S=s.integrated.nodes[b];if(!S){p.push(null);continue}S.name=`n${t++}`;let T=v(S,!1);T.getFunction("bind").isEmpty||(D=!0);let dt=`${S.name}_constructor_${b+1}`,Vt=d.addFunction(dt,[]);T.appendTo(Vt.code),p.push(dt)}s.integrated.wantsUpdate&&d.update.append(`${s.name}.update()`),D&&(d.bind.append(`${s.name}.bind()`),d.unbind.append(`${s.name}.unbind()`));let F=-1;s.integrated.data&&(F=n.length,n.push(s.integrated.data)),_(s),d.create.append(`${s.name} = new refs[${n.length}]({`,"  context,",`  data: ${s.integrated.data?`refs[${F}]`:"null"},`,`  nodes: [ ${p.join(", ")} ],`,"});"),n.push(s.template.type);for(let b of Object.keys(s.template))if(!Ve(s,b))throw new Error(`Unknown element template key: ${b}`)}function xt(s){_(s),d.create.append(`${s.name} = new refs[${n.length}]();`),n.push(s.template.type);let p=new Set(s.template.type.slots??[]),D=s.template.update==="auto",F=!1;for(let b of Object.keys(s.template)){if(Ve(s,b)||b=="update")continue;if(p.has(b)){if(s.template[b]===void 0)continue;let T=new J(s.template[b],e);be(T),T.isSingleRoot?d.create.append(`${s.name}${H(b)}.content = ${T.name};`):d.create.append(`${s.name}${H(b)}.content = [${T.spreadDomNodes()}];`);continue}let S=typeof s.template[b];if(S=="string"||S=="number"||S=="boolean")d.create.append(`${s.name}${H(b)} = ${JSON.stringify(s.template[b])}`);else if(S==="function"){D&&!F&&(F=`${s.name}_mod`,d.update.append(`let ${F} = false;`));let T=`p${i++}`;d.addLocal(T);let lt=n.length;j(),d.update.append(`temp = ${te(lt)};`),d.update.append(`if (temp !== ${T})`),D&&(d.update.append("{"),d.update.append(`  ${F} = true;`)),d.update.append(`  ${s.name}${H(b)} = ${T} = temp;`),D&&d.update.append("}"),n.push(s.template[b])}else{let T=s.template[b];T instanceof Be&&(T=T.value),d.create.append(`${s.name}${H(b)} = refs[${n.length}];`),n.push(T)}}s.template.update&&(typeof s.template.update=="function"?(d.update.append(`if (${te(n.length)})`),d.update.append(`  ${s.name}.update();`),n.push(s.template.update)):D?F&&(d.update.append(`if (${F})`),d.update.append(`  ${s.name}.update();`)):d.update.append(`${s.name}.update();`))}function qt(s){at(s)}function At(s){var F;let p=d.current_xmlns,D=s.template.xmlns;D===void 0&&s.template.type=="svg"&&(D="http://www.w3.org/2000/svg"),D==null&&(D=d.current_xmlns),_(s),D?(d.current_xmlns=D,d.create.append(`${s.name} = document.createElementNS(${JSON.stringify(D)}, ${JSON.stringify(s.template.type)});`)):d.create.append(`${s.name} = document.createElement(${JSON.stringify(s.template.type)});`);for(let b of Object.keys(s.template))if(!Ve(s,b)){if(b=="id"){ie(s.template.id,S=>`${s.name}.setAttribute("id", ${S});`);continue}if(b=="class"){ie(s.template.class,S=>`${s.name}.setAttribute("class", ${S});`);continue}if(b.startsWith("class_")){let S=L(b.substring(6));ie(s.template[b],T=>`helpers.setNodeClass(${s.name}, ${JSON.stringify(S)}, ${T})`);continue}if(b=="style"){ie(s.template.style,S=>`${s.name}.setAttribute("style", ${S});`);continue}if(b.startsWith("style_")){let S=L(b.substring(6));ie(s.template[b],T=>`helpers.setNodeStyle(${s.name}, ${JSON.stringify(S)}, ${T})`);continue}if(b=="display"){if(s.template.display instanceof Function)d.addLocal(`${s.name}_prev_display`),ie(s.template[b],S=>`${s.name}_prev_display = helpers.setNodeDisplay(${s.name}, ${S}, ${s.name}_prev_display)`);else if(typeof s.template.display=="string")d.create.append(`${s.name}.style.display = '${s.template.display}';`);else if(s.template.display===!1||s.template.display===null||s.template.display===void 0)d.create.append(`${s.name}.style.display = 'none';`);else if(s.template.display!==!0)throw new Error("display property must be set to string, true, false, or null");continue}if(b.startsWith("attr_")){let S=b.substring(5);if(S=="style"||S=="class"||S=="id")throw new Error(`Incorrect attribute: use '${S}' instead of '${b}'`);d.current_xmlns||(S=L(S)),ie(s.template[b],T=>`${s.name}.setAttribute(${JSON.stringify(S)}, ${T})`);continue}if(b=="text"){s.template.text instanceof Function?ie(s.template.text,S=>`helpers.setElementText(${s.name}, ${S})`):s.template.text instanceof k&&d.create.append(`${s.name}.innerHTML = ${JSON.stringify(s.template.text.html)};`),typeof s.template.text=="string"&&d.create.append(`${s.name}.innerText = ${JSON.stringify(s.template.text)};`);continue}throw new Error(`Unknown element template key: ${b}`)}at(s),(F=s.childNodes)!=null&&F.length&&d.create.append(`${s.name}.append(${s.spreadChildDomNodes()});`),d.current_xmlns=p}function at(s){if(s.childNodes)for(let p=0;p<s.childNodes.length;p++)be(s.childNodes[p])}function Ve(s,p){if(Ut(p))return!0;if(p=="export"){if(typeof s.template.export!="string")throw new Error("'export' must be a string");if(c.has(s.template.export))throw new Error(`duplicate export name '${s.template.export}'`);return c.set(s.template.export,s.name),!0}if(p=="bind"){if(typeof s.template.bind!="string")throw new Error("'bind' must be a string");if(de.has(s.template.export))throw new Error(`duplicate bind name '${s.template.bind}'`);return de.set(s.template.bind,!0),d.bind.append(`model${H(s.template.bind)} = ${s.name};`),d.unbind.append(`model${H(s.template.bind)} = null;`),!0}if(p.startsWith("on_")){let D=p.substring(3);if(!(s.template[p]instanceof Function))throw new Error(`event handler for '${p}' is not a function`);s.listenerCount||(s.listenerCount=0),s.listenerCount++;let F=`${s.name}_ev${s.listenerCount}`;return d.addLocal(F),d.create.append(`${F} = helpers.addEventListener(() => model, ${s.name}, ${JSON.stringify(D)}, refs[${n.length}]);`),n.push(s.template[p]),!0}return p=="debug_create"?(typeof s.template[p]=="function"?(d.create.append(`if (${te(n.length)})`),d.create.append("  debugger;"),n.push(s.template[p])):s.template[p]&&d.create.append("debugger;"),!0):p=="debug_update"?(typeof s.template[p]=="function"?(d.update.append(`if (${te(n.length)})`),d.update.append("  debugger;"),n.push(s.template[p])):s.template[p]&&d.update.append("debugger;"),!0):p=="debug_render"}function Ut(s){return s=="type"||s=="childNodes"||s=="xmlns"}function te(s){return`refs[${s}].call(model, model, context)`}function ie(s,p){if(s instanceof Function){let D=`p${i++}`;d.addLocal(D),p(),j(),d.update.append(`temp = ${te(n.length)};`),d.update.append(`if (temp !== ${D})`),d.update.append(`  ${p(D+" = temp")};`),n.push(s)}else d.create.append(p(JSON.stringify(s)))}function jt(s){if((s.isComponent||s.isIntegrated)&&d.destroy.append(`${s.name}.destroy();`),s.listenerCount)for(let p=0;p<s.listenerCount;p++)d.destroy.append(`${s.name}_ev${p+1}?.();`),d.destroy.append(`${s.name}_ev${p+1} = null;`);s.kind=="html"&&s.nodes.length==0||d.destroy.append(`${s.name} = null;`)}}}let St=1;function et(o,e){e=e??{},e.compileTemplate=et;let t=Nt(o,e),i=new Function("env","refs","helpers","context",t.code),n=function(r){return r||(r={}),r.$instanceId=St++,i(l.env,t.refs,Ye,r??{})};return n.isSingleRoot=t.isSingleRoot,n}l.env=null;class tt extends EventTarget{constructor(){super();E(this,Y,0);this.browser=!1}enterLoading(){$e(this,Y)._++,a(this,Y)==1&&this.dispatchEvent(new Event("loading"))}leaveLoading(){$e(this,Y)._--,a(this,Y)==0&&this.dispatchEvent(new Event("loaded"))}get loading(){return a(this,Y)!=0}async load(t){this.enterLoading();try{return await t()}finally{this.leaveLoading()}}}Y=new WeakMap;class it extends tt{constructor(){super(),this.browser=!0,this.document=document,this.compileTemplate=et,this.window=window,this.requestAnimationFrame=window.requestAnimationFrame.bind(window),this.Node=Node}}function nt(o){l.env=o}typeof document<"u"&&nt(new it);let st=[],Fe=[],Ee=null;class Et{static declare(e){st.push(e),Fe.push(e),l.env.browser&&l.env.requestAnimationFrame(_t)}static get all(){return st.join(`
`)}}function _t(){Fe.length!=0&&(Ee==null&&(Ee=document.createElement("style")),Ee.innerHTML+=Fe.join(`
`),Fe=[],Ee.parentNode||document.head.appendChild(Ee))}let _e=[],qe=!1;function Re(o,e){o&&(e=e??0,e!=0&&(qe=!0),_e.push({callback:o,order:e}),_e.length==1&&l.env.requestAnimationFrame(function(){let t=_e;qe&&(t.sort((i,n)=>n.order-i.order),qe=!1),_e=[];for(let i=t.length-1;i>=0;i--)t[i].callback()}))}function Lt(o){_e.length==0?o():Re(o,Number.MAX_SAFE_INTEGER)}class rt{static compile(){return l.env.compileTemplate(...arguments)}}const K=class K extends EventTarget{constructor(){super();E(this,I);E(this,Q,0);this.update=this.update.bind(this),this.invalidate=this.invalidate.bind(this)}static get compiledTemplate(){return this._compiledTemplate||(this._compiledTemplate=this.compileTemplate()),this._compiledTemplate}static compileTemplate(){return rt.compile(this.template)}static get isSingleRoot(){return this.compiledTemplate.isSingleRoot}init(){a(this,I)||g(this,I,new this.constructor.compiledTemplate({model:this}))}get dom(){return a(this,I)||this.init(),a(this,I)}get isSingleRoot(){return this.dom.isSingleRoot}get rootNode(){if(!this.isSingleRoot)throw new Error("rootNode property can't be used on multi-root template");return this.dom.rootNode}get rootNodes(){return this.dom.rootNodes}invalidate(){a(this,I)&&(this.invalid||(this.invalid=!0,K.invalidate(this)))}validate(){this.invalid&&this.update()}static invalidate(t){this._invalidComponents.push(t),this._invalidComponents.length==1&&Re(()=>{for(let i=0;i<this._invalidComponents.length;i++)this._invalidComponents[i].validate();this._invalidComponents=[]},K.nextFrameOrder)}update(){a(this,I)&&(this.invalid=!1,this.dom.update())}async load(t){$e(this,Q)._++,a(this,Q)==1&&(this.invalidate(),l.env.enterLoading(),this.dispatchEvent(new Event("loading")));try{return await t()}finally{$e(this,Q)._--,a(this,Q)==0&&(this.invalidate(),this.dispatchEvent(new Event("loaded")),l.env.leaveLoading())}}get loading(){return a(this,Q)!=0}set loading(t){throw new Error("setting Component.loading not supported, use load() function")}render(t){this.dom.render(t)}destroy(){a(this,I)&&(a(this,I).destroy(),g(this,I,null))}mount(t){return typeof t=="string"&&(t=document.querySelector(t)),t.append(...this.rootNodes),this}unmount(){a(this,I)&&this.rootNodes.forEach(t=>t.remove())}};I=new WeakMap,Q=new WeakMap,he(K,"_compiledTemplate"),he(K,"nextFrameOrder",-100),he(K,"_invalidComponents",[]),he(K,"template",{});let Ae=K;class Ct{static embed(e){return{type:"embed-slot",content:e}}static h(e,t){return{type:`h${e}`,text:t}}static p(e){return{type:"p",text:e}}static a(e,t){return{type:"a",attr_href:e,text:t}}static raw(e){return new k(e)}}const ke=class ke extends Array{constructor(){super(...arguments);E(this,ee,[])}static from(){return new ke(...arguments)}addListener(t){a(this,ee).push(t)}removeListener(t){let i=a(this,ee).indexOf(fn);i>=0&&a(this,ee).splice(i,1)}fire(t,i,n){(i!=0||n!=0)&&a(this,ee).forEach(r=>r(t,i,n))}touch(t){t>=0&&t<this.length&&a(this,ee).forEach(i=>i(t,0,0))}push(){let t=this.length;super.push(...arguments),this.fire(t,0,this.length-t)}pop(){let t=this.length;super.pop(),this.fire(this.length,t-this.length,0)}shift(){let t=this.length;super.shift(...arguments),this.fire(0,t-this.length,0)}unshift(){let t=this.length;super.unshift(...arguments),this.fire(0,0,this.length-t)}splice(t,i){t<0&&(t+=this.length),t>=this.length&&(i=0,t=this.length),i===void 0&&(i=this.length-t),i<0&&(i=0);let n=super.splice(...arguments);return this.fire(t,i,arguments.length>2?arguments.length-2:0),n}sort(){super.sort(...arguments),this.fire(0,this.length,this.length)}setAt(t,i){if(t<0||t>=this.length)throw new Error("Observable array index out of range");this[t]=i,this.fire(t,1,1)}get isObservable(){return!0}static from(t){return new ke(...t)}};ee=new WeakMap;let Ue=ke;function ot(o){let e="^",t=o.length,i;for(let r=0;r<t;r++){i=!0;let h=o[r];if(h=="?")e+="[^\\/]";else if(h=="*")e+="[^\\/]+";else if(h==":"){r++;let c=r;for(;r<t&&n(o[r]);)r++;let m=o.substring(c,r);if(m.length==0)throw new Error("syntax error in url pattern: expected id after ':'");let v="[^\\/]+";if(o[r]=="("){r++,c=r;let y=0;for(;r<t;){if(o[r]=="(")y++;else if(o[r]==")"){if(y==0)break;y--}r++}if(r>=t)throw new Error("syntax error in url pattern: expected ')'");v=o.substring(c,r),r++}if(r<t&&o[r]=="*"||o[r]=="+"){let y=o[r];r++,o[r]=="/"?(e+=`(?<${m}>(?:${v}\\/)${y})`,r++):y=="*"?e+=`(?<${m}>(?:${v}\\/)*(?:${v})?\\/?)`:e+=`(?<${m}>(?:${v}\\/)*(?:${v})\\/?)`,i=!1}else e+=`(?<${m}>${v})`;r--}else h=="/"?(e+="\\"+h,r==o.length-1&&(e+="?")):".$^{}[]()|*+?\\/".indexOf(h)>=0?(e+="\\"+h,i=h!="/"):e+=h}return i&&(e+="\\/?"),e+="$",e;function n(r){return r>="a"&&r<="z"||r>="A"&&r<="Z"||r>="0"&&r<="9"||r=="_"||r=="$"}}class Tt{constructor(e,t){this.el=e,this.targetClass=t,this.entered=!1,this.pendingTransitions=[],this.detecting=!1,this.transitioning=!1,this.el.addEventListener("transitionend",this.onTransitionEndOrCancel.bind(this)),this.el.addEventListener("transitioncancel",this.onTransitionEndOrCancel.bind(this)),this.el.addEventListener("transitionrun",this.onTransitionRun.bind(this))}onTransitionEndOrCancel(e){let t=!1;for(let i=0;i<this.pendingTransitions.length;i++){let n=this.pendingTransitions[i];n.target==e.target&&n.propertyName==e.propertyName&&(this.pendingTransitions.splice(i,1),t=!0)}t&&this.pendingTransitions.length==0&&this.onTransitionsFinished()}onTransitionRun(e){this.detecting&&this.pendingTransitions.push({target:e.target,propertyName:e.propertyName})}detectTransitions(){this.transitioning=!0,this.detecting=!0,this.pendingTransitions=[],requestAnimationFrame(()=>requestAnimationFrame(()=>requestAnimationFrame(()=>{this.detecting=!1,this.pendingTransitions.length==0&&this.onTransitionsFinished()})))}onTransitionsFinished(){this.el.classList.remove(`${this.targetClass}-start-enter`),this.el.classList.remove(`${this.targetClass}-start-leave`),this.el.classList.remove(`${this.targetClass}-enter`),this.el.classList.remove(`${this.targetClass}-leave`),this.entered?this.el.classList.add(this.targetClass):this.el.classList.remove(this.targetClass),this.transitioning=!1}enter(e){if(e){(this.transitioning||!this.entered)&&(this.entered=!0,this.onTransitionsFinished());return}this.entered||(this.entered=!0,this.detectTransitions(),this.el.classList.add(this.targetClass,`${this.targetClass}-enter`,`${this.targetClass}-start-enter`),requestAnimationFrame(()=>requestAnimationFrame(()=>{this.el.classList.remove(`${this.targetClass}-start-enter`)})))}leave(e){if(e){(this.transitioning||this.entered)&&(this.entered=!1,this.onTransitionsFinished());return}this.entered&&(this.entered=!1,this.detectTransitions(),this.el.classList.add(`${this.targetClass}-leave`,`${this.targetClass}-start-leave`),requestAnimationFrame(()=>requestAnimationFrame(()=>{this.el.classList.remove(`${this.targetClass}-start-leave`)})))}toggle(e){this.entered?this.leave():this.enter()}}class je{static get(){return{top:window.pageYOffset||document.documentElement.scrollTop,left:window.pageXOffset||document.documentElement.scrollLeft}}static set(e){e?window.scrollTo(e.left,e.top):window.scrollTo(0,0)}}class Dt{constructor(e,t){E(this,Le);he(this,"urlMapper");E(this,B,null);E(this,q,null);E(this,le,[]);E(this,me,[]);E(this,ge,!1);g(this,Le,e),e&&(this.navigate=e.navigate.bind(e),this.replace=e.navigate.bind(e),this.back=e.back.bind(e)),t&&this.register(t)}start(){return a(this,Le).start(this)}internalize(e){var t;return((t=this.urlMapper)==null?void 0:t.internalize(e))??new URL(e)}externalize(e){var t;return((t=this.urlMapper)==null?void 0:t.externalize(e))??new URL(e)}get current(){return a(this,B)}get pending(){return a(this,q)}addEventListener(e,t){a(this,le).push({event:e,handler:t})}removeEventListener(e,t){let i=a(this,le).findIndex(n=>n.event==e&&n.handler==t);i>=0&&a(this,le).splice(i,1)}async dispatchEvent(e,t,i,n){for(let r of a(this,le))if(r.event==e){let h=r.handler(i,n);if(t&&await Promise.resolve(h)==!1)return!1}return!0}async load(e,t,i){var r,h,c;let n=a(this,B);if(((r=a(this,B))==null?void 0:r.url.pathname)==e.pathname&&a(this,B).url.search==e.search){let m=(c=(h=a(this,B).handler).hashChange)==null?void 0:c.call(h,a(this,B),i);m!==void 0?i=m:i=Object.assign({},a(this,B),i)}if(i=Object.assign(i,{current:!1,url:e,pathname:e.pathname,state:t}),g(this,q,i),!i.match&&(i=await this.matchUrl(e,t,i),!i))return null;try{await this.tryLoad(i)!==!0&&g(this,q,null)}catch(m){throw this.dispatchCancelEvents(n,i),m}return a(this,q)!=i?(this.dispatchCancelEvents(n,i),null):(g(this,q,null),i)}dispatchCancelEvents(e,t){var i,n,r,h,c;(r=(i=a(this,B))==null?void 0:(n=i.handler).cancelLeave)==null||r.call(n,e,t),(c=(h=t.handler).cancelEnter)==null||c.call(h,e,t),this.dispatchEvent("cancel",!1,e,t)}async tryLoad(e){var n,r,h,c,m,v,y,f;let t=a(this,B),i;if(!(t&&(!await this.dispatchEvent("mayLeave",!0,t,e)||e!=a(this,q)||(i=(r=(n=t.handler).mayLeave)==null?void 0:r.call(n,t,e),await Promise.resolve(i)===!1)||e!=a(this,q)))&&(i=(c=(h=e.handler).mayEnter)==null?void 0:c.call(h,t,e),await Promise.resolve(i)!==!1&&e==a(this,q)&&await this.dispatchEvent("mayEnter",!0,t,e)&&e==a(this,q)))return t&&(t.current=!1),e.current=!0,g(this,B,e),t&&(this.dispatchEvent("didLeave",!1,t,e),(v=t==null?void 0:(m=t.handler).didLeave)==null||v.call(m,t,e)),(f=(y=e.handler).didEnter)==null||f.call(y,t,e),this.dispatchEvent("didEnter",!1,t,e),!0}async matchUrl(e,t,i){a(this,ge)&&(a(this,me).sort((n,r)=>(n.order??0)-(r.order??0)),g(this,ge,!1));for(let n of a(this,me)){if(n.pattern&&(i.match=i.pathname.match(n.pattern),!i.match))continue;let r=await Promise.resolve(n.match(i));if(r===!0||r==i)return i.handler=n,i;if(r===null)return null}return i.handler={},i}register(e){Array.isArray(e)||(e=[e]);for(let t of e)typeof t.pattern=="string"&&(t.pattern=new RegExp(ot(t.pattern))),a(this,me).push(t);g(this,ge,!0)}}Le=new WeakMap,B=new WeakMap,q=new WeakMap,le=new WeakMap,me=new WeakMap,ge=new WeakMap;class Ft{constructor(){E(this,ye,0);E(this,M);E(this,ve,!1)}async start(e){g(this,M,e),l.env.document.body.addEventListener("click",r=>{let h=r.target.closest("a");if(h){let c=h.getAttribute("href"),m=new URL(c,l.env.window.location);if(m.origin==l.env.window.location.origin){try{m=a(this,M).internalize(m)}catch{return}if(this.navigate(m))return r.preventDefault(),!0}}}),l.env.window.addEventListener("popstate",async r=>{if(a(this,ve)){g(this,ve,!1);return}let h=a(this,ye)+1,c=a(this,M).internalize(l.env.window.location),m=r.state??{sequence:this.current.state.sequence+1};await this.load(c,m,{navMode:"pop"})||h==a(this,ye)&&(g(this,ve,!0),l.env.window.history.go(this.current.state.sequence-m.sequence))});let t=a(this,M).internalize(l.env.window.location),i=l.env.window.history.state??{sequence:0},n=await this.load(t,i,{navMode:"start"});return l.env.window.history.replaceState(i,null),n}get current(){return a(this,M).current}async load(e,t,i){return $e(this,ye)._++,await a(this,M).load(e,t,i)}back(){this.current.state.sequence==0?(this.replace("/"),this.load("/",{sequence:0},{navMode:"replace"})):l.env.window.history.back()}replace(e){typeof e=="string"&&(e=new URL(e,a(this,M).internalize(l.env.window.location))),this.current.pathname=e.pathname,this.current.url=e,l.env.window.history.replaceState(this.current.state,"",a(this,M).externalize(e))}async navigate(e){typeof e=="string"&&(e=new URL(e,a(this,M).internalize(l.env.window.location)));let t=await this.load(e,{sequence:this.current.state.sequence+1},{navMode:"push"});return t&&(l.env.window.history.pushState(t.state,"",a(this,M).externalize(e)),t)}}ye=new WeakMap,M=new WeakMap,ve=new WeakMap;class Rt{constructor(e){if(this.options=e,this.options.base&&(!this.options.base.startsWith("/")||!this.options.base.endsWith("/")))throw new Error(`UrlMapper base '${this.options.base}' must start and end with '/'`)}internalize(e){if(this.options.base){if(!e.pathname.startsWith(this.options.base))throw new Error(`Can't internalize url '${e}'`);e=new URL(e),e.pathname=e.pathname.substring(this.options.base.length-1)}if(this.options.hash){let t=e.hash.substring(1);t.startsWith("/")||(t="/"+t),e=new URL(`${e.origin}${t}`)}return e}externalize(e){return this.options.hash&&(e=new URL(`${e.origin}/#${e.pathname}${e.search}${e.hash}`)),this.options.base&&(e=new URL(e),e.pathname=this.options.base.slice(0,-1)+e.pathname),e}}class kt{constructor(e){E(this,z);E(this,U,{});g(this,z,e),l.env.window.history.scrollRestoration&&(l.env.window.history.scrollRestoration="manual");let t=l.env.window.sessionStorage.getItem("codeonly-view-states");t&&g(this,U,JSON.parse(t)),e.addEventListener("mayLeave",(i,n)=>(this.captureViewState(),!0)),e.addEventListener("mayEnter",(i,n)=>{n.viewState=a(this,U)[n.state.sequence]}),e.addEventListener("didEnter",(i,n)=>{if(n.navMode=="push"){for(let r of Object.keys(a(this,U)))parseInt(r)>n.state.sequence&&delete a(this,U)[r];this.saveViewStates()}Xe(l.env,()=>{Re(()=>{var r,h;if(n.handler.restoreViewState?n.handler.restoreViewState(n.viewState,n):a(this,z).restoreViewState?(h=(r=a(this,z)).restoreViewState)==null||h.call(r,n.viewState,n):je.set(n.viewState),l.env.browser){let c=document.getElementById(n.url.hash.substring(1));c==null||c.scrollIntoView()}})})}),l.env.window.addEventListener("beforeunload",i=>{this.captureViewState()})}captureViewState(){var t,i;let e=a(this,z).current;e&&(e.handler.captureViewState?a(this,U)[e.state.sequence]=e.handler.captureViewState(e):a(this,z).captureViewState?a(this,U)[e.state.sequence]=(i=(t=a(this,z)).captureViewState)==null?void 0:i.call(t,e):a(this,U)[e.state.sequence]=je.get()),this.saveViewStates()}saveViewStates(){l.env.window.sessionStorage.setItem("codeonly-view-states",JSON.stringify(a(this,U)))}}z=new WeakMap,U=new WeakMap,l.BrowserEnvironment=it,l.CloakedValue=Be,l.Component=Ae,l.DocumentScrollPosition=je,l.EmbedSlot=De,l.EnvironmentBase=tt,l.ForEachBlock=Te,l.Html=Ct,l.HtmlString=k,l.IfBlock=Se,l.ObservableArray=Ue,l.Router=Dt,l.Style=Et,l.Template=rt,l.Transition=Tt,l.UrlMapper=Rt,l.ViewStateRestoration=kt,l.WebHistoryRouterDriver=Ft,l.areSetsEqual=Ie,l.binarySearch=mt,l.camel_to_dash=L,l.cloak=wt,l.compareStrings=gt,l.compareStringsI=yt,l.deepEqual=Ze,l.html=bt,l.htmlEncode=Ne,l.inplace_filter_array=N,l.is_constructor=P,l.member=H,l.nextFrame=Re,l.postNextFrame=Lt,l.setEnvironment=nt,l.urlPattern=ot,l.whenLoaded=Xe,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
