(function(d,E){typeof exports=="object"&&typeof module<"u"?E(exports):typeof define=="function"&&define.amd?define(["exports"],E):(d=typeof globalThis<"u"?globalThis:d||self,E(d.codeonly={}))})(this,function(d){"use strict";var Ft=Object.defineProperty;var et=d=>{throw TypeError(d)};var kt=(d,E,C)=>E in d?Ft(d,E,{enumerable:!0,configurable:!0,writable:!0,value:C}):d[E]=C;var pe=(d,E,C)=>kt(d,typeof E!="symbol"?E+"":E,C),Re=(d,E,C)=>E.has(d)||et("Cannot "+C);var a=(d,E,C)=>(Re(d,E,"read from private field"),C?C.call(d):E.get(d)),_=(d,E,C)=>E.has(d)?et("Cannot add the same private member more than once"):E instanceof WeakSet?E.add(d):E.set(d,C),$=(d,E,C,Y)=>(Re(d,E,"write to private field"),Y?Y.call(d,C):E.set(d,C),C),T=(d,E,C)=>(Re(d,E,"access private method"),C);var U,b,Be,_e,H,Q,K,ee,tt,Me,it,qe,nt,je,st,Ae,re,M,j,I,te,k,ie,le,P,W,R,ne,de,z,A,be,L,he,ue;function E(r,e){for(let t=0;t<r.length;t++)e(r[t],t)||(r.splice(t,1),t--)}function C(r){return r.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}function Y(r){return r instanceof Function&&!!r.prototype&&!!r.prototype.constructor}function rt(r,e){if(r===e)return!0;if(r.size!==e.size)return!1;for(const t of r)if(!e.has(t))return!1;return!0}function Ve(r,e){if(r===e||r===void 0&&e===void 0)return!0;if(r===void 0||e===void 0)return!1;if(r===null&&e===null)return!0;if(r===null||e===null||typeof r!="object"||typeof e!="object")return!1;let t=Object.getOwnPropertyNames(r),i=Object.getOwnPropertyNames(e);if(t.length!=i.length)return!1;for(let n of t)if(!Object.hasOwn(e,n)||!Ve(r[n],e[n]))return!1;return!0}function ot(r,e,t){let i=0,n=r.length-1;for(;i<=n;){let o=Math.floor((i+n)/2),h=r[o],u=e(h,t);if(u==0)return o;u<0?i=o+1:n=o-1}return-1-i}function lt(r,e){return r<e?-1:r>e?1:0}function at(r,e){return r=r.toLowerCase(),e=e.toLowerCase(),r<e?-1:r>e?1:0}let dt=/^[a-zA-Z$][a-zA-Z0-9_$]*$/;function V(r){return r.match(dt)?`.${r}`:`[${JSON.stringify(r)}]`}class O{constructor(e){this.html=e}}function ht(r){return new O(r)}class Te{constructor(e){this.value=e}}function ut(r){return new Te(r)}function ve(){let r=[],e="";function t(...g){for(let m=0;m<g.length;m++){let f=g[m];f.lines?r.push(...f.lines.map(v=>e+v)):Array.isArray(f)?r.push(...f.filter(v=>v!=null).map(v=>e+v)):r.push(...f.split(`
`).map(v=>e+v))}}function i(){e+="  "}function n(){e=e.substring(2)}function o(){return r.join(`
`)+`
`}function h(g){t("{"),i(),g(this),n(),t("}")}function u(...g){let m={pos:this.lines.length};return this.append(g),m.headerLineCount=this.lines.length-m.pos,m}function w(g,...m){this.lines.length==g.pos+g.headerLineCount?this.lines.splice(g.pos,g.headerLineCount):this.append(m)}return{append:t,enterCollapsibleBlock:u,leaveCollapsibleBlock:w,indent:i,unindent:n,braced:h,toString:o,lines:r,get isEmpty(){return r.length==0}}}class Ce{constructor(){this.code=ve(),this.code.closure=this,this.functions=[],this.locals=[],this.prologs=[],this.epilogs=[]}get isEmpty(){return this.code.isEmpty&&this.locals.length==0&&this.functions.every(e=>e.code.isEmpty)&&this.prologs.every(e=>e.isEmpty)&&this.epilogs.every(e=>e.isEmpty)}addProlog(){let e=ve();return this.prologs.push(e),e}addEpilog(){let e=ve();return this.epilogs.push(e),e}addLocal(e,t){this.locals.push({name:e,init:t})}addFunction(e,t){t||(t=[]);let i={name:e,args:t,code:new Ce};return this.functions.push(i),i.code}getFunction(e){var t;return(t=this.functions.find(i=>i.name==e))==null?void 0:t.code}toString(){let e=ve();return this.appendTo(e),e.toString()}appendTo(e){this.locals.length>0&&e.append(`let ${this.locals.map(t=>t.init?`${t.name} = ${t.init}`:t.name).join(", ")};`);for(let t of this.prologs)e.append(t);e.append(this.code);for(let t of this.functions)e.append(`function ${t.name}(${t.args.join(", ")})`),e.append("{"),e.indent(),t.code.appendTo(e),e.unindent(),e.append("}");for(let t of this.epilogs)e.append(t)}}function me(r){return r==null?"":(""+r).replace(/["'&<>]/g,function(e){switch(e){case'"':return"&quot;";case"&":return"&amp;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;"}})}class Je{static rawText(e){return e instanceof O?e.html:me(e)}static renderToString(e){let t="";return e({write:function(i){t+=i}}),t}static renderComponentToString(e){let t="";return e.render({write:function(i){t+=i}}),t}static rawStyle(e){let t;return e instanceof O?t=e.html:t=me(e),t=t.trim(),t.endsWith(";")||(t+=";"),t}static rawNamedStyle(e,t){if(!t)return"";let i;return t instanceof O?i=t.html:i=me(t),i=i.trim(),i+=";",`${e}:${i}`}static createTextNode(e){if(e instanceof O){let t=document.createElement("SPAN");return t.innerHTML=e.html,t}else return document.createTextNode(e)}static setElementText(e,t){t instanceof O?e.innerHTML=t.html:e.innerText=t}static setNodeText(e,t){if(t instanceof O){if(e.nodeType==1)return e.innerHTML=t.html,e;let i=document.createElement("SPAN");return i.innerHTML=t.html,e.replaceWith(i),i}else{if(e.nodeType==3)return e.nodeValue=t,e;let i=document.createTextNode(t);return e.replaceWith(i),i}}static setNodeClass(e,t,i){i?e.classList.add(t):e.classList.remove(t)}static setNodeStyle(e,t,i){i==null?e.style.removeProperty(t):e.style[t]=i}static setNodeDisplay(e,t,i){if(t===!0){i===null?e.style.removeProperty("display"):i!==void 0&&e.style.display!=i&&(e.style.display=i);return}else if(t===!1||t===null||t===void 0){let n=e.style.display;return e.style.display!="none"&&(e.style.display="none"),n??null}else if(typeof t=="string"){let n=e.style.display;return e.style.display!=t&&(e.style.display=t),n??null}}static replaceMany(e,t){var i;if((i=e==null?void 0:e[0])!=null&&i.parentNode){e[0].replaceWith(...t);for(let n=1;n<e.length;n++)e[n].remove()}}static addEventListener(e,t,i,n){function o(h){return n(e(),h)}return t.addEventListener(i,o),function(){t.removeEventListener(i,o)}}}function Ue(r){let e=function(){var i;let t=(i=d.Environment.document)==null?void 0:i.createComment(r);return{get rootNode(){return t},get rootNodes(){return[t]},get isSingleRoot(){return!0},destroy(){},update(){},render(n){n.write(`<!--${me(r)}-->`)}}};return e.isSingleRoot=!0,e}class ge{static integrate(e,t){let i=[],n=[],o=!1,h=!0;for(let u=0;u<e.branches.length;u++){let w=e.branches[u],g={};if(i.push(g),w.condition instanceof Function?(g.condition=w.condition,o=!1):w.condition!==void 0?(g.condition=()=>w.condition,o=!!w.condition):(g.condition=()=>!0,o=!0),w.template!==void 0){let m=new J(w.template,t);m.isSingleRoot||(h=!1),g.nodeIndex=n.length,n.push(m)}}return delete e.branches,o||i.push({condition:()=>!0}),{isSingleRoot:h,wantsUpdate:!0,nodes:n,data:i}}static transform(e){if(e.if===void 0)return e;let t={type:ge,branches:[{template:e,condition:e.if}]};return delete e.if,t}static transformGroup(e){let t=null;for(let i=0;i<e.length;i++){let n=e[i];if(n.if)t={type:ge,branches:[{condition:n.if,template:n}]},delete n.if,e.splice(i,1,t);else if(n.elseif){if(!t)throw new Error("template has 'elseif' without a preceeding condition");t.branches.push({condition:n.elseif,template:n}),delete n.elseif,e.splice(i,1),i--}else if(n.else!==void 0){if(!t)throw new Error("template has 'else' without a preceeding condition");t.branches.push({condition:!0,template:n}),delete n.else,t=null,e.splice(i,1),i--}else t=null}}constructor(e){this.branches=e.data,this.branch_constructors=[],this.context=e.context;for(let t of this.branches)t.nodeIndex!==void 0?this.branch_constructors.push(e.nodes[t.nodeIndex]):this.branch_constructors.push(Ue(" IfBlock placeholder "));this.activeBranchIndex=-1,this.activeBranch=Ue(" IfBlock placeholder ")()}destroy(){this.activeBranch.destroy()}update(){this.switchActiveBranch(),this.activeBranch.update()}render(e){this.activeBranch.render(e)}unbind(){var e,t;(t=(e=this.activeBranch).unbind)==null||t.call(e)}bind(){var e,t;(t=(e=this.activeBranch).bind)==null||t.call(e)}switchActiveBranch(e){let t=this.resolveActiveBranch();if(t!=this.activeBranchIndex){let i=this.activeBranch;this.activeBranchIndex=t,this.activeBranch=this.branch_constructors[t](),Je.replaceMany(i.rootNodes,this.activeBranch.rootNodes),i.destroy()}}resolveActiveBranch(){for(let e=0;e<this.branches.length;e++)if(this.branches[e].condition.call(this.context.model,this.context.model,this.context))return e;throw new Error("internal error, IfBlock didn't resolve to a branch")}get rootNodes(){return this.activeBranch.rootNodes}get rootNode(){return this.activeBranch.rootNode}}function ct(r,e){let t=Math.min(r.length,e.length),i=Math.max(r.length,e.length),n=0;for(;n<t&&r[n]==e[n];)n++;if(n==i)return[];if(n==r.length)return[{op:"insert",index:r.length,count:e.length-r.length}];let o=0;for(;o<t-n&&r[r.length-o-1]==e[e.length-o-1];)o++;if(o==r.length)return[{op:"insert",index:0,count:e.length-r.length}];if(n+o==r.length)return[{op:"insert",index:n,count:e.length-r.length}];if(n+o==e.length)return[{op:"delete",index:n,count:r.length-e.length}];let h=r.length-o,u=e.length-o,w=se(e,n,u),g=null,m=[],f=n,v=n;for(;f<u;){for(;f<u&&r[v]==e[f];)w.delete(e[f],f),f++,v++;let c=f,S=v;for(;v<h&&!w.has(r[v]);)v++;if(v>S){m.push({op:"delete",index:c,count:v-S});continue}for(g||(g=se(r,f,h));f<u&&!g.has(e[f]);)w.delete(e[f],f),f++;if(f>c){m.push({op:"insert",index:c,count:f-c});continue}break}if(f==u)return m;let l=0,B=new He;for(;v<h;){let c=v;for(;v<h&&!w.has(r[v]);)v++;if(v>c){m.push({op:"delete",index:f,count:v-c});continue}for(;v<h&&w.consume(r[v])!==void 0;)B.add(r[v],l++),v++;v>c&&m.push({op:"store",index:f,count:v-c})}for(;f<u;){let c=f;for(;f<u&&!B.has(e[f]);)f++;if(f>c){m.push({op:"insert",index:c,count:f-c});continue}let S={op:"restore",index:f,count:0};for(m.push(S);f<u;){let q=B.consume(e[f]);if(q===void 0)break;S.count==0?(S.storeIndex=q,S.count=1):S.storeIndex+S.count==q?S.count++:(S={op:"restore",index:f,storeIndex:q,count:1},m.push(S)),f++}}return m;function se(c,S,q){let ce=new He;for(let fe=S;fe<q;fe++)ce.add(c[fe],fe);return ce}}class He{constructor(){_(this,U,new Map)}add(e,t){let i=a(this,U).get(e);i?i.push(t):a(this,U).set(e,[t])}delete(e,t){let i=a(this,U).get(e);if(i){let n=i.indexOf(t);if(n>=0){i.splice(n,1);return}}throw new Error("key/value pair not found")}consume(e){let t=a(this,U).get(e);if(!(!t||t.length==0))return t.shift()}has(e){return a(this,U).has(e)}}U=new WeakMap;const oe=class oe{constructor(e){_(this,b);_(this,H);_(this,Q);_(this,K);_(this,ee);var t,i;this.itemConstructor=e.data.itemConstructor,this.outer=e.context,this.items=e.data.template.items,this.condition=e.data.template.condition,this.itemKey=e.data.template.itemKey,this.emptyConstructor=e.nodes.length?e.nodes[0]:null,this.itemDoms=[],this.headSentinal=(t=d.Environment.document)==null?void 0:t.createComment(" enter foreach block "),this.tailSentinal=(i=d.Environment.document)==null?void 0:i.createComment(" leave foreach block "),this.itemConstructor.isSingleRoot?($(this,H,T(this,b,nt)),$(this,K,T(this,b,st)),$(this,Q,T(this,b,je)),$(this,ee,T(this,b,Ae))):($(this,H,T(this,b,tt)),$(this,K,T(this,b,it)),$(this,Q,T(this,b,Me)),$(this,ee,T(this,b,qe)))}static integrate(e,t){let i={itemConstructor:t.compileTemplate(e.template),template:{items:e.items,condition:e.condition,itemKey:e.itemKey}},n;return e.empty&&(n=[new J(e.empty,t)]),delete e.template,delete e.items,delete e.condition,delete e.itemKey,delete e.empty,{isSingleRoot:!1,wantsUpdate:!0,data:i,nodes:n}}static transform(e){if(e.foreach===void 0)return e;let t;return e.foreach instanceof Function||Array.isArray(e.foreach)?(t={type:oe,template:e,items:e.foreach},delete e.foreach):(t=Object.assign({},e.foreach,{type:oe,template:e}),delete e.foreach),t}static transformGroup(e){for(let t=1;t<e.length;t++)e[t].else!==void 0&&(e[t-1].foreach!==void 0&&(e[t-1]=oe.transform(e[t-1])),e[t-1].type===oe&&!e[t-1].else&&(delete e[t].else,e[t-1].empty=e[t],e.splice(t,1),t--))}onObservableUpdate(e,t,i){let n={outer:this.outer};if(i==0&&t==0){let o=this.observableItems[e],h=[o],u=null;this.itemKey&&(n.model=o,u=[this.itemKey.call(o,o,n)]),T(this,b,re).call(this,h,u,e,0,1)}else{let o=null,h=this.observableItems.slice(e,e+i);this.itemKey&&(o=h.map(u=>(n.model=u,this.itemKey.call(u,u,n)))),i&&t?T(this,b,Be).call(this,e,t,h,o):t!=0?a(this,K).call(this,e,t):i!=0&&a(this,H).call(this,h,o,e,0,i),T(this,b,_e).call(this)}}get rootNodes(){let e=this.emptyDom?this.emptyDom.rootNodes:[];if(this.itemConstructor.isSingleRoot)return[this.headSentinal,...this.itemDoms.map(t=>t.rootNode),...e,this.tailSentinal];{let t=[this.headSentinal];for(let i=0;i<this.itemDoms.length;i++)t.push(...this.itemDoms[i].rootNodes);return t.push(...e),t.push(this.tailSentinal),t}}update(){let e;this.items instanceof Function?e=this.items.call(this.outer.model,this.outer.model,this.outer):e=this.items,e=e??[],this.observableItems!=null&&this.observableItems!=e&&this.observableItems.removeListener(this._onObservableUpdate),Array.isArray(e)&&e.isObservable&&this.observableItems!=e&&(this._onObservableUpdate=this.onObservableUpdate.bind(this),this.observableItems=e,this.observableItems.addListener(this._onObservableUpdate),a(this,K).call(this,0,this.itemDoms.length),this.itemsLoaded=!1);let t={outer:this.outer},i=null;if(this.observableItems||this.condition&&(e=e.filter(n=>(t.model=n,this.condition.call(n,n,t)))),this.itemKey&&(i=e.map(n=>(t.model=n,this.itemKey.call(n,n,t)))),!this.itemsLoaded){this.itemsLoaded=!0,a(this,H).call(this,e,i,0,0,e.length),T(this,b,_e).call(this);return}this.observableItems||T(this,b,Be).call(this,0,this.itemDoms.length,e,i)}render(e){e.write("<!-- enter foreach block -->");for(let t=0;t<this.itemDoms.length;t++)this.itemDoms[t].render(e);e.write("<!-- leave foreach block -->")}bind(){var e,t;(t=(e=this.emptyDom)==null?void 0:e.bind)==null||t.call(e)}unbind(){var e,t;(t=(e=this.emptyDom)==null?void 0:e.unbind)==null||t.call(e)}destroy(){this.observableItems!=null&&(this.observableItems.removeListener(this._onObservableUpdate),this.observableItems=null);for(let e=0;e<this.itemDoms.length;e++)this.itemDoms[e].destroy();this.itemDoms=null}get isAttached(){var e;return((e=this.tailSentinal)==null?void 0:e.parentNode)!=null}};b=new WeakSet,Be=function(e,t,i,n){let o=e+t,h;e==0&&t==this.itemDoms.length?h=this.itemDoms:h=this.itemDoms.slice(e,o);let u;if(n?u=ct(h.map(c=>c.context.key),n):i.length>h.length?u=[{op:"insert",index:h.length,count:i.length-h.length}]:i.length<h.length?u=[{op:"delete",index:i.length,count:h.length-i.length}]:u=[],u.length==0){T(this,b,re).call(this,i,n,e,0,t);return}let w=[],g=[],m={insert:v,delete:l,store:B,restore:se},f=0;for(let c of u)c.index>f&&(T(this,b,re).call(this,i,n,e+f,f,c.index-f),f=c.index),m[c.op].call(this,c);f<i.length&&T(this,b,re).call(this,i,n,e+f,f,i.length-f);for(let c=g.length-1;c>=0;c--)g[c].destroy();T(this,b,_e).call(this);function v(c){f+=c.count;let S=Math.min(g.length,c.count);S&&(a(this,Q).call(this,c.index+e,g.splice(0,S)),T(this,b,re).call(this,i,n,c.index+e,c.index,S)),S<c.count&&a(this,H).call(this,i,n,c.index+e+S,c.index+S,c.count-S)}function l(c){g.push(...a(this,ee).call(this,c.index+e,c.count))}function B(c){w.push(...a(this,ee).call(this,c.index+e,c.count))}function se(c){f+=c.count,a(this,Q).call(this,c.index+e,w.slice(c.storeIndex,c.storeIndex+c.count)),T(this,b,re).call(this,i,n,c.index+e,c.index,c.count)}},_e=function(){if(this.itemDoms.length==0)!this.emptyDom&&this.emptyConstructor&&(this.emptyDom=this.emptyConstructor(),this.isAttached&&this.tailSentinal.before(...this.emptyDom.rootNodes)),this.emptyDom&&this.emptyDom.update();else if(this.emptyDom){if(this.isAttached)for(var e of this.emptyDom.rootNodes)e.remove();this.emptyDom.destroy(),this.emptyDom=null}},H=new WeakMap,Q=new WeakMap,K=new WeakMap,ee=new WeakMap,tt=function(e,t,i,n,o){let h=[];for(let u=0;u<o;u++){let w={outer:this.outer,model:e[n+u],key:t==null?void 0:t[n+u],index:i+u};h.push(this.itemConstructor(w))}T(this,b,Me).call(this,i,h)},Me=function(e,t){if(this.itemDoms.splice(e,0,...t),this.isAttached){let i=[];t.forEach(o=>i.push(...o.rootNodes));let n;e+t.length<this.itemDoms.length?n=this.itemDoms[e+t.length].rootNodes[0]:n=this.tailSentinal,n.before(...i)}},it=function(e,t){let i=T(this,b,qe).call(this,e,t);for(let n=i.length-1;n>=0;n--)i[n].destroy()},qe=function(e,t){let i=this.isAttached;for(let n=0;n<t;n++)if(i){let o=this.itemDoms[e+n].rootNodes;for(let h=0;h<o.length;h++)o[h].remove()}return this.itemDoms.splice(e,t)},nt=function(e,t,i,n,o){let h=[];for(let u=0;u<o;u++){let w={outer:this.outer,model:e[n+u],key:t==null?void 0:t[n+u],index:i+u};h.push(this.itemConstructor(w))}T(this,b,je).call(this,i,h)},je=function(e,t){if(this.itemDoms.splice(e,0,...t),this.isAttached){let i=t.map(o=>o.rootNode),n;e+t.length<this.itemDoms.length?n=this.itemDoms[e+t.length].rootNode:n=this.tailSentinal,n.before(...i)}},st=function(e,t){let i=T(this,b,Ae).call(this,e,t);for(let n=i.length-1;n>=0;n--)i[n].destroy()},Ae=function(e,t){let i=this.isAttached;for(let n=0;n<t;n++)i&&this.itemDoms[e+n].rootNode.remove();return this.itemDoms.splice(e,t)},re=function(e,t,i,n,o){for(let h=0;h<o;h++){let u=this.itemDoms[i+h];u.context.key=t==null?void 0:t[n+h],u.context.index=i+h,u.context.model=e[n+h],u.rebind(),u.update()}};let we=oe;const ae=class ae{constructor(e){_(this,M);_(this,j);_(this,I);_(this,te);_(this,k);_(this,ie);_(this,le);_(this,P);_(this,W,!0);var t,i;$(this,M,e.context),$(this,le,e.nodes[1]),$(this,te,(t=d.Environment.document)==null?void 0:t.createTextNode("")),$(this,ie,(i=d.Environment.document)==null?void 0:i.createTextNode("")),$(this,k,[]),$(this,W,e.data.ownsContent??!0),e.nodes[0]?this.content=e.nodes[0]():this.content=e.data.content}static integrate(e,t){let i=null;e.content&&typeof e.content=="object"&&(i=e.content,delete e.content);let n={isSingleRoot:!1,wantsUpdate:!0,data:{ownsContent:e.ownsContent??!0,content:e.content},nodes:[i?new J(i,t):null,e.placeholder?new J(e.placeholder,t):null]};return delete e.content,delete e.placeholder,delete e.ownsContent,n}static transform(e){return e instanceof Function&&!Y(e)?{type:ae,content:e}:(e.type=="embed-slot"&&(e.type=ae),e)}static transformGroup(e){for(let t=1;t<e.length;t++)e[t].else!==void 0&&(e[t-1]=ae.transform(e[t-1]),e[t-1].type===ae&&!e[t-1].placeholder&&(delete e[t].else,e[t-1].placeholder=e[t],e.splice(t,1),t--))}get rootNodes(){return[a(this,te),...a(this,k),a(this,ie)]}get isSingleRoot(){return!1}get ownsContent(){return a(this,W)}set ownsContent(e){$(this,W,e)}get content(){return a(this,j)}set content(e){$(this,j,e),a(this,j)instanceof Function?this.replaceContent(a(this,j).call(a(this,M).model,a(this,M).model,a(this,M))):this.replaceContent(a(this,j))}update(){a(this,j)instanceof Function&&this.replaceContent(a(this,j).call(a(this,M).model,a(this,M).model,a(this,M)))}bind(){var e,t;a(this,P)&&((t=(e=a(this,I))==null?void 0:e.bind)==null||t.call(e))}unbind(){var e,t;a(this,P)&&((t=(e=a(this,I))==null?void 0:e.unbind)==null||t.call(e))}get isAttached(){var e;return((e=a(this,te))==null?void 0:e.parentNode)!=null}replaceContent(e){var t,i;if(!(e==a(this,I)||!e&&a(this,P))){if(this.isAttached){let n=a(this,te).nextSibling;for(;n!=a(this,ie);){let o=n.nextSibling;n.remove(),n=o}}if($(this,k,[]),a(this,W)&&((i=(t=a(this,I))==null?void 0:t.destroy)==null||i.call(t)),$(this,I,e),$(this,P,!1),!e)a(this,le)&&($(this,I,a(this,le).call(this,a(this,M))),$(this,P,!0),$(this,k,a(this,I).rootNodes));else if(e.rootNodes!==void 0)$(this,k,e.rootNodes);else if(Array.isArray(e))$(this,k,e);else if(d.Environment.Node!==void 0&&e instanceof d.Environment.Node)$(this,k,[e]);else if(e instanceof O){let n=d.Environment.document.createElement("span");n.innerHTML=e.html,$(this,k,[...n.childNodes])}else if(typeof e=="string")$(this,k,[d.Environment.document.createTextNode(e)]);else if(e.render)$(this,k,[]);else throw new Error("Embed slot requires component, array of HTML nodes or a single HTML node");this.isAttached&&a(this,ie).before(...a(this,k))}}destroy(){var e,t;a(this,W)&&((t=(e=a(this,I))==null?void 0:e.destroy)==null||t.call(e))}render(e){var t,i;a(this,I)&&((i=(t=a(this,I)).render)==null||i.call(t,e))}};M=new WeakMap,j=new WeakMap,I=new WeakMap,te=new WeakMap,k=new WeakMap,ie=new WeakMap,le=new WeakMap,P=new WeakMap,W=new WeakMap;let Ne=ae;class Le{static register(e){this.plugins.push(e)}static transform(e){for(let t of this.plugins)t.transform&&(e=t.transform(e));return e}static transformGroup(e){var t;for(let i of this.plugins)(t=i.transformGroup)==null||t.call(i,e)}}pe(Le,"plugins",[we,Ne,ge]);class J{constructor(e,t){if(Array.isArray(e)&&(e={$:e}),e._&&!e.type&&(e.type=e._,delete e._),e=Le.transform(e),Y(e)&&(e={type:e}),this.template=e,Y(e.type))e.type.integrate?this.kind="integrated":this.kind="component";else if(typeof e=="string")this.kind="text";else if(e instanceof O){if(this.kind="html",this.html=e.html,d.Environment.document){let i=d.Environment.document.createElement("div");i.innerHTML=e.html,this.nodes=[...i.childNodes],this.nodes.forEach(n=>n.remove())}}else e instanceof Function?this.kind="dynamic_text":e.type==="comment"?this.kind="comment":e.type===void 0?this.kind="fragment":this.kind="element";if(this.kind==="integrated"&&(e.$&&!e.content&&(e.content=e.$,delete e.$),this.integrated=this.template.type.integrate(this.template,t)),this.kind=="element"&&e.$&&!e.text&&(typeof e.$=="string"||e.$ instanceof O)&&(e.text=e.$,delete e.$),this.kind=="element"||this.kind=="fragment")e.$&&!e.childNodes&&(e.childNodes=e.$,delete e.$),e.childNodes?(Array.isArray(e.childNodes)?e.childNodes=e.childNodes.flat():e.childNodes=[e.childNodes],e.childNodes.forEach(i=>{i._&&!i.type&&(i.type=i._,delete i._)}),Le.transformGroup(e.childNodes),this.childNodes=this.template.childNodes.map(i=>new J(i,t))):this.childNodes=[];else if(this.isComponent)e.$&&!e.content&&(e.content=e.$,delete e.$);else if(e.childNodes)throw new Error("childNodes only supported on element and fragment nodes")}get isSingleRoot(){return this.isFragment?this.childNodes.length==1&&this.childNodes[0].isSingleRoot:this.isComponent?this.template.type.isSingleRoot:this.isIntegrated?this.integrated.isSingleRoot:this.kind=="html"?this.nodes.length==1:!0}get isComponent(){return this.kind==="component"}get isFragment(){return this.kind==="fragment"}get isIntegrated(){return this.kind==="integrated"}*enumLocalNodes(){if(this.isFragment||(yield this),this.childNodes)for(let e=0;e<this.childNodes.length;e++)yield*this.childNodes[e].enumLocalNodes()}spreadChildDomNodes(){return Array.from(e(this)).filter(t=>t.length>0).join(", ");function*e(t){for(let i=0;i<t.childNodes.length;i++)yield t.childNodes[i].spreadDomNodes()}}spreadDomNodes(){return Array.from(this.enumAllNodes()).join(", ")}*enumAllNodes(){switch(this.kind){case"fragment":for(let e=0;e<this.childNodes.length;e++)yield*this.childNodes[e].enumAllNodes();break;case"component":case"integrated":this.isSingleRoot?yield`${this.name}.rootNode`:yield`...${this.name}.rootNodes`;break;case"html":this.nodes.length>0&&(this.nodes.length>1?yield`...${this.name}`:yield`${this.name}`);break;default:yield this.name}}}function ft(r,e){let t=1,i=1,n=[],o=null,h=new J(r,e),u=new Map;return{code:g(h,!0).toString(),isSingleRoot:h.isSingleRoot,refs:n};function g(m,f){let v={emit_text_node:fe,emit_html_node:wt,emit_dynamic_text_node:Nt,emit_comment_node:St,emit_fragment_node:Tt,emit_element_node:Ct,emit_integrated_node:Et,emit_component_node:_t},l=new Ce;l.create=l.addFunction("create").code,l.bind=l.addFunction("bind").code,l.update=l.addFunction("update").code,l.unbind=l.addFunction("unbind").code,l.destroy=l.addFunction("destroy").code;let B;f&&(B=l.addFunction("rebind").code);let se=new Map;f&&(o=l,o.code.append("let model = context.model;"),o.code.append("let document = Environment.document;")),l.code.append("create();"),l.code.append("bind();"),l.code.append("update();"),ce(m);for(let s of m.enumLocalNodes())xt(s);l.bind.closure.isEmpty||(l.create.append("bind();"),l.destroy.closure.addProlog().append("unbind();"));let c=[];return m.isSingleRoot&&c.push(`  get rootNode() { return ${m.spreadDomNodes()}; },`),f?(c.push("  context,"),m==h&&u.forEach((s,p)=>c.push(`  get ${p}() { return ${s}; },`)),l.getFunction("bind").isEmpty?B.append("model = context.model"):(B.append("if (model != context.model)"),B.braced(()=>{B.append("unbind();"),B.append("model = context.model"),B.append("bind();")})),c.push("  rebind,")):(c.push("  bind,"),c.push("  unbind,")),l.code.append(["return { ","  update,","  destroy,",`  get rootNodes() { return [ ${m.spreadDomNodes()} ]; },`,`  isSingleRoot: ${m.isSingleRoot},`,...c,"};"]),l;function S(s){s.template.export?o.addLocal(s.name):l.addLocal(s.name)}function q(){l.update.temp_declared||(l.update.temp_declared=!0,l.update.append("let temp;"))}function ce(s){s.name=`n${t++}`,v[`emit_${s.kind}_node`](s)}function fe(s){S(s),l.create.append(`${s.name} = document.createTextNode(${JSON.stringify(s.template)});`)}function wt(s){s.nodes.length!=0&&(S(s),s.nodes.length==1?(l.create.append(`${s.name} = refs[${n.length}].cloneNode(true);`),n.push(s.nodes[0])):(l.create.append(`${s.name} = refs[${n.length}].map(x => x.cloneNode(true));`),n.push(s.nodes)))}function Nt(s){S(s);let p=`p${i++}`;l.addLocal(p),l.create.append(`${s.name} = helpers.createTextNode("");`),q(),l.update.append(`temp = ${Z(n.length)};`),l.update.append(`if (temp !== ${p})`),l.update.append(`  ${s.name} = helpers.setNodeText(${s.name}, ${p} = ${Z(n.length)});`),n.push(s.template)}function St(s){if(S(s),s.template.text instanceof Function){let p=`p${i++}`;l.addLocal(p),l.create.append(`${s.name} = document.createComment("");`),q(),l.update.append(`temp = ${Z(n.length)};`),l.update.append(`if (temp !== ${p})`),l.update.append(`  ${s.name}.nodeValue = ${p} = temp;`),n.push(s.template.text)}else l.create.append(`${s.name} = document.createComment(${JSON.stringify(s.template.text)});`)}function Et(s){let p=[],D=!1;if(s.integrated.nodes)for(let y=0;y<s.integrated.nodes.length;y++){let N=s.integrated.nodes[y];if(!N){p.push(null);continue}N.name=`n${t++}`;let x=g(N,!1);x.getFunction("bind").isEmpty||(D=!0);let Ke=`${N.name}_constructor_${y+1}`,Dt=l.addFunction(Ke,[]);x.appendTo(Dt.code),p.push(Ke)}s.integrated.wantsUpdate&&l.update.append(`${s.name}.update()`),D&&(l.bind.append(`${s.name}.bind()`),l.unbind.append(`${s.name}.unbind()`));let F=-1;s.integrated.data&&(F=n.length,n.push(s.integrated.data)),S(s),l.create.append(`${s.name} = new refs[${n.length}]({`,"  context,",`  data: ${s.integrated.data?`refs[${F}]`:"null"},`,`  nodes: [ ${p.join(", ")} ],`,"});"),n.push(s.template.type);for(let y of Object.keys(s.template))if(!Ie(s,y))throw new Error(`Unknown element template key: ${y}`)}function _t(s){S(s),l.create.append(`${s.name} = new refs[${n.length}]();`),n.push(s.template.type);let p=new Set(s.template.type.slots??[]),D=s.template.update==="auto",F=!1;for(let y of Object.keys(s.template)){if(Ie(s,y)||y=="update")continue;if(p.has(y)){if(s.template[y]===void 0)continue;let x=new J(s.template[y],e);ce(x),x.isSingleRoot?l.create.append(`${s.name}${V(y)}.content = ${x.name};`):l.create.append(`${s.name}${V(y)}.content = [${x.spreadDomNodes()}];`);continue}let N=typeof s.template[y];if(N=="string"||N=="number"||N=="boolean")l.create.append(`${s.name}${V(y)} = ${JSON.stringify(s.template[y])}`);else if(N==="function"){D&&!F&&(F=`${s.name}_mod`,l.update.append(`let ${F} = false;`));let x=`p${i++}`;l.addLocal(x);let Qe=n.length;q(),l.update.append(`temp = ${Z(Qe)};`),l.update.append(`if (temp !== ${x})`),D&&(l.update.append("{"),l.update.append(`  ${F} = true;`)),l.update.append(`  ${s.name}${V(y)} = ${x} = temp;`),D&&l.update.append("}"),n.push(s.template[y])}else{let x=s.template[y];x instanceof Te&&(x=x.value),l.create.append(`${s.name}${V(y)} = refs[${n.length}];`),n.push(x)}}s.template.update&&(typeof s.template.update=="function"?(l.update.append(`if (${Z(n.length)})`),l.update.append(`  ${s.name}.update();`),n.push(s.template.update)):D?F&&(l.update.append(`if (${F})`),l.update.append(`  ${s.name}.update();`)):l.update.append(`${s.name}.update();`))}function Tt(s){Ye(s)}function Ct(s){var F;let p=l.current_xmlns,D=s.template.xmlns;D===void 0&&s.template.type=="svg"&&(D="http://www.w3.org/2000/svg"),D==null&&(D=l.current_xmlns),S(s),D?(l.current_xmlns=D,l.create.append(`${s.name} = document.createElementNS(${JSON.stringify(D)}, ${JSON.stringify(s.template.type)});`)):l.create.append(`${s.name} = document.createElement(${JSON.stringify(s.template.type)});`);for(let y of Object.keys(s.template))if(!Ie(s,y)){if(y=="id"){X(s.template.id,N=>`${s.name}.setAttribute("id", ${N});`);continue}if(y=="class"){X(s.template.class,N=>`${s.name}.setAttribute("class", ${N});`);continue}if(y.startsWith("class_")){let N=C(y.substring(6));X(s.template[y],x=>`helpers.setNodeClass(${s.name}, ${JSON.stringify(N)}, ${x})`);continue}if(y=="style"){X(s.template.style,N=>`${s.name}.setAttribute("style", ${N});`);continue}if(y.startsWith("style_")){let N=C(y.substring(6));X(s.template[y],x=>`helpers.setNodeStyle(${s.name}, ${JSON.stringify(N)}, ${x})`);continue}if(y=="display"){if(s.template.display instanceof Function)l.addLocal(`${s.name}_prev_display`),X(s.template[y],N=>`${s.name}_prev_display = helpers.setNodeDisplay(${s.name}, ${N}, ${s.name}_prev_display)`);else if(typeof s.template.display=="string")l.create.append(`${s.name}.style.display = '${s.template.display}';`);else if(s.template.display===!1||s.template.display===null||s.template.display===void 0)l.create.append(`${s.name}.style.display = 'none';`);else if(s.template.display!==!0)throw new Error("display property must be set to string, true, false, or null");continue}if(y.startsWith("attr_")){let N=y.substring(5);if(N=="style"||N=="class"||N=="id")throw new Error(`Incorrect attribute: use '${N}' instead of '${y}'`);l.current_xmlns||(N=C(N)),X(s.template[y],x=>`${s.name}.setAttribute(${JSON.stringify(N)}, ${x})`);continue}if(y=="text"){s.template.text instanceof Function?X(s.template.text,N=>`helpers.setElementText(${s.name}, ${N})`):s.template.text instanceof O&&l.create.append(`${s.name}.innerHTML = ${JSON.stringify(s.template.text.html)};`),typeof s.template.text=="string"&&l.create.append(`${s.name}.innerText = ${JSON.stringify(s.template.text)};`);continue}throw new Error(`Unknown element template key: ${y}`)}Ye(s),(F=s.childNodes)!=null&&F.length&&l.create.append(`${s.name}.append(${s.spreadChildDomNodes()});`),l.current_xmlns=p}function Ye(s){if(s.childNodes)for(let p=0;p<s.childNodes.length;p++)ce(s.childNodes[p])}function Ie(s,p){if(Lt(p))return!0;if(p=="export"){if(typeof s.template.export!="string")throw new Error("'export' must be a string");if(u.has(s.template.export))throw new Error(`duplicate export name '${s.template.export}'`);return u.set(s.template.export,s.name),!0}if(p=="bind"){if(typeof s.template.bind!="string")throw new Error("'bind' must be a string");if(se.has(s.template.export))throw new Error(`duplicate bind name '${s.template.bind}'`);return se.set(s.template.bind,!0),l.bind.append(`model${V(s.template.bind)} = ${s.name};`),l.unbind.append(`model${V(s.template.bind)} = null;`),!0}if(p.startsWith("on_")){let D=p.substring(3);if(!(s.template[p]instanceof Function))throw new Error(`event handler for '${p}' is not a function`);s.listenerCount||(s.listenerCount=0),s.listenerCount++;let F=`${s.name}_ev${s.listenerCount}`;return l.addLocal(F),l.create.append(`${F} = helpers.addEventListener(() => model, ${s.name}, ${JSON.stringify(D)}, refs[${n.length}]);`),n.push(s.template[p]),!0}return p=="debug_create"?(typeof s.template[p]=="function"?(l.create.append(`if (${Z(n.length)})`),l.create.append("  debugger;"),n.push(s.template[p])):s.template[p]&&l.create.append("debugger;"),!0):p=="debug_update"?(typeof s.template[p]=="function"?(l.update.append(`if (${Z(n.length)})`),l.update.append("  debugger;"),n.push(s.template[p])):s.template[p]&&l.update.append("debugger;"),!0):p=="debug_render"}function Lt(s){return s=="type"||s=="childNodes"||s=="xmlns"}function Z(s){return`refs[${s}].call(model, model, context)`}function X(s,p){if(s instanceof Function){let D=`p${i++}`;l.addLocal(D),p(),q(),l.update.append(`temp = ${Z(n.length)};`),l.update.append(`if (temp !== ${D})`),l.update.append(`  ${p(D+" = temp")};`),n.push(s)}else l.create.append(p(JSON.stringify(s)))}function xt(s){if((s.isComponent||s.isIntegrated)&&l.destroy.append(`${s.name}.destroy();`),s.listenerCount)for(let p=0;p<s.listenerCount;p++)l.destroy.append(`${s.name}_ev${p+1}?.();`),l.destroy.append(`${s.name}_ev${p+1} = null;`);s.kind=="html"&&s.nodes.length==0||l.destroy.append(`${s.name} = null;`)}}}let pt=1;function Pe(r,e){e=e??{},e.compileTemplate=Pe;let t=ft(r,e),i=new Function("Environment","refs","helpers","context",t.code),n=function(o){return o||(o={}),o.$instanceId=pt++,i(d.Environment,t.refs,Je,o??{})};return n.isSingleRoot=t.isSingleRoot,n}d.Environment={},typeof document<"u"&&(d.Environment.document=document,d.Environment.compileTemplate=Pe),typeof window<"u"&&(d.Environment.window=window,d.Environment.requestAnimationFrame=window.requestAnimationFrame.bind(window)),typeof Node<"u"&&(d.Environment.Node=Node);function mt(r){d.Environment=r}let We=[],Se=[],ye=null;class gt{static declare(e){We.push(e),Se.push(e),d.Environment.document&&d.Environment.requestAnimationFrame(yt)}static get all(){return We.join(`
`)}}function yt(){Se.length!=0&&(ye==null&&(ye=document.createElement("style")),ye.innerHTML+=Se.join(`
`),Se=[],ye.parentNode||document.head.appendChild(ye))}let $e=[],xe=!1;function De(r,e){r&&(e=e??0,e!=0&&(xe=!0),$e.push({callback:r,order:e}),$e.length==1&&d.Environment.requestAnimationFrame(function(){let t=$e;xe&&(t.sort((i,n)=>n.order-i.order),xe=!1),$e=[];for(let i=t.length-1;i>=0;i--)t[i].callback()}))}function $t(r){$e.length==0?r():De(r,Number.MAX_SAFE_INTEGER)}class Ge{static compile(){return d.Environment.compileTemplate(...arguments)}}const G=class G extends EventTarget{constructor(){super();_(this,R);_(this,ne,!1);_(this,de,!1);this.update=this.update.bind(this),this.invalidate=this.invalidate.bind(this)}static get compiledTemplate(){return this._compiledTemplate||(this._compiledTemplate=this.compileTemplate()),this._compiledTemplate}static compileTemplate(){return Ge.compile(this.template)}static get isSingleRoot(){return this.compiledTemplate.isSingleRoot}init(){a(this,R)||$(this,R,new this.constructor.compiledTemplate({model:this}))}get dom(){return a(this,R)||this.init(),a(this,R)}get isSingleRoot(){return this.dom.isSingleRoot}get rootNode(){if(!this.isSingleRoot)throw new Error("rootNode property can't be used on multi-root template");return this.dom.rootNode}get rootNodes(){return this.dom.rootNodes}invalidate(){a(this,R)&&(this.invalid||(this.invalid=!0,G.invalidate(this)))}validate(){this.invalid&&this.update()}static invalidate(t){this._invalidComponents.push(t),this._invalidComponents.length==1&&De(()=>{for(let i=0;i<this._invalidComponents.length;i++)this._invalidComponents[i].validate();this._invalidComponents=[]},G.nextFrameOrder)}update(){a(this,R)&&(this.invalid=!1,this.dom.update(),a(this,de)&&!a(this,ne)&&($(this,de,!1),this.dispatchEvent(new Event("loaded"))))}render(t){this.dom.render(t)}destroy(){a(this,R)&&(a(this,R).destroy(),$(this,R,null))}mount(t){return typeof t=="string"&&(t=document.querySelector(t)),t.append(...this.rootNodes),this}unmount(){a(this,R)&&this.rootNodes.forEach(t=>t.remove())}get loading(){return a(this,ne)}set loading(t){t!=a(this,ne)&&($(this,ne,t),t&&$(this,de,!0),this.invalidate())}};R=new WeakMap,ne=new WeakMap,de=new WeakMap,pe(G,"_compiledTemplate"),pe(G,"nextFrameOrder",-100),pe(G,"_invalidComponents",[]),pe(G,"template",{});let Fe=G;class ze{static embed(e){return{type:"embed-slot",content:e}}static h(e,t){return{type:`h${e}`,text:t}}static p(e){return{type:"p",text:e}}static a(e,t){return{type:"a",attr_href:e,text:t}}static raw(e){return new O(e)}}const Ee=class Ee extends Array{constructor(){super(...arguments);_(this,z,[])}static from(){return new Ee(...arguments)}addListener(t){a(this,z).push(t)}removeListener(t){let i=a(this,z).indexOf(fn);i>=0&&a(this,z).splice(i,1)}fire(t,i,n){(i!=0||n!=0)&&a(this,z).forEach(o=>o(t,i,n))}touch(t){t>=0&&t<this.length&&a(this,z).forEach(i=>i(t,0,0))}push(){let t=this.length;super.push(...arguments),this.fire(t,0,this.length-t)}pop(){let t=this.length;super.pop(),this.fire(this.length,t-this.length,0)}shift(){let t=this.length;super.shift(...arguments),this.fire(0,t-this.length,0)}unshift(){let t=this.length;super.unshift(...arguments),this.fire(0,0,this.length-t)}splice(t,i){t<0&&(t+=this.length),t>=this.length&&(i=0,t=this.length),i===void 0&&(i=this.length-t),i<0&&(i=0);let n=super.splice(...arguments);return this.fire(t,i,arguments.length>2?arguments.length-2:0),n}sort(){super.sort(...arguments),this.fire(0,this.length,this.length)}setAt(t,i){if(t<0||t>=this.length)throw new Error("Observable array index out of range");this[t]=i,this.fire(t,1,1)}get isObservable(){return!0}static from(t){return new Ee(...t)}};z=new WeakMap;let ke=Ee;function Ze(r){let e="^",t=r.length,i;for(let o=0;o<t;o++){i=!0;let h=r[o];if(h=="?")e+="[^\\/]";else if(h=="*")e+="[^\\/]+";else if(h==":"){o++;let u=o;for(;o<t&&n(r[o]);)o++;let w=r.substring(u,o);if(w.length==0)throw new Error("syntax error in url pattern: expected id after ':'");let g="[^\\/]+";if(r[o]=="("){o++,u=o;let m=0;for(;o<t;){if(r[o]=="(")m++;else if(r[o]==")"){if(m==0)break;m--}o++}if(o>=t)throw new Error("syntax error in url pattern: expected ')'");g=r.substring(u,o),o++}if(o<t&&r[o]=="*"||r[o]=="+"){let m=r[o];o++,r[o]=="/"?(e+=`(?<${w}>(?:${g}\\/)${m})`,o++):m=="*"?e+=`(?<${w}>(?:${g}\\/)*(?:${g})?\\/?)`:e+=`(?<${w}>(?:${g}\\/)*(?:${g})\\/?)`,i=!1}else e+=`(?<${w}>${g})`;o--}else h=="/"?(e+="\\"+h,o==r.length-1&&(e+="?")):".$^{}[]()|*+?\\/".indexOf(h)>=0?(e+="\\"+h,i=h!="/"):e+=h}return i&&(e+="\\/?"),e+="$",e;function n(o){return o>="a"&&o<="z"||o>="A"&&o<="Z"||o>="0"&&o<="9"||o=="_"||o=="$"}}class Oe{static get(){return{top:window.pageYOffset||document.documentElement.scrollTop,left:window.pageXOffset||document.documentElement.scrollLeft}}static set(e){e?window.scrollTo(e.left,e.top):window.scrollTo(0,0)}}class Xe extends EventTarget{constructor(){super(...arguments);_(this,A,{});_(this,be);_(this,L);_(this,he,[]);_(this,ue,!1)}start(){let t=window.sessionStorage.getItem("codeonly-view-states");t&&$(this,A,JSON.parse(t)),this.load(window.location.pathname,window.history.state??{sequence:0}),window.history.replaceState(a(this,L).state,null),document.body.addEventListener("click",i=>{let n=i.target.closest("a");if(n){let o=n.getAttribute("href");this.navigate(o)&&i.preventDefault()}}),window.addEventListener("popstate",i=>{this.captureCurrentViewState(),this.saveViewStatesToLocalStorage(),this.load(document.location.pathname,i.state)}),window.addEventListener("beforeunload",i=>{this.captureCurrentViewState(),this.saveViewStatesToLocalStorage()}),window.history.scrollRestoration&&(window.history.scrollRestoration="manual")}saveViewStatesToLocalStorage(){window.sessionStorage.setItem("codeonly-view-states",JSON.stringify(a(this,A)))}captureCurrentViewState(){a(this,L)&&(a(this,A)[a(this,L).state.sequence]=a(this,L).handler.captureViewState())}get prefix(){return a(this,be)}set prefix(t){$(this,be,t)}get current(){return a(this,L)}navigate(t){if(!t.startsWith("/")||this.prefix&&t!=this.prefix&&!t.startsWith(this.prefix+"/"))return null;this.captureCurrentViewState();for(let n of Object.keys(a(this,A)))parseInt(n)>a(this,L).state.sequence&&delete a(this,A)[n];this.saveViewStatesToLocalStorage();let i=this.load(t,{sequence:a(this,L).state.sequence+1});return i?(window.history.pushState(i.state,null,t),!0):null}replace(t){var i;a(this,L).url=t,this.prefix&&(t=this.prefix+t),a(this,L).originalUrl=t,a(this,L).match=(i=a(this,L).handler.pattern)==null?void 0:i.match(a(this,L).url),window.history.replaceState(a(this,L).state,null,t)}load(t,i){var h,u,w,g,m,f;let n=this.matchUrl(t,i);if(!n)return null;(w=(h=a(this,L))==null?void 0:(u=h.handler).leave)==null||w.call(u,a(this,L)),$(this,L,n);let o=new Event("navigate");return o.route=n,this.dispatchEvent(o),(g=n.page)!=null&&g.loading?n.page.addEventListener("loaded",()=>{var v,l;a(this,L)==n&&((l=(v=n.handler).restoreViewState)==null||l.call(v,n.viewState))},{once:!0}):(f=(m=n.handler).restoreViewState)==null||f.call(m,n.viewState),n}matchUrl(t,i){a(this,ue)&&(a(this,he).sort((o,h)=>(o.order??0)-(h.order??0)),$(this,ue,!1));let n={url:t,state:i,viewState:a(this,A)[i.sequence],originalUrl:t};if(this.prefix){if(!t.startsWith(this.prefix))return null;n.url=t.substring(this.prefix.length)}for(let o of a(this,he)){if(o.pattern&&(n.match=n.url.match(o.pattern),!n.match))continue;let h=o.match(n);if(h===!0||h==n)return n.handler=o,n;if(h===null)return null}return n.handler={},n}back(){if(a(this,L).state.sequence==0){let t=((this==null?void 0:this.prefix)??"")+"/";this.load(t,{sequence:0}),window.history.replaceState(a(this,L).state,null,t)}else window.history.back()}register(t){typeof t.pattern=="string"&&(t.pattern=Ze(t.pattern)),t.captureViewState===void 0&&t.restoreViewState===void 0&&(t.captureViewState=Oe.get,t.restoreViewState=Oe.set),a(this,he).push(t),$(this,ue,!0)}}A=new WeakMap,be=new WeakMap,L=new WeakMap,he=new WeakMap,ue=new WeakMap;let bt=new Xe;class vt{constructor(e,t){this.el=e,this.targetClass=t,this.entered=!1,this.pendingTransitions=[],this.detecting=!1,this.transitioning=!1,this.el.addEventListener("transitionend",this.onTransitionEndOrCancel.bind(this)),this.el.addEventListener("transitioncancel",this.onTransitionEndOrCancel.bind(this)),this.el.addEventListener("transitionrun",this.onTransitionRun.bind(this))}onTransitionEndOrCancel(e){let t=!1;for(let i=0;i<this.pendingTransitions.length;i++){let n=this.pendingTransitions[i];n.target==e.target&&n.propertyName==e.propertyName&&(this.pendingTransitions.splice(i,1),t=!0)}t&&this.pendingTransitions.length==0&&this.onTransitionsFinished()}onTransitionRun(e){this.detecting&&this.pendingTransitions.push({target:e.target,propertyName:e.propertyName})}detectTransitions(){this.transitioning=!0,this.detecting=!0,this.pendingTransitions=[],requestAnimationFrame(()=>requestAnimationFrame(()=>requestAnimationFrame(()=>{this.detecting=!1,this.pendingTransitions.length==0&&this.onTransitionsFinished()})))}onTransitionsFinished(){this.el.classList.remove(`${this.targetClass}-start-enter`),this.el.classList.remove(`${this.targetClass}-start-leave`),this.el.classList.remove(`${this.targetClass}-enter`),this.el.classList.remove(`${this.targetClass}-leave`),this.entered?this.el.classList.add(this.targetClass):this.el.classList.remove(this.targetClass),this.transitioning=!1}enter(e){if(e){(this.transitioning||!this.entered)&&(this.entered=!0,this.onTransitionsFinished());return}this.entered||(this.entered=!0,this.detectTransitions(),this.el.classList.add(this.targetClass,`${this.targetClass}-enter`,`${this.targetClass}-start-enter`),requestAnimationFrame(()=>requestAnimationFrame(()=>{this.el.classList.remove(`${this.targetClass}-start-enter`)})))}leave(e){if(e){(this.transitioning||this.entered)&&(this.entered=!1,this.onTransitionsFinished());return}this.entered&&(this.entered=!1,this.detectTransitions(),this.el.classList.add(`${this.targetClass}-leave`,`${this.targetClass}-start-leave`),ze.nextFrame(()=>this.el.classList.remove(`${this.targetClass}-start-leave`)))}toggle(e){this.entered?this.leave():this.enter()}}d.CloakedValue=Te,d.Component=Fe,d.DocumentScrollPosition=Oe,d.EmbedSlot=Ne,d.ForEachBlock=we,d.Html=ze,d.HtmlString=O,d.IfBlock=ge,d.ObservableArray=ke,d.Router=Xe,d.Style=gt,d.Template=Ge,d.Transition=vt,d.areSetsEqual=rt,d.binarySearch=ot,d.camel_to_dash=C,d.cloak=ut,d.compareStrings=lt,d.compareStringsI=at,d.deepEqual=Ve,d.html=ht,d.htmlEncode=me,d.inplace_filter_array=E,d.is_constructor=Y,d.member=V,d.nextFrame=De,d.postNextFrame=$t,d.router=bt,d.setEnvironment=mt,d.urlPattern=Ze,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
